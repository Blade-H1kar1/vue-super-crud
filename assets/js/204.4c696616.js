(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{799:function(e,t,i){"use strict";i.r(t);i(16);const s=(e,t,i)=>t?e+i+t:e,o=(e,t)=>{if("string"==typeof t)return s(e,t,"--");if(Array.isArray(t))return t.map(t=>o(e,t));const i={};return Object.keys(t||{}).forEach(s=>{i[e+"--"+s]=t[s]}),i},r=(e,t,i,r)=>(t&&"string"!=typeof t&&(i=t,t=""),t=s(e,t,"__"),r&&i?o(t,i):i?[t,o(t,i)]:t);var n={methods:{b(e,t,i){return r(this.$options.name,e,t,i)}}},a=function(e){return e.name="sc-"+(e.name||""),e.mixins=e.mixins||[],e.mixins.push(n),e.inheritAttrs=!1,e},l=i(330),c=i.n(l),h=(e={})=>a({name:"tooltip",methods:{show(){if(!e.content)return;const t=this.$refs.tooltip;if(t.referenceElm=e.target,e.overflow){const t=e.target,i=document.createRange();i.setStart(t,0),i.setEnd(t,t.childNodes.length);if(!(i.getBoundingClientRect().width>t.getBoundingClientRect().width||t.scrollWidth>t.offsetWidth))return}t.setExpectedState(!0),t.handleShowPopper()},hide(){const e=this.$refs.tooltip;e.setExpectedState(!1),e.handleClosePopper(),this.$destroy(),this.$el.remove()}},render:t=>t("el-tooltip",c()([{ref:"tooltip"},{props:e},{},{attrs:e}]))}),d=function(e){let t=new(window.Vue.extend(h(e)));return t.vm=t.$mount(),document.body.appendChild(t.vm.$el),t.vm},u={input:(e,{item:t,$value:i})=>e("el-input",{class:"sc-default-input",props:{value:i.get,clearable:!0},attrs:{placeholder:"请输入"+t.label},on:{input:e=>{i.set(e)}}}),formatter:(e,{row:t,column:i,$index:s,item:o,$value:r})=>{let n,a=o.formatter?"function"==typeof o.formatter?o.formatter(t,i,r.get,s):o.formatter:r.get;const l={mouseenter:e=>{n=d({content:a+"",placement:"top",target:e.target,overflow:!0}),n.show()},mouseleave:e=>{n&&n.hide()}};return o.suffix&&a&&(a=a+" "+o.suffix),o.html?e("div",{class:"sc-default-formatter",domProps:{innerHTML:a},style:{display:"inline"},on:l}):e("div",{class:"sc-default-formatter",on:l},a)}},p=i(794),m=i(471),f=i(791),g=i(741),y=i(802);function b(e){return e&&"object"==typeof e&&"componentOptions"in e&&"context"in e&&void 0!==e.tag}function v(e){return e&&("string"==typeof e.template||"function"==typeof e.render)}var w=i(804),x=i(532),S=i.n(x),C=i(537),O=i.n(C);i(128);var $={required:(e,{item:t})=>({validator:(e,i,s)=>{I(i)?s(new Error(t.label+"不能为空")):s()},trigger:t.trigger||"change",message:t.msg}),limit:(e,{item:t})=>({min:e.min,max:e.max,message:`长度在 ${e.min} 到 ${e.max} 个字符`,trigger:e.trigger||"change"}),integer:{msg:"请输入正整数",regular:/^[0-9]\d*$/},integer100:{msg:"请输入1~100的正整数",regular:/^([0-9][0-9]{0,1}|100)$/},phone:{msg:"请输入正确的手机号码",regular:/^1[3-9]\d{9}$/},email:{msg:"请输入正确的邮箱地址",regular:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.(com|cn|net|org|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum)$/},number:{msg:"请输入数字",regular:/^(0\.\d{1,2}|[1-9]\d*(\.\d{1,2})?|0)$/}},_=(i(61),i(538),i(329)),k=i.n(_);const D=[{format:"YYYY-MM-DD HH:mm:ss",regex:/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/},{format:"YYYY-MM-DD HH:mm",regex:/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/},{format:"YYYY/MM/DD HH:mm:ss",regex:/^\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}:\d{2}$/},{format:"YYYY/MM/DD HH:mm",regex:/^\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}$/},{format:"YYYY-MM-DD",regex:/^\d{4}-\d{2}-\d{2}$/},{format:"YYYY/MM/DD",regex:/^\d{4}\/\d{2}\/\d{2}$/},{format:"YYYY年MM月DD日",regex:/^\d{4}年\d{2}月\d{2}日$/},{format:"HH:mm:ss",regex:/^\d{2}:\d{2}:\d{2}$/},{format:"HH:mm",regex:/^\d{2}:\d{2}$/},{format:"MM-DD",regex:/^\d{2}-\d{2}$/},{format:"MM/DD",regex:/^\d{2}\/\d{2}$/},{format:"MM月DD日",regex:/^\d{2}月\d{2}日$/},{format:"YYYY-MM",regex:/^\d{4}-\d{2}$/},{format:"YYYY/MM",regex:/^\d{4}\/\d{2}$/},{format:"YYYY年MM月",regex:/^\d{4}年\d{2}月$/}];const E={rules:$,formatData:{strToArr:e=>{const t=Object(g.a)(e,"formatData.separator")||e.separator||",";return{input:(e,{row:i})=>e?"string"==typeof e?e.split(t):e:[],output:(e,{row:i})=>e?e.join(t):""}},doublePropToArr:e=>{const t=Object(g.a)(e,"formatData.doubleProp")||e.doubleProp;if(Array.isArray(t))return{input:(e,{row:i})=>void 0!==i[t[0]]||void 0!==i[t[1]]?[i[t[0]]||"",i[t[1]]||""]:[],output:(e,{row:i},s)=>{e&&e.length?(s(t[0],e[0]),s(t[1],e[1])):(s(t[0],""),s(t[1],""))}};console.error("doubleProp必须为数组")},multiPropToArr:e=>{const t=Object(g.a)(e,"formatData.multiProp")||e.multiProp,i=Object(g.a)(e,"formatData.isObject")||e.isObject;if(Array.isArray(t))return{input:(s,{row:o})=>{if(t.every(t=>I(i?Object(g.a)(o,[e.prop,t]):Object(g.a)(o,t))))return[];const r=t.map(t=>i?Object(g.a)(o,[e.prop,t]):o[t]),n=r.reduce((e,t,i)=>I(t)?e:i,-1);return r.slice(0,n+1).some((e,t)=>I(e))?[]:r.slice(0,n+1)},output:(s,{row:o},r)=>{s&&Array.isArray(s)&&0!==s.length?t.forEach((t,o)=>{r(i?[e.prop,t]:t,s[o]||"")}):t.forEach(t=>r(i?[e.prop,t]:t,""))}};console.error("multiProp必须为数组")},dateFormat:e=>{const t={valueFormat:(i=Object(g.a)(e,"comp.valueFormat"),(i?i.replace(/yyyy/g,"YYYY").replace(/dd/g,"DD"):i)||"YYYY-MM-DD"),outputFormat:null,outputType:"string",...Object(g.a)(e,"formatData")||e};var i;const s=(e,t)=>{if(e)try{const i=k()(e);if(!i.isValid())return;return i.format(t)}catch(e){return void console.warn("日期格式化失败:",e)}};let o=null;return{input:e=>(o=(e=>{if(!e)return null;if("number"==typeof e)return{type:"timestamp"};if(e instanceof Date)return{type:"Date"};if("string"==typeof e){for(const t of D)if(t.regex.test(e))return{type:"string",format:t.format};if(k()(e).isValid())return{type:"string",format:"unknown"}}return null})(e),s(e,t.valueFormat)),output:e=>{var i,r,n;if(!e)return;const a=t.outputFormat||(null===(i=o)||void 0===i?void 0:i.format)||t.valueFormat;return"timestamp"===(null===(r=o)||void 0===r?void 0:r.type)?k()(e).valueOf():"Date"===(null===(n=o)||void 0===n?void 0:n.type)?k()(e).toDate():s(e,a)}}},weekFormat:e=>{const t={valueFormat:"YYYY-MM-DD",weekStart:0,includeTime:!1,separator:" ~ ",outputType:"array",...Object(g.a)(e,"formatData")||e};let i=null;return{input:e=>Array.isArray(e)&&i?i:e,output:e=>{if(e){i=e;try{const i=k()(e);if(!i.isValid())return;const s=i.startOf("week").add(t.weekStart,"day"),o=i.endOf("week").add(t.weekStart,"day"),r=t.includeTime?t.valueFormat+" HH:mm:ss":t.valueFormat,n=s.format(r),a=o.format(r);return"array"===t.outputType?[n,a]:`${n}${t.separator}${a}`}catch(e){return void console.warn("周格式化失败:",e)}}}}},numberFormat:e=>{const t={precision:2,round:!1,toFixed:!1,thousandth:!1,prefix:"",suffix:"",...Object(g.a)(e,"formatData")||e};return{input:e=>{if(null==e||""===e)return"";try{let i="";i="string"==typeof e?(e=>{let t=e;const i=t.split(".");return i.length>2&&(t=i[0]+"."+i.slice(1).join("")),t})(e):String(e);const s=Number(i);if(isNaN(s))return"";let o=((e,i="")=>{if("number"!=typeof e)return e;let s;if(0!==t.precision){const o=i.endsWith("."),r=i.includes(".")&&i.endsWith("0"),n=r?i.split(".")[1].length:0,a=String(e).split(".");if(a.length>1){const i=a[0],o=a[1];s=t.round?Number(Number(e).toFixed(t.precision)):Number(i+"."+o.slice(0,t.precision))}else s=e;r&&!t.toFixed?s=Number(s).toFixed(Math.min(t.precision,n)):o&&!String(s).includes(".")?s+=".":t.toFixed&&(s=Number(s).toFixed(t.precision))}else s=Number(e).toFixed(0);return s})(s,i);return o=String(o),t.thousandth&&(o=(e=>{const t=e.split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")})(o)),`${t.prefix}${o}${t.suffix}`}catch(e){return console.warn("数字格式化失败:",e),""}},output:e=>{try{let i=String(e);if(i=i.replace(t.prefix,"").replace(t.suffix,"").replace(/,/g,""),t.suffix&&-1===e.indexOf(t.suffix)&&(i=i.slice(0,-1)),i.endsWith("."))return i;const s=Number(i);return isNaN(s)?void 0:i}catch(e){return void console.warn("数字还原失败:",e)}}}},regexFormat:e=>{const t={pattern:"",flags:"g",replace:"",...Object(g.a)(e,"formatData")||e};return{input:e=>{if(!e)return e;try{let i=String(e);if(t.pattern){let e;if(e=t.pattern instanceof RegExp?t.pattern:new RegExp(t.pattern,t.flags),t.pattern.toString().startsWith("/^")&&t.pattern.toString().endsWith("$/"))return e.test(i)?i:"";i=i.replace(e,t.replace)}return i}catch(t){return console.warn("自定义正则格式化失败:",t),e}},output:e=>e}},percentFormat:e=>{const t={precision:2,multiplier:100,addSymbol:!0,...Object(g.a)(e,"formatData")||e};return{input:e=>{if(!e&&0!==e)return"";try{const i=(Number(e)*t.multiplier).toFixed(t.precision);return t.addSymbol?i+"%":i}catch(t){return console.warn("百分比格式化失败:",t),e}},output:e=>{if(e||0===e)try{const i=parseFloat(e.replace("%",""))/t.multiplier;return isNaN(i)?void 0:String(i)}catch(e){return void console.warn("百分比还原失败:",e)}}}},fileSizeFormat:e=>{const t={units:["B","KB","MB","GB","TB"],precision:2,...Object(g.a)(e,"formatData")||e};return{input:e=>{if(!e&&0!==e)return"";try{let i=Number(e),s=0;for(;i>=1024&&s<t.units.length-1;)i/=1024,s++;return`${i.toFixed(t.precision)} ${t.units[s]}`}catch(t){return console.warn("文件大小格式化失败:",t),e}},output:e=>{if(e)try{const[i,s]=e.split(" "),o=t.units.indexOf(s);if(-1===o)return;const r=parseFloat(i)*Math.pow(1024,o);return String(Math.round(r))}catch(e){return void console.warn("文件大小还原失败:",e)}}}}},render:{date:{comp:{name:"el-date-picker",type:"date",valueFormat:"yyyy-MM-dd"}},dateRange:()=>({comp:()=>({name:"el-date-picker",type:"daterange","range-separator":"-","start-placeholder":"开始","end-placeholder":"结束",valueFormat:"yyyy-MM-dd"})}),textLink(e){this.$createElement;return{render:(t,{row:i})=>i[e.prop]?t("el-button",{class:"sc-default-formatter",attrs:{type:"text"},on:{click:()=>{e.onClick&&e.onClick(i)}}},[i[e.prop]]):null}},successBack:e=>({title:"提交成功",footer:{hidden:!0},render:(t,i)=>t("el-result",{attrs:{icon:"success",title:"提交成功",subTitle:"是否立即返回？"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"primary",size:"small"},style:"width: 100px;",on:{click:e.onClick}},["返回"])])])}),confirmTip:e=>({title:e.title||"提示",width:e.width||"400px",render:(t,i)=>t("div",{style:"display:flex"},[t("div",{class:"el-icon-warning",style:"color:#E6A23C;font-size:24px;margin-right:15px"}),t("div",{style:"flex:1;padding-right:20px"},[t("div",{style:"margin-top:2px;"},[e.label||"确定要执行此操作吗？"]),e.content?"function"!=typeof e.content?t("div",{style:"margin-top:10px;"},[e.content||""]):t("div",{style:"margin-top:10px;"},[e.content(t)]):null])])}),textSubmit:e=>{let t=null;return{title:e.title||"提示",width:e.width||"400px",comp:{name:"sc-form",labelPosition:"top",mounted:(e,i)=>{t=i},renderColumns:[{prop:"input",label:e.label||e.title||"原因",required:e.required||!0,comp:{type:e.type||"textarea",rows:e.rows||4,maxlength:e.maxlength||200,showWordLimit:e.showWordLimit||!0}}]},confirm:async(i,s)=>{await t.validate(),e.submit(i,s.value.input)}}}},btn:{crud:{action:{},handleRow:{},toolbar:{},contextMenu:{}},form:{contextMenu:{}},dialog:{}},dicts:{}};var R=E;var T=i(548),M=i(792),j=i(343);function P(e,t,i,s,o={},r=!1){if(t){let n;if(delete i.presetType,"string"==typeof t){if(n=(o=Object.assign(o,Object(g.a)(R,e)))&&o[t],n){n=Object(m.a)(n)?n(i,s):Object(f.a)(n);const a=Object(f.a)(n);n.key="string"==typeof t?t:"",(i=r?Object(y.a)(i,n):Object(y.a)(n,i)).raw?i.raw=Object(y.a)(i.raw,a):i.raw=a,i.presetType&&(i=P(e,i.presetType,i,s,o,r))}}else n=t}return Array.isArray(i.children)&&i.children.length&&(i.children=A(e,i.children,s,o,r)),i}function A(e,t,i,s,o){const r=[];return Object(T.a)(t)&&Object.keys(t).forEach(n=>{if("handles"===n)r.push(...A(e,t[n],i,s));else if(Object(T.a)(t[n])||!0===t[n]){!0===t[n]&&(t[n]={});const a=P(e,n,t[n],i,s,o);Object(M.a)(a)||r.push(a)}}),Object(j.a)(t)&&t.forEach(t=>{if(Object(T.a)(t)){const n=P(e,t.presetType,t,i,s,o);Object(M.a)(n)||r.push(n)}else if("string"==typeof t){const n=P(e,t,{},i,s,o);Object(M.a)(n)?r.push(t):r.push(n)}else Object(M.a)(t)||r.push(t)}),r.sort((e,t)=>(e.order||0)-(t.order||0))}function B(e,t,i){if("string"==typeof t){let s=Object(g.a)(R,e);if(s=s&&s[t],s)return Object(m.a)(s)&&(s=s(i)),s}return t}function I(e){if(e instanceof Date||"boolean"==typeof e||"number"==typeof e)return!1;if(e instanceof Array)return 0===e.length||e.every(e=>I(e));if(e instanceof Object){for(var t in e)return!1;return!0}return"null"===e||null==e||"undefined"===e||void 0===e||""===e}function F(e){return e.indexOf("-")<0?e:e.split("-").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")}function N(e,t){return Array.isArray(e)?e.map(e=>(e.children&&(e.children=N(e.children,t)),e)).filter(e=>z(e,t,!0)):e}const V=e=>{if(!e&&0!==e)return"0";if("string"==typeof e&&e.endsWith("px"))return e;const t=parseFloat(e);return 0===t?"0":t+"px"};function z(e,t,i){const s=(i,s=!1)=>{const o="function"==typeof e[i]?e[i](t):e[i];return s?!o:o},o=[];return void 0!==e.hidden&&o.push(s("hidden",!0)),void 0!==e.innerHide&&o.push(s("innerHide",!0)),void 0!==e.show&&o.push(s("show")),o.length>0?o.every(e=>e):i}function L(e,t,i,...s){if(!e)return null;const o=Object(m.a)(e)?e(t,i,...s):e;return o?b(o)?o:t("span",[o]):void 0}function K(e,t={},i=null,s=""){return Array.isArray(e)?e.map(e=>{var o,r,n;if(!z(e,i,!0))return null;const a=e.per||e.hasPermi||e.key&&(null===(o=t.permission)||void 0===o?void 0:o[e.key]);if(a&&t.checkPermission&&!t.checkPermission(a))return null;if(null!==(r=e.children)&&void 0!==r&&r.length){const o=K(e.children,t,i,s);if(0===o.length)return null;e={...e,children:o}}return(null===(n=t.controlButton)||void 0===n?void 0:n.call(t,s,e,i))||e}).filter(Boolean):[]}function H(e,t,i=3,s="both"){if(!e)return;const o=Array.isArray(t)?t:[t],r=e=>o.includes(e),n=(e,t=0)=>{if(!e||t>=i)return;const s=e.$options.name;if(s&&r(s))return e;const o=e.$children||[];for(const e of o){const i=n(e,t+1);if(i)return i}},a=(e,t=0)=>{if(!e||t>=i)return;const s=e.$options.name;if(s&&r(s))return e;const o=e.$parent;return o?a(o,t+1):void 0},l=e.$options.name;if(l&&r(l))return e;if("both"===s||"down"===s){const t=n(e,0);if(t)return t}if("both"===s||"up"===s){const t=a(e,0);if(t)return t}}var Y=i(793);class q{constructor(e={},t={},i={}){this.excludeKeys=i.excludeKeys||[],this.defaultConfigs=e,this.globalConfigs=t}getPresetConfig(e){const t=e.presetType;return t?P("options",t,e):e}getDefaultConfig(e){return Object(f.a)(this.defaultConfigs[e])||{}}getGlobalConfig(e){return Object(f.a)({size:this.globalConfigs.size,checkPermission:this.globalConfigs.checkPermission||(()=>!0),...this.globalConfigs[e]})||{}}transformConfig(e,t){const i=Object(f.a)(e);if(this.excludeKeys.length>0&&this.excludeKeys.forEach(e=>{delete i[e]}),!t)return i;const s=(e,i)=>{for(const s of t)s(e,i,e[i]);const o=e[i];Object(T.a)(o)&&Object.keys(o).forEach(e=>{s(o,e,o[e])})};return Object.keys(i).forEach(e=>{s(i,e)}),i}mergeConfig(e={},t={}){const{type:i="",config:s={}}=t,o=this.getDefaultConfig(i)||s,r=this.getGlobalConfig(i)||{};e=this.getPresetConfig(e);const n=this.transformConfig(Object(y.a)({},r,e),o.transforms),a=this.applyDefaults(n,o.schema);return this.validateConfig(a,{schema:o.schema,strict:o.strict,ignoreKeys:o.ignoreKeys,type:i}),a}validateConfig(e,t={}){const{schema:i,strict:s,ignoreKeys:o,type:r}=t;if(s){const t=Object.keys(e).filter(e=>!i[e]&&!(o||[]).includes(e));t.length>0&&console.warn(`配置对象 ${r} 包含不存在的属性: ${t.join(", ")}`)}const n=(e,t,i="")=>{for(const[o,r]of Object.entries(t)){const t=Object(g.a)(e,o),a=i?`${i}.${o}`:o;let l=r;if(Object(T.a)(l)||(l={type:l}),null==t)l.required&&console.warn(`缺少必填配置项: "${a}"`);else{if(l.type){const e=Array.isArray(l.type)?l.type:[l.type];e.some(e=>e===Boolean?"boolean"==typeof t:e===Function?"function"==typeof t:e===Object?Object(T.a)(t):e===Array?Array.isArray(t):e===String?"string"==typeof t:e===Number?"number"==typeof t:e===Promise?t instanceof Promise:e===RegExp?t instanceof RegExp:e===Date&&t instanceof Date)||console.warn(`配置项 "${a.replace(/\.arrayOf/g,"")}" 类型错误: 期望类型为 ${e.map(e=>e.name).join("|")}, 实际类型为 ${s=t,Object.prototype.toString.call(s).match(/\s([a-zA-Z]+)/)[1]}, 值为 ${t}`)}if(l.arrayOf&&Array.isArray(t)&&t.forEach((e,i)=>{const s=`${a}[${i}]`;if(Object(T.a)(l.arrayOf)&&n({arrayOf:e},{arrayOf:l.arrayOf},s),Object(m.a)(l.arrayOf.validate))try{l.arrayOf.validate(e)}catch(e){console.warn(`数组项 "${s}" 验证失败: ${e.message}, 值为 ${t}`)}}),l.enum&&"string"==typeof t&&!l.enum.includes(t)&&console.warn(`配置项 "${a}" 的值无效: 必须是 ${l.enum.join(", ")}, 当前值为 ${t}`),l.validator&&!l.validator(t)&&console.warn(`配置项 "${a}" 验证失败, 值为 ${t}`),l.properties&&Object(T.a)(t)){if(l.strict){const e=Object.keys(t).filter(e=>!l.properties[e]&&!(l.ignoreKeys||[]).includes(e));e.length>0&&console.warn(`配置项 "${a}" 包含不存在的属性: ${e.join(", ")}}`)}n(t,l.properties,a)}}}var s};n(e,i)}applyDefaults(e,t){const i=Object(f.a)(e),s=(e,t,o="")=>{for(const[r,n]of Object.entries(t)){const t=o?`${o}.${r}`:r,a=Object(g.a)(e,r);let l=n;if(Object(T.a)(l)||(l={type:l}),l.default)if(void 0===a){const e=Object(m.a)(n.default)?n.default():n.default;e&&Object(Y.a)(i,t,e)}else if(Object(T.a)(a)){const e=Object(m.a)(n.default)?n.default():n.default;Object(T.a)(e)&&e&&Object(Y.a)(i,t,Object(y.a)({},e,a))}if(l.type){(Array.isArray(l.type)?l.type:[l.type]).includes(Boolean)&&""===a&&Object(Y.a)(i,t,!0)}if(l.properties){const e=Object(g.a)(i,t)||{};Object(T.a)(e)&&s(e,l.properties,t)}}};return s(e,t),i}}let W=null;var G=(e,t)=>W||(W=new q(e,t),W),U=()=>W,J=(e,t)=>({props:{scope:{},options:{type:Object,default:()=>({})},renderColumns:{type:[Array,Function],default:()=>[]}},data(){return{attrs:this.$attrs}},watch:{$attrs(e){Object(p.a)(e,this.attrs,(e,t)=>{if("function"==typeof e&&"function"==typeof t)return e.toString()===t.toString()})||(this.attrs=e)}},computed:{initColumns(){const e=this.options.renderColumns||this.renderColumns;return Object(m.a)(e)?e():e},resultOptions(){return U().mergeConfig(Object.assign(this.getUserOptions(),{renderColumns:this.initColumns}),{type:e})},resultColumns(){return this.resultOptions.renderColumns&&Array.isArray(this.resultOptions.renderColumns)?Object(f.a)(this.resultOptions.renderColumns).map(this.handleInitColumn).sort((e,t)=>e.order-t.order):[]}},methods:{getUserOptions(){let e=t||this.options;return e=Object(f.a)(e),e.size=e.size||(this.$ELEMENT||{}).size,this.convertKeysToCamelCase(Object.assign(e,this.attrs))},handleInitColumn(e,t){let i={...e};i.presetType&&(i=P("render",i.presetType,i));const s=Object(g.a)(i,"formatData.type")||i.formatData;return"string"==typeof s&&(i.formatData=Object.assign({},i.formatData,B("formatData",s,i))),i.prop||(i.prop="prop_"+t),this.resultOptions.allColumn&&(i=Object(y.a)(Object(f.a)(this.resultOptions.allColumn),i)),this.initColumn&&this.initColumn(i,t),i.children&&(i.children=i.children.map(this.handleInitColumn)),i},extendMethod(e,t=[]){const i=Object.entries(e);for(const[e,s]of i)e.includes("$")||e.includes("_")||!Object(m.a)(s)||this[e]||t.includes(e)||(this[e]=s)},convertKeysToCamelCase(e){const t={};for(const i in e)if(e.hasOwnProperty(i)){t[i.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace("-","").replace("_",""))]=e[i]}return t}}}),X=i(800),Z={methods:{runBefore:Object(X.a)((async function(e,t,...i){let s;"string"==typeof e&&(e=[e]);const o=e.map((e,t)=>{const o=e;return this.$listeners[o]?new Promise(e=>{this.$emit(o,t=>{t&&(s=t),e()},...i)}):Promise.resolve()});await Promise.all(o),t(s)}),2),runAfter(e,t,i){"string"==typeof e&&(e=[e]),e.forEach(e=>{e+="After",this.$listeners[e]&&this.$nextTick(()=>{i&&"function"==typeof i?(t={...t,...i()},this.$emit(e,t)):this.$emit(e,t)})})}}},Q={methods:{getByProp:(e,t)=>t?Object(g.a)(e,t):e,setByProp(e,t,i){if(!t)return;const s=Array.isArray(t)?t:t.split(".");if(s.length>1)if(Object(g.a)(e,s))Object(Y.a)(e,s,i),this.$set(e,s[0],e[s[0]]);else{s.slice(0,-1).reduce((e,t,i)=>(e[t]&&"object"==typeof e[t]||this.$set(e,t,{}),e[t]),e);const t=s.slice(0,-1).reduce((e,t)=>e[t],e);this.$set(t,s[s.length-1],i)}else this.$set(e,t,i)}}};function ee(e,t){const i=function(e={},t,i){return Object.keys(i?Object(w.a)(e,i):e).forEach(i=>{Object(m.a)(e[i])&&(e[i]=e[i](t))}),e}({required:e.required,regular:e.regular,limit:e.limit,rules:e.rules},t),s=[],o=[];if(i.required){const t=function(e,t){return P("rules","required",e,{item:t})}(i.required,e);s.push(t),s.required=!0}if(i.limit&&s.push(function([e,t]){return{min:e,max:t,message:e===t?`请输入 ${e} 个字符`:`请输入 ${e} 到 ${t} 个字符`,trigger:"change"}}(i.limit)),i.regular){const r=function(e,t,i,s){const o=A("rules",e,{item:t});return s.push(...o),te(o,i)}(i.regular,e,t,o);s.push(...r)}if(i.rules){const r=function(e,t,i,s){const o=A("rules",e,{item:t});return s.push(...o),te(o,i)}(i.rules,e,t,o);s.push(...r)}return{rules:s,rawRules:o}}function te(e,t){return e.map(e=>{if(e.regular&&e.msg)return{validator:(t,i,s)=>{!i||e.regular.test(i)?s():s(new Error(e.msg))},trigger:e.trigger||"change",message:e.msg};if(e.validator){const i=e.validator;return{...e,validator:(...e)=>{i(...e.slice(0,3),t)}}}return e})}var ie=a({name:"position",props:{inline:{type:Boolean,default:!0},slotName:String,slotSuffixes:{type:Array,default:()=>[]},render:Function,slots:{type:Object,default:()=>({})},scope:{},ellipsis:Boolean},computed:{slotNames(){if(!this.slotName)return;if(!this.slotSuffixes.length)return this.slotName;const e=this.slotSuffixes.filter(Boolean).join("-");return e?`${this.slotName}-${e}`:this.slotName},leftSlot(){return this.slots[this.slotNames+"-left"]||this.$scopedSlots.left},rightSlot(){return this.slots[this.slotNames+"-right"]||this.$scopedSlots.right},topSlot(){return this.slots[this.slotNames+"-top"]||this.$scopedSlots.top},bottomSlot(){return this.slots[this.slotNames+"-bottom"]||this.$scopedSlots.bottom},hasPosition(){return this.topSlot||this.bottomSlot||this.leftSlot||this.rightSlot},contentStyle(){return this.ellipsis?{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}:{}},gridStyle(){const e=[];this.topSlot&&e.push('"top top top"');const t=[this.leftSlot?"left":".","content",this.rightSlot?"right":"."].join(" ");e.push(`"${t}"`),this.bottomSlot&&e.push('"bottom bottom bottom"');const i=[this.leftSlot?"auto":"0","1fr",this.rightSlot?"auto":"0"].join(" ");return{display:this.inline?"inline-grid":"grid","grid-template-areas":e.join("\n"),"grid-template-columns":i,"align-items":"center"}}},render(e){const t=(()=>this.slots[""+this.slotNames]?this.slots[""+this.slotNames](this.scope):this.render?L(this.render,e,this.scope):this.$scopedSlots.default?this.$scopedSlots.default(this.scope):void 0)();return t||this.topSlot||this.leftSlot||this.rightSlot||this.bottomSlot?e("div",{class:[this.b([this.slotNames||"position"])],style:this.gridStyle},[this.topSlot&&e("div",{class:"top"},[this.topSlot(this.scope)]),this.leftSlot&&e("div",{class:"left"},[this.leftSlot(this.scope)]),t&&e("div",{class:"content",style:this.contentStyle},[t]),this.rightSlot&&e("div",{class:"right"},[this.rightSlot(this.scope)]),this.bottomSlot&&e("div",{class:"bottom"},[this.bottomSlot(this.scope)])]):null}}),se=i(2),oe=Object(se.a)(ie,void 0,void 0,!1,null,null,null).exports,re=i(975),ne=i(795),ae=i(796),le=i(0);var ce=class{constructor(e={}){this.valueKey=e.valueKey||"id",this.editingRows=new Map,this.currentEditCell=null,this.columns=e.columns||[],this.mode=e.mode,this.trigger=e.trigger,this.isRowEdit=e.isRowEdit,this.exclusive=e.exclusive||!1,this._internalIdCounter=1,this.eventBus=new le.default}on(e,t){this.eventBus.$on(e,t)}off(e,t){this.eventBus.$off(e,t)}validateEdit(e,t,i){if(!t||!e)return!1;const{row:s,$index:o}=t;if(!s)return!1;const r=this.getRowEditInfo(s),n=r.type||"edit";return!1!==e[n]&&("cell"===this.mode?!!this.isCellEditing(s,e.prop)&&n:"row"===this.mode?!!r.isEditing&&n:"free"===this.mode&&n)}getRowKey(e){const t=e[this.valueKey];if(t)return t;if(e._internalId)return e._internalId;const i="internalId_"+this._internalIdCounter++;return Object.defineProperty(e,"_internalId",{value:i,enumerable:!1,configurable:!0}),i}setRowEditStatus(e,t,i="edit",{addType:s,prop:o,oldRow:r}={}){const n=this.getRowKey(e),a=this.getRowEditInfo(e);if(this.isRowEdit){if(!1===this.isRowEdit({row:e,$index:e.$index}))return}if(t){if(a.isEditing&&a.type===i)return;this.exclusive&&"row"===this.mode&&"edit"===i&&this.clearOtherEditingRows(n),this.editingRows.set(n,{type:i,data:r||Object(f.a)(e),row:e,addType:s})}else this.editingRows.delete(n);this.notifyEditStatusChange({isEditing:t,mode:"row",rowKey:n,row:e,prop:o,type:i}),this.isSetting()}clearOtherEditingRows(e){for(const[i,s]of this.editingRows.entries()){var t;if("add"===s.type||i===e)continue;const o=s.row;this.notifyEditStatusChange({isEditing:!1,mode:this.mode,rowKey:i,row:o,prop:null===(t=this.currentEditCell)||void 0===t?void 0:t.prop,type:s.type}),this.editingRows.delete(i)}}setCellEditStatus(e,t){const i=this.getRowKey(e);if(!this.isCellEditing(e,t)){if(this.isRowEdit){if(!1===this.isRowEdit({row:e,$index:e.$index}))return}this.currentEditCell={rowKey:i,prop:t,row:e},this.notifyEditStatusChange({isEditing:!0,mode:"cell",rowKey:i,row:e,prop:t,type:"edit"}),this.isSetting()}}isSetting(){this._isSetting=!0,setTimeout(()=>{this._isSetting=!1},50)}isRowEditing(e){const t=this.getRowKey(e);return t&&this.editingRows.has(t)}getRowEditInfo(e){const t=this.getRowKey(e),i=this.editingRows.get(t);return i?{isEditing:!0,data:i.data,row:i.row,type:i.type}:{isEditing:!1,data:null,type:null}}getEditingCell(){return this.currentEditCell}isCellEditing(e,t){const i=this.getRowKey(e);return i&&this.currentEditCell&&this.currentEditCell.rowKey===i&&this.currentEditCell.prop===t}hasEditingRows(){return this.editingRows.size>0}getEditingRowKeys(){return Array.from(this.editingRows.keys())}clearAllEditStatus(){if(this._isSetting)return;Array.from(this.editingRows.entries()).forEach(([e,t])=>{var i;const s=t.row;this.notifyEditStatusChange({isEditing:!1,mode:this.mode,rowKey:e,row:s,prop:null===(i=this.currentEditCell)||void 0===i?void 0:i.prop,type:t.type})}),this.editingRows.clear(),this.currentEditCell&&this.notifyEditStatusChange({isEditing:!1,mode:"cell",rowKey:this.currentEditCell.rowKey,row:this.currentEditCell.row,prop:this.currentEditCell.prop,type:"edit"}),this.currentEditCell=null,this._internalIdCounter=1}notifyEditStatusChange({isEditing:e,mode:t,rowKey:i,row:s,prop:o,type:r}){this.eventBus.$emit("edit-status-change",{isEditing:e,mode:t,rowKey:i,row:s,prop:o,type:r})}getAddedRows(){const e=[];return this.editingRows.forEach((t,i)=>{"add"===t.type&&e.push(t)}),e}getEditingRows(){return Array.from(this.editingRows.values())}};function he(e,t,i="children",s=""){if(!Array.isArray(e))return null;for(let o=0;o<e.length;o++){const r=e[o],n=s?`${s}.${o}`:""+o;if(t(r))return n;if(r[i]&&Array.isArray(r[i])){const e=he(r[i],t,i,`${n}.${i}`);if(e)return e}}return null}var de={data:()=>({editState:null,_documentClickHandler:null}),created(){},watch:{editConfig:{handler(e,t){Object(ne.a)(e,t)||(this.initEditState(),this.updateEditState(),this.bindTriggerEvent(),e&&t&&this.transformData())},immediate:!0}},destroyed(){this._documentClickHandler&&document.removeEventListener("click",this._documentClickHandler)},computed:{editConfig(){return this.processEditConfig()},noSaveEditMap(){if(0!==this.noSaveEditList.length)return this.noSaveEditList.reduce((e,t)=>(e[t[this.valueKey]]=t,e),{})},isTriggerEdit(){return["row","cell"].includes(this.editConfig.mode)}},methods:{initEditState(){const{mode:e,isRowEdit:t,exclusive:i,trigger:s}=this.editConfig;this.editState||(this.editState=new ce({valueKey:this.valueKey,columns:this.trueRenderColumns,mode:e,isRowEdit:t,exclusive:i||"click"===s||"dblclick"===s}),this.editState.on("edit-status-change",({isEditing:e,mode:t,rowKey:i,row:s,prop:o,type:r})=>{s.$edit=e,o&&this.editConfig.autofocus&&(o="string"==typeof this.editConfig.autofocus?this.editConfig.autofocus:o,setTimeout(()=>{this.focusInput(i,o)},100)),this.$emit("editStatusChange",{mode:t,rowKey:i,row:s,prop:o,type:r})}))},updateEditState(){if(!this.editState)return;const{mode:e,isRowEdit:t,exclusive:i,trigger:s}=this.editConfig;this.editState.mode=e,this.editState.exclusive=i||"click"===s||"dblclick"===s,this.editState.isRowEdit=t,this.editState.trigger=s},processEditConfig(){const{isRowEdit:e,addBtn:t,editBtn:i,viewBtn:s,rowAddBtn:o,footerAddBtn:r,batchDeleteBtn:n,deleteBtn:a}=this.crudOptions,l={...this.crudOptions.editConfig};"dialog"!==l.mode&&(l.rowAdd=l.add,delete l.add,l.rowEdit=l.edit,delete l.edit);const c={...l,add:t||l.add,edit:i||l.edit,view:s||l.view,rowAdd:o||l.rowAdd,lastAdd:r||l.lastAdd,batchDelete:n||l.batchDelete,delete:a||l.delete,isRowEdit:l.isRowEdit||e};return this.crudOptions.freeEdit&&(c.mode="free"),this.crudOptions.cellEdit&&(c.mode="cell"),this.crudOptions.rowEdit&&(c.mode="row",c.rowEdit=c.rowEdit||{}),this.crudOptions.batchEdit&&(c.mode="row",c.batch=c.batch||{}),this.crudOptions.batchRowEdit&&(c.mode="row",c.rowEdit=c.rowEdit||{},c.batch=c.batch||{}),"cell"!==c.mode||"manual"!==c.trigger&&c.trigger||(c.trigger="dblclick"),"row"===c.mode&&"manual"===c.trigger&&void 0===c.rowEdit&&(c.rowEdit={}),c},disabledRowEdit(e){const t=this.editConfig.isRowEdit;return void 0!==t&&Object(m.a)(t)&&!1===t(e)},validateEditMode(e){return!this.editConfig.disabled&&(e?this.editConfig.mode===e:this.editConfig.mode)},validateEdit(e={},t={}){if(!e.isEdit&&!this.editConfig.mode)return!1;const i="function"==typeof e.isEdit?e.isEdit(t):e.isEdit;return!1!==i&&!this.editConfig.disabled&&(this.editConfig.mode?this._runWithoutDeps(()=>this.editState.validateEdit(e,t,i)):!!i&&"edit")},handleRowAdd(e,t,i){t=t||this.crudOptions.rowAddType||"last";let s={$add:!0,$edit:!0};this.isTree&&(s[this.valueKey]="new_"+Object(ae.a)()),this.initRow(s),this.runBefore(["add"],o=>{s=Object.assign(s,o,e),i?(s.$parentId=i[this.valueKey],s.$parent=i,s.$level=i.level+1,i[this.childrenKey]||this.$set(i,this.childrenKey,[]),s.$parent=i,"first"===t?i[this.childrenKey].unshift(s):i[this.childrenKey].push(s)):"first"===t?this.list.unshift(s):this.list.push(s),this.editState.setRowEditStatus(s,!0,"row"===this.editConfig.mode?"add":"edit",{addType:t}),setTimeout(()=>{this.$refs.tableFormRef.clearValidate()},0)},{row:s,parentRow:i})},handleRowEdit(e,t){const i=Object(f.a)(e.row);this.runBefore(["edit"],s=>{if(s)for(const t in s)e.row[t]=s[t];this.editState.setRowEditStatus(e.row,!0,"edit",{prop:t,oldRow:i})},e)},handleRowClick(e,t,i){if(this.validateEditMode("row")&&this.editConfig.trigger===i){var s;if(this.editState.isRowEditing(e.row))return;const i=null===(s=this.editState.getEditingRows()[0])||void 0===s?void 0:s.row;i?this.handleRowSave({row:i,$index:i.$index},()=>{this.handleRowEdit(e,t)}):this.handleRowEdit(e,t),this._isClick=!0,setTimeout(()=>{this._isClick=!1},0)}},handleBatchRowEdit(){this.runBefore(["batchEdit"],e=>{var t;const i=null!==(t=this.editConfig.batch)&&void 0!==t&&t.isSelect?this.selectionRow:e||this.list;if(this.isTree){const e=[],t=i=>{i.forEach(i=>{e.push(i),i[this.childrenKey]&&i[this.childrenKey].length>0&&t(i[this.childrenKey])})};t(i),e.forEach(e=>{this.editState.setRowEditStatus(e,!0,"edit",{oldRow:Object(f.a)(e)})})}else i.forEach((e,t)=>{this.editState.setRowEditStatus(e,!0,"edit",{oldRow:Object(f.a)(e)})})})},handleRowSave(e,t){this.validateField({row:e.row}).then(()=>{this.changeLoading(!0);this.runBefore(["save"],i=>{if(i)for(const t in i)e.row[t]=i[t];this.editState.setRowEditStatus(e.row,!1),this.changeLoading(),t&&t()},e,this.changeLoading)})},handleBatchRowSave(e,t){this.validate().then(()=>{const i=this.editState.getEditingRows().map(e=>e.row);this.changeLoading(!0);this.runBefore(["batchSave"],s=>{var o;if(this.isTree){const e=t=>{t.forEach(t=>{if(this.editState.isRowEditing(t)){if(t.$parent){const e=this.getNodeIndex(t);if(-1!==e&&s){const i=s.find(e=>e[this.valueKey]===t[this.valueKey]);i&&this.$set(t.$parent[this.childrenKey],e,i)}}this.editState.setRowEditStatus(t,!1)}t[this.childrenKey]&&t[this.childrenKey].length>0&&e(t[this.childrenKey])})};e(t||this.list)}else(t||s||i).forEach(e=>{this.editState.setRowEditStatus(e,!1)});e(),this.changeLoading(),null!==(o=this.editConfig.batch)&&void 0!==o&&o.isSelect&&this.clearSelection()},i,this.changeLoading)})},handleRowCancel(e){this.runBefore(["cancel"],()=>{var t;const i=this.editState.getRowEditInfo(e.row);if("add"===(null==i?void 0:i.type))if(e.row.$parent){const t=this.getNodeIndex(e.row);-1!==t&&e.row.$parent[this.childrenKey].splice(t,1)}else{const t=this.list.indexOf(e.row);-1!==t&&this.list.splice(t,1)}else if(null!=i&&i.data)if(e.row.$parent){const t=this.getNodeIndex(e.row);-1!==t&&this.$set(e.row.$parent[this.childrenKey],t,i.data)}else Object.keys(i.data).forEach(t=>{t!==this.childrenKey&&this.$set(e.row,t,i.data[t])});this.editState.setRowEditStatus(e.row,!1),this.clearErrorMsg(e.row,null===(t=e.column)||void 0===t?void 0:t.property)},e)},handleBatchRowCancel(e){this.runBefore(["batchCancel"],t=>{var i;const s=e=>{e.forEach((t,i)=>{if(this.editState.isRowEditing(t)){const s=this.editState.getRowEditInfo(t);if(null!=s&&s.data){let o=[];t[this.childrenKey]&&(o=[...t[this.childrenKey]]),this.$set(e,i,s.data),o.length>0&&this.$set(e[i],this.childrenKey,o)}this.editState.setRowEditStatus(t,!1)}t[this.childrenKey]&&t[this.childrenKey].length>0&&s(t[this.childrenKey])})};s(e||t||this.list),null!==(i=this.editConfig.batch)&&void 0!==i&&i.isSelect&&this.clearSelection()})},handleBatchDelete(){if(0===this.selectionRow.length)return this.$message.warning("请选择要删除的数据");(()=>{this.changeLoading(!0);this.callDeleteApi(this.selectionRow),this.runBefore(["batchDelete"],()=>{this.selectionRow.sort((e,t)=>t.$index-e.$index).forEach(e=>{if(e.$parent){const t=e.$parent[this.childrenKey]||[],i=t.indexOf(e);-1!==i&&t.splice(i,1)}else{const t=this.list.indexOf(e);this.list.splice(t,1)}}),this.changeLoading()},this.selectionRow,this.changeLoading)})()},handleDelete(e){(()=>{this.changeLoading(!0);this.callDeleteApi(e.row),this.runBefore(["delete"],()=>{if(e.row.$parent){const t=this.getNodeIndex(e.row);-1!==t&&e.row.$parent[this.childrenKey].splice(t,1)}else this.list.splice(e.$index,1);this.changeLoading()},e,this.changeLoading)})()},handleCellEdit(e,t){if(!this.validateEditMode("cell"))return;const i="function"==typeof t.isEdit?t.isEdit(e):t.isEdit;void 0===t.isEdit||i?this.runBefore(["edit"],i=>{this.editState.setCellEditStatus(e.row,t.prop),i&&this.$set(this.list[e.$index],t.prop,i)},e,t):this.$message.warning("当前单元格不允许编辑")},handleCellClick(e,t,i){if(this.validateEditMode("cell")&&this.editConfig.trigger===i){if(this.editState.isCellEditing(e.row,t.prop))return;const i=this.editState.getEditingCell();i?this.handleCellSave({row:i.row,$index:i.row.$index},t,()=>{this.handleCellEdit(e,t)}):this.handleCellEdit(e,t),this._isCellClick=!0,setTimeout(()=>{this._isCellClick=!1},0)}},handleCellSave(e,t,i){this.validateField({row:e.row}).then(()=>{this.changeLoading(!0);this.runBefore(["save"],s=>{s&&this.$set(e.row,t.prop,s),this.editState.clearAllEditStatus(),this.changeLoading(),i&&i()},e.row[t.prop],e,t,this.changeLoading)})},isClickInTableCell(e){for(;e&&e!==this.$el;){if("td"===e.tagName.toLowerCase()&&e.classList.contains("el-table__cell"))return!0;e=e.parentElement}return!1},isClickInputClear:e=>e.classList.contains("el-input__clear")||e.classList.contains("el-icon-circle-close")||e.parentElement&&(e.parentElement.classList.contains("el-input__clear")||e.parentElement.classList.contains("el-icon-circle-close")),bindTriggerEvent(){this._documentClickHandler||this.$nextTick(()=>{!this.validateEditMode()||"click"!==this.editConfig.trigger&&"dblclick"!==this.editConfig.trigger||(this._documentClickHandler=e=>{const t=e.target,i=this.isClickInTableCell(t),s=this.isClickInputClear(t);if(!i&&!s&&!this._isClick)if(this.validateEditMode("row")){var o;const e=null===(o=this.editState.getEditingRows()[0])||void 0===o?void 0:o.row;if(e){const t={row:e,$index:e.$index};this.handleRowSave(t,()=>{this.editState.clearOtherEditingRows()})}else this.editState.clearOtherEditingRows()}else if(this.validateEditMode("cell")){const e=this.editState.getEditingCell();e?this.handleCellSave({row:e.row,$index:e.row.$index},e.prop,()=>{this.editState.clearAllEditStatus()}):this.editState.clearAllEditStatus()}},document.addEventListener("click",this._documentClickHandler))})},focusInput(e,t){const i=this.$el.querySelector(".el-table__body").querySelector(`[data-row-key="${e}"][data-prop="${t}"]`);i&&function(e,t=!1){if(!e)return!1;const i=[".el-cascader .el-cascader__label, .el-cascader .el-input__inner",".el-select .el-input__inner",".el-date-editor.el-input__inner",".el-time-picker.el-input__inner",".el-color-picker .el-color-picker__trigger"].join(","),s=e.querySelector(i);if(s)return s.click(),!0;const o=e.querySelector(".el-rate .el-rate__item:not(.is-disabled)");if(o)return o.focus(),!0;const r=e.querySelector('\n    input:not([type="hidden"]):not([readonly]):not([disabled]),\n    textarea:not([readonly]):not([disabled]),\n    [tabindex]:not([tabindex="-1"]):not([disabled])\n  ');if(r){r.focus();return t&&"input"===r.tagName.toLowerCase()&&["text","number","password","search","email","tel","url"].includes(r.type)&&r.select(),!0}}(i)},handleLastAdd(){this.validateEditMode("dialog")?this.handleAdd((this.editConfig.lastAdd||{}).addType||"last"):this.handleRowAdd({},(this.editConfig.lastAdd||{}).addType||"last")},getNodeIndex(e){if(!e.$parent)return null;return(e.$parent[this.childrenKey]||[]).indexOf(e)}}},ue=i(977),pe=i(485),me={data:()=>({errorContent:"",errorMap:new Map}),created(){this.activateTooltip=Object(ue.a)(e=>e.handleShowPopper(),50)},methods:{handleValidateError(e,t,i,s=!0,o=!0){const r=this.$el.querySelector(".el-table__body").querySelector(e?`[data-full-prop="${t}"][data-row-key="${e}"]`:`[data-full-prop="${t}"]`);if(!r)return;let n=r.closest(".el-table__cell");n&&(s?(n.classList.remove("error-badge"),this.errorMap.delete(t),o&&this.cellMouseLeave()):(n.classList.add("error-badge"),this.errorMap.set(t,i),o&&this.showErrorTooltip(r)))},createListError(e,t,i){this.handleValidateError(null,e,i,t)},clearErrorMsg(e,t){const i="list."+he(this.list,t=>t===e,this.childrenKey)+"."+t;this.handleValidateError(null,i,"",!0)},triggerValidateTooltip(e,t,i,s){const o=i.querySelector("[data-full-prop]");o&&this.showErrorTooltip(o)},showErrorTooltip(e){if(this._manualValidate)return;const t=e.getAttribute("data-full-prop");this.errorContent=this.errorMap.get(t);const i=this.$refs.tooltip;i.referenceElm=e,i.$refs.popper&&(i.$refs.popper.style.display="none"),i.doDestroy(),this.errorContent&&(i.setExpectedState(!0),this.activateTooltip(i))},removeValidateTooltip(){const e=this.$refs.tooltip;e&&(e.setExpectedState(!1),e.handleClosePopper())},validate(e){return this._manualValidate=!0,new Promise((t,i)=>{this.$refs.tableFormRef.validate((s,o)=>{if(s)e&&e(this.list),t({list:this.list});else if(i(o),Object.keys(o).length){this.tbodyWrapEl=this.$el.querySelector(".el-table__body-wrapper"),this.tbodyEl=this.tbodyWrapEl.querySelector("tbody");if(this.tbodyEl.childNodes[Object.keys(o)[0].split(".")[1]].scrollIntoView({behavior:"smooth",block:"center"}),this.crudOptions.validateMsg&&this.errorMap.size){const e=Array.from(this.errorMap.keys())[0],t=this.errorMap.get(e);t&&this.$message.error(t)}}setTimeout(()=>{this._manualValidate=!1},0)})})},validateField(e){this._manualValidate=!0,setTimeout(()=>{this._manualValidate=!1},0);const t="number"==typeof e?{index:e}:e;return this._validateField(t)},_validateField(e={}){return new Promise((t,i)=>{const{index:s,id:o,row:r,prop:n}=e;let a=null;if(void 0!==s?a="list."+s:o?a="list."+he(this.list,e=>e[this.valueKey]===o,this.childrenKey):r&&(a="list."+he(this.list,e=>e===r,this.childrenKey)),!a)return void console.error(new Error("未找到目标行"));const l=this.$refs.tableFormRef.fields.filter(e=>{const t=e.prop.split(".");return n?e.prop===`${a}.${n}`:t.slice(0,-1).join(".")===a});if(0===l.length)return void t();const c=[],h=[],d=l.map(e=>new Promise(t=>{e.validate("",i=>{i?(c.push(!1),h.push({field:e.prop.split(".").pop(),message:i})):c.push(!0),t()})}));Promise.all(d).then(()=>{c.every(e=>e)?t({valid:!0,path:a}):i({valid:!1,path:a,errors:h})})})},clearValidate(){this.$refs.tableFormRef.clearValidate(),this.errorMap.clear(),this.errorContent="";(this.$el.querySelector(".el-table__body").querySelectorAll(".error-badge")||[]).forEach(e=>{e.classList.remove("error-badge")})},async validateAll({mode:e="all",maxShow:t=20}={}){this.crudOptions.localSearch&&this.handleReset();const i=[],s=this.childrenKey||"children";let o=null;const r=async(t,n=[])=>{for(let a=0;a<t.length;a++){const l=t[a],c=[...n,a];for(const t of this.trueRenderColumns){const s=t.form||t,{rules:r}=ee(s,{row:l});if((!r||0===r.length)&&void 0===s.required)continue;r&&r.length>0&&r.forEach(e=>delete e.trigger);const n={[s.prop]:r},a=new pe.default(n),h={[s.prop]:Object(g.a)(l,s.prop)};await a.validate(h,{firstFields:!0},t=>{if(!t)return Promise.resolve();const r=c.join("."),n=`list.${r}.${s.prop}`;this.handleValidateError(l[this.valueKey],n,t[0].message,!1,!1);const a=`第${c.map(e=>e+1).join("-")}行【${s.label||s.prop}】：${t[0].message}`;if(o||(o=n),"first"===e)throw this.$message.error(a),{path:r,prop:s.prop,message:a};i.push({path:r,prop:s.prop,fullProp:n,message:a})})}Array.isArray(l[s])&&l[s].length>0&&await r(l[s],[...c,s])}};try{await r(this.data)}catch(e){if(o){const e=this.$el.querySelector(".el-table__body").querySelector(`[data-full-prop="${o}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}if(i.length){const e=i.slice(0,t).map(e=>e.message).join("<br/>"),s=i.length>t?`<div style="color:#f56c6c;margin-top:8px;">共${i.length}条错误</div>`:"";this.$alert(`<div style="max-height:300px;overflow:auto;">${e}</div>${s}`,(this.crudOptions.validateTitle||this.crudOptions.title||"表格")+"校验错误",{dangerouslyUseHTMLString:!0})}return Promise.reject(i.length?i:e)}if(o){const e=this.$el.querySelector(".el-table__body").querySelector(`[data-full-prop="${o}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}if(i.length){let e=i.slice(0,t).map(e=>e.message);i.length>t&&e.push("……");const s=e.join("<br/>"),o=i.length>t?`<div style="color:#f56c6c;margin-top:8px;">共${i.length}条错误</div>`:"";return this.$alert(`<div style="max-height:300px;overflow:auto;">${s}</div>${o}`,(this.crudOptions.validateTitle||this.crudOptions.title||"表格")+"校验错误",{dangerouslyUseHTMLString:!0,customClass:"sc-crud__validate-error-alert",showConfirmButton:!1}),Promise.reject(i)}return Promise.resolve()}}},fe={computed:{ctxMenu(){return this.crudOptions.contextMenu}},created(){this.buttonList=[]},methods:{contextMenuTemps(e,t,i){return{copy:{label:"复制内容",icon:"el-icon-document-copy",onClick:()=>{let t=function(t){t.clipboardData.setData("text/plain",e.event.target.innerText),t.preventDefault()};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t),this.$message.success("复制成功")}},mock:{label:"生成测试数据",icon:"el-icon-magic-stick",onClick:()=>{0===this.data.length&&(this.data.push({temp_mock:!0}),this._tempMock=!0),this.showMockDialog=!0}},clearMock:{label:"清除临时mock数据",icon:"el-icon-delete",hidden:!this.data.some(e=>e.$mock),onClick:()=>{this.clearMock()}},reset:{label:"重置",icon:"el-icon-refresh",hidden:i,onClick:()=>{this.reset()},divided:t}}},openContextMenu(e,t,i){if(!1===z(this.ctxMenu))return;const s=[],o={row:e,$index:e.$index,column:t,ctx:this,event:i},r=this.getActionButton(o);if(this.ctxMenu){let e=A("btn.crud.contextMenu",this.ctxMenu,o,this.contextMenuTemps(o,r.length,!1));e=this.checkHiddenButtons("contextMenu",e),s.push(...e)}this.ctxMenu.actionBtn&&s.push(...r),0!==s.length&&(i.preventDefault(),i.stopPropagation(),this.$contextmenu({items:s,event:i,minWidth:100}))},openContextHerderMenu(e,t){if(!1===z(this.ctxMenu))return;const i=[];if(this.ctxMenu){let e=A("btn.crud.contextMenu",this.ctxMenu,{},this.contextMenuTemps({event:t},0,!0));e=this.checkHiddenButtons("contextMenu",e),i.push(...e)}0!==i.length&&(t.preventDefault(),t.stopPropagation(),this.$contextmenu({items:i,event:t,minWidth:100}))},getActionButton(e){let t=this.buttonList[e.$index]||[];const i=this.$el.querySelectorAll(".sc-crud-action-column")[e.$index];return t.filter(({hidden:e,...t})=>{const s=i.querySelector(`button[label="${t.label}"]`);if(!s)return!1;return"none"!==window.getComputedStyle(s).display}).map(({hidden:t,...s})=>(s.children?s.children.forEach(t=>{const i=t.onClick;t.onClick=()=>{i&&i(e)}}):s.onClick=()=>{const e=i.querySelector(`button[label="${s.label}"]`);e&&e.click()},s))}}},ge=a({inheritAttrs:!1,name:"grid",props:{columns:{type:Number,default:1,validator:e=>e>0},autoFill:Boolean,fillCell:Boolean,columnWidth:{type:[String,Number,Array,Object]},gap:{type:[String,Number]},columnGap:{type:[String,Number]},rowGap:{type:[String,Number]},areas:{type:[String,Array]},minRowHeight:{type:[String,Number]},maxRowHeight:{type:[String,Number]},alignContent:{type:String,validator:e=>["start","end","center","stretch","space-around","space-between","space-evenly"].includes(e)},rows:{type:[Number,String],description:"行数或行模板字符串"},justifyContent:{type:String,validator:e=>["start","end","center","stretch","space-around","space-between","space-evenly"].includes(e)},flow:{type:String,validator:e=>["row","column","row dense","column dense"].includes(e)},height:{type:[String,Number],default:"auto"},gridStyle:{type:Object,default:()=>({})}},computed:{mergeStyle(){const e=this.gap?{columnGap:V(this.gap),rowGap:V(this.gap)}:{columnGap:this.columnGap?V(this.columnGap):void 0,rowGap:this.rowGap?V(this.rowGap):void 0};return{display:"grid",height:"number"==typeof this.height?V(this.height):this.height,gridAutoFlow:this.fillCell?"row dense":this.flow,gridAutoRows:this.autoRows(),gridTemplateRows:this.frGetter(this.rows),gridTemplateColumns:this.gridTemplateColumns,gridTemplateAreas:this.formatAreas(this.areas),justifyContent:this.justifyContent,alignContent:this.alignContent,...e,...this.$attrs,...this.gridStyle}},gridTemplateColumns(){if(this.autoFill){const e="300px",t=this.columnWidth||e;return`repeat(auto-fill, ${`minmax(${V(t)}, 1fr)`})`}return this.getFixedColumnsTemplate()}},methods:{getFixedColumnsTemplate(){return Array.isArray(this.columnWidth)?this.buildIndependentColumnsTemplate():this.buildUniformColumnsTemplate()},buildIndependentColumnsTemplate(){const e=[];for(let t=0;t<this.columns;t++){const i=this.columnWidth[t];i&&"1fr"!==i?"string"==typeof i||"number"==typeof i?e.push(V(i)):"object"==typeof i&&null!==i?e.push(this.buildColumnTemplate(i)):e.push("1fr"):e.push("1fr")}return e.join(" ")},buildColumnTemplate(e){const{width:t,min:i,max:s}=e;if(t&&!i&&!s)return V(t);if(i||s){return`minmax(${i?V(i):t?V(t):"auto"}, ${s?V(s):t?V(t):"1fr"})`}return t?V(t):"1fr"},buildUniformColumnsTemplate(){if("1fr"===this.columnWidth)return`repeat(${this.columns}, 1fr)`;if("object"==typeof this.columnWidth&&null!==this.columnWidth&&!Array.isArray(this.columnWidth)){const e=this.buildColumnTemplate(this.columnWidth);return`repeat(${this.columns}, ${e})`}return this.columnWidth?`repeat(${this.columns}, ${V(this.columnWidth)})`:`repeat(${this.columns}, 1fr)`},autoRows(){var e;return`minmax(${this.minRowHeight?V(this.minRowHeight):"auto"}, ${(e=this.maxRowHeight||"auto")||0===e?"number"==typeof e?0===e?"0":e+"px":"string"==typeof e&&e.endsWith("px")?e:"string"==typeof e&&/^\d+$/.test(e)?e+"px":e:"0"})`},frGetter(e){if(e)return"number"==typeof e?`repeat(${e}, 1fr)`:e},formatAreas(e){if(e)return"string"==typeof e?e:e.map(e=>`"${e}"`).join(" ")}}}),ye=Object(se.a)(ge,(function(){var e=this._self._c;this._self._setupProxy;return e("div",{class:this.b(),style:this.mergeStyle},[this._t("default")],2)}),[],!1,null,null,null).exports,be=a({inheritAttrs:!1,name:"cell",props:{widthSize:{type:[Number,String],default:1,validator:e=>Number(e)>0},heightSize:{type:[Number,String],default:1,validator:e=>Number(e)>0},area:{type:String},center:{type:Boolean},left:{type:[Number,String]},top:{type:[Number,String]},cellStyle:{type:Object,default:()=>({})}},computed:{mergeStyle(){return{height:"100%",minWidth:0,boxSizing:"border-box",...this.area?{gridArea:this.area||"auto"}:{gridColumnEnd:"span "+this.widthSize,gridRowEnd:"span "+this.heightSize,gridColumnStart:this.left,gridRowStart:this.top},...this.center?{textAlign:"center",...this.getCenterStyle()}:{},...this.$attrs,...this.cellStyle}}},methods:{getCenterStyle:()=>({display:"inline-flex",flexFlow:"column wrap",justifyContent:"center",justifySelf:"stretch"})}}),ve=Object(se.a)(be,(function(){var e=this._self._c;this._self._setupProxy;return e("div",{class:this.b(),style:this.mergeStyle},[this._t("default")],2)}),[],!1,null,null,null).exports;function we(e,t,i,s,o){const r={};return e&&Object.entries(e).forEach(([e,t])=>{r[e]=(...e)=>null==t?void 0:t(...e,i)}),Object.entries(t).filter(([e,t])=>/^on[A-Z]/.test(e)&&Object(m.a)(t)).forEach(([e,t])=>{const s=e.slice(2).toLowerCase();r[s]=(...e)=>null==t?void 0:t(...e,i)}),{...r,input:e=>{s.$value=e,r.input&&r.input(e)},change:e=>{s.$value=e,r.change&&r.change(e)},"hook:mounted":()=>{const e=s.$vnode.componentInstance.$children[0];o.mounted&&o.mounted(i,e),o.ref&&o.ref(i,e)}}}function xe(e,t,i,s){const o={},r={...e,...t};for(const e in r)o[e]=()=>r[e](i,s);return o}function Se(e,t,i){return e.placeholder?e.placeholder:"el-input"===t?"请输入"+i.item.label:"请选择"+i.item.label}function Ce(e){return void 0===e.clearable||e.clearable}function Oe(e,t,i){return e.size||t||(i||{}).size}function $e(e,t,i){if(!e)return null;if(Object(m.a)(e))if(2===e.length){if(b(e=e(t,i)))return e}else e=e(i);return Object(j.a)(e)?e.map(e=>Object(T.a)(e)?ke(t,{...e,comp:e,scope:i,isChildren:!0},parent):e):e}function _e(e,t,i){const s={...t,...i};return Object.keys(s).map(t=>e("i",{slot:t}))}function ke(e,t,i){const{name:s,comp:o,scope:r,isChildren:n,children:a,bind:l}=t;let c=o;Object(m.a)(l)?c={...o,...l(r)}:l&&(c={...o,...l});const h=function(e,t,i,s){return t||i?e:s.options&&!e?"sc-select":{"el-select":"sc-select","el-checkbox-group":"sc-checkbox","el-radio-group":"sc-radio","el-switch":"sc-switch","el-cascader":"sc-cascader"}[e]||e||"el-input"}(s,n,a,c);return t.created&&t.created(r),e(h,{props:{value:t.value||i.$value,scope:r},attrs:{...Object(w.a)(c,["name","prop","on","bind"]),size:Oe(c,t.size,i.$ELEMENT),placeholder:Se(c,h,r),clearable:Ce(c),disabled:!!c.disabled},on:we(t.on,c,r,i,t),nativeOn:t.nativeOn,scopedSlots:xe(t.scopedSlots,t.slots,e,r),directives:t.directives},[$e(a,e,r),..._e(e,t.scopedSlots,t.slots)])}var De={props:{dict:[Object,String,Function],scope:Object,prop:String},watch:{dictConfig:{immediate:!0,handler(e,t){e&&this.initLocalDict()}}},computed:{dictData(){if(this.dictConfig){if(Object(T.a)(this.dictConfig))return this.$scDict[this.getDictKey()];if("string"==typeof this.dictConfig)return this.$scDict[this.dictConfig]}},dictConfig(){return"function"==typeof this.dict?this.dict(this.scope):this.dict}},beforeDestroy(){var e;null!==(e=this.dictConfig)&&void 0!==e&&e.local&&this.$scDict.clear(this.getDictKey())},methods:{initLocalDict(){const e=this.dictConfig;if(Object(T.a)(e))if(e.local){const t=this.getDictKey();this.$scDict.register(t,{...e,params:"function"==typeof e.params?()=>e.params(this.scope):e.params,load:"function"==typeof e.load?()=>e.load(this.scope):e.load,immediate:!1,cache:!1})}else this.$scDict.register(this.getDictKey(),{...e,params:"function"==typeof e.params?()=>e.params(this.scope):e.params,load:"function"==typeof e.load?()=>e.load(this.scope):e.load})},getDictKey(){const e=this.dictConfig;return null!=e&&e.local?`${this._uid}_${(null==e?void 0:e.key)||this.prop}`:(null==e?void 0:e.key)||this.prop}}},Ee={name:"render",props:{value:{},prop:{type:String,default:""},comp:[Object,Function],render:Function,item:Object,raw:Object,slots:Object,mode:[String,Boolean],scope:{},size:String,controlDefault:Function,defaultRender:Function,position:Boolean,compStrategy:Array,commonCompStrategy:Object,defaultComp:Object,rawRules:Array,isWatchFormatValue:Boolean},inject:{controlCtx:{default:void 0},elForm:{default:""}},mixins:[De],computed:{$value:{get(){try{var e;const t=null===(e=this.item.formatData)||void 0===e?void 0:e.input;return t?t(this.getRow(),this.scope):this.getRow()}catch(e){return console.error("获取格式化值失败:",e),this.getRow()}},set(e){try{this.setFormatValue(e)}catch(t){console.error("设置格式化值失败:",t),this.setRow(this.prop,e)}}}},created(){this.compStrategy&&(this.matcher=this.createMatcher(this.compStrategy)),this.controlCtx&&this.initFormatValue(),this.item.formatData&&this.isWatchFormatValue&&setTimeout(()=>{this.isSettingValue=!1,this.$watch("value",e=>{this.isSettingValue||this.setFormatValue(this.$value)}),this.setFormatValue(this.$value)},0)},mounted(){this.item.ref&&"function"==typeof this.item.ref&&this.item.ref(this.$vnode.componentInstance)},methods:{initFormatValue(){this.item.formatData&&this.controlCtx.$on("dataChange",()=>{this.isSettingValue||this.setFormatValue(this.$value)})},getRow(){return this.prop?Object(g.a)(this.scope.row,this.prop):this.scope.row},setRow(e,t){if(!e)return;const i=Array.isArray(e)?e:e.split(".");if(i.length>1)if(Object(g.a)(this.scope.row,i))Object(Y.a)(this.scope.row,i,t),this.$set(this.scope.row,i[0],this.scope.row[i[0]]);else{i.slice(0,-1).reduce((e,t,i)=>(e[t]&&"object"==typeof e[t]||this.$set(e,t,{}),e[t]),this.scope.row);const e=i.slice(0,-1).reduce((e,t)=>e[t],this.scope.row);this.$set(e,i[i.length-1],t)}else this.$set(this.scope.row,e,t)},setFormatValue(e,t){var i;const s=null===(i=this.item.formatData)||void 0===i?void 0:i.output;if(s){this.isSettingValue=!0;const i=s(e,this.scope,this.setRow),o=Object(g.a)(this.item,["formatData","formatValue"]);if(o&&"string"==typeof o?this.setRow(o,e):o&&this.setRow("$"+this.prop,e),void 0!==i){if(t)return i;this.setRow(this.prop,i)}this.$nextTick(()=>{this.isSettingValue=!1})}else{if(t)return e;this.setRow(this.prop,e)}},interruptibleCompose:(...e)=>e.reduce((e,t)=>function(...i){var s=e.apply(this,i);return null!=s?s:t.apply(this,i)}),getSlot(e,t){const i=this.slots,s=this.prop,o=this.mode;if(Object(m.a)(i)&&(i=i()),i){let e;s&&o?e=`${s}-${o}`:s&&!o?e=s:!s&&o&&(e=o);const r=i[e];if(r)return r(t)}},getRender(e,t){return L(this.render,e,t)},mergeFunctionAndObject:(e,t,i)=>t?Object(m.a)(e)&&Object(m.a)(t)?Object.assign(t(i),e(i)):Object(m.a)(e)&&Object(T.a)(t)?Object.assign(t,e(i)):Object(T.a)(e)&&Object(m.a)(t)?Object.assign(t(i),e):e:Object(m.a)(e)?e(i):e,createMatcher(e){const t=new Map,i=new Map,s=[];return e.forEach(({rule:e,comp:o})=>{"string"==typeof e?e.startsWith("*")?i.set(e.slice(1).toLowerCase(),o):t.set(e,o):"function"==typeof e&&s.push({rule:e,comp:o})}),(e,o,r)=>{if("string"==typeof e){const s=t.get(e);if(s)return s;const o=e.toLowerCase();for(const[e,t]of i)if(o.endsWith(e))return t}var n;if(Object(m.a)(e))return null===(n=s.find(({rule:t})=>t(e,o,r)))||void 0===n?void 0:n.comp}},getComponent(e,t){if(this.comp||this.defaultComp){var i;let s=this.comp||this.defaultComp;if(s="string"==typeof s||v(s)?{name:s}:this.mergeFunctionAndObject(s,null===(i=this.raw)||void 0===i?void 0:i.comp,t),this.compStrategy){const e=this.matcher(v(s.name)?s.name.name:s.name,s,t);(e||this.commonCompStrategy)&&(s=Object(y.a)(s,this.commonCompStrategy,e))}return ke(e,{...s,comp:s,prop:this.prop,size:this.size,scope:t},this)}},getDefaultRender(e,t){if(this.$scopedSlots.default)return this.$scopedSlots.default(t);if(Object(m.a)(this.defaultRender))return this.defaultRender(e,t);if(this.controlDefault){const i=this.controlDefault(u,t),s=i&&i(e,t);if(s)return s}return u.formatter(e,t)}},render(e){const t=this.interruptibleCompose(this.getSlot,this.getRender,this.getComponent,this.getDefaultRender)(e,{...this.scope,item:this.item,mode:this.mode,dict:this.dictData,self:this,$value:{get:this.$value,set:this.setFormatValue}});return this.position?e(oe,{attrs:{slotName:this.prop,slots:this.slots,scope:this.scope},style:{width:"100%"}},[t]):t}},Re=Object(se.a)(Ee,void 0,void 0,!1,null,null,null).exports,Te={props:{hide:{}},render(e){return this.hide?this.$slots.default:e("span",c()([{class:"tooltip-wrapper"},{on:{mouseenter:e=>{this.vm=d({placement:"top",...this.$attrs,target:e.target}),this.vm.show()},mouseleave:e=>{this.vm&&this.vm.hide()}}}]),[this.$slots.default])}},Me=Object(se.a)(Te,void 0,void 0,!1,null,null,null).exports,je=a({name:"form-item",props:{col:Object,isFirstRow:Boolean},inject:["formCtx","elForm"],components:{cell:ve,grid:ye,formItem:Pe},data:()=>({}),created(){this.formCtx.$on("handleChild",(e,t,i)=>{if(e)if(t){if(t!==this.item.prop)return;if(!this[e])return console.error(`不存在方法${e},prop-${this.item.prop}`);this[e](i)}else this[e](i)})},mounted(){this.isDetail&&this.handleDetailMode()},updated(){this.isDetail&&this.handleDetailMode()},methods:{resetField(){var e;null===(e=this.$refs.formItem)||void 0===e||e.resetField()},getComponentConfig(e){var t;const i=null===(t=this.$refs.render)||void 0===t?void 0:t.getComponentConfig();return e&&e(i),i},handleDetailMode(){this.$nextTick(()=>{if(!this.$el)return;this.$el.querySelectorAll("[tabindex]").forEach(e=>{e.removeAttribute("tabindex")});this.$el.querySelectorAll("input, textarea").forEach(e=>{e.setAttribute("readonly","readonly"),e.setAttribute("tabindex","-1")});this.$el.querySelectorAll("select, button, [contenteditable]").forEach(e=>{e.setAttribute("tabindex","-1")})})}},computed:{disabled(){var e;return this.item.disabled||(null===(e=this.elForm)||void 0===e?void 0:e.disabled)},isDetail(){return!1!==this.col.detail&&!1!==this.formCtx.formOptions.detail&&(this.formCtx.isDetail||this.col.detail)},item(){return this.isDetail&&this.col.detail||this.col},formOptions(){return this.formCtx.formOptions},generateRules(){return ee(this.item,this.formCtx.formScope)},rules(){return this.generateRules.rules},rawRules(){return this.generateRules.rawRules},mode(){return this.item.mode||this.formOptions.mode},labelOverTip(){return this.formCtx.formOptions.labelOverTip||""===this.formCtx.formOptions.labelOverTip||this.item.labelOverTip},className(){const e=[];return(this.formOptions.hiddenLabel||this.item.hiddenLabel)&&e.push("hidden-label"),(this.formCtx.isBorder||this.formOptions.shrinkLabel)&&e.push("shrink-label"),this.hasFormChildren&&e.push("has-form-children"),this.item.class&&e.push(this.item.class),this.rules.required&&e.push("is-required"),this.isDetail&&e.push("is-detail"),this.isFirstRow&&e.push("is-first-row"),this.formOptions.colon&&e.push("colon"),e},hasTooltip(){return this.item.tooltip||this.item.tooltipRender||this.formCtx.slots[this.item.prop+"-tooltip"]},labelMaxWidth(){if("top"===this.formOptions.labelPosition)return null;return`calc(100% - ${this.rules.required?"11px":"0px"} - ${this.hasTooltip?"18px":"0px"})`},hasFormChildren(){return this.item.formItems&&Array.isArray(this.item.formItems)}},render(e){return e(this.formCtx.layoutCell,c()([{},{props:this.item},{},{attrs:this.item}]),[e("el-form-item",{class:this.className,style:{"--label-width":this.item.labelWidth},ref:"formItem",attrs:{label:this.item.label,"label-width":this.item.labelWidth,size:this.formOptions.size,prop:this.item.validateProp||this.item.prop,rules:this.rules},scopedSlots:{label:()=>{const t=e(Me,{attrs:{hide:!this.labelOverTip,content:"string"==typeof this.item.labelOverTip?this.item.labelOverTip:this.item.label,overflow:!0}},[e(oe,{class:"form-label",style:{maxWidth:this.labelMaxWidth},attrs:{ellipsis:!!this.labelOverTip,slotName:this.item.prop,slotSuffixes:this.mode?[this.mode,"label"]:["label"],render:this.item.labelRender,slots:this.formCtx.slots,scope:this.formCtx.formScope}},[this.item.label])]),i=this.item.tooltip||this.item.tooltipRender||this.formCtx.slots[this.item.prop+"-tooltip"],s=e("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[e(oe,{slot:"content",attrs:{slotName:this.item.prop,slotSuffixes:this.mode?[this.mode,"tooltip"]:["tooltip"],render:this.item.tooltipRender,slots:this.formCtx.slots,scope:this.formCtx.formScope}},[this.item.tooltip]),e("i",{class:"el-icon-question"})]);return e("span",[t," ",i?s:null])}}},[(()=>this.hasFormChildren?e(this.formOptions.layout,c()([{attrs:{columns:this.item.columns||this.item.formItems.length}},{props:this.item}]),[this.item.formItems.map(t=>(t.hiddenLabel=!0,e(Pe,c()([{attrs:{item:t}},{props:t}]))))]):e(Me,{attrs:{hide:!this.item.contentTip,content:"string"==typeof this.item.contentTip?this.item.contentTip:this.formCtx.value[this.item.prop]}},[e(Re,c()([{ref:"render",attrs:{value:this.formCtx.value[this.item.prop]},on:{input:e=>{this.$set(this.formCtx.value,this.item.prop,e)}}},{props:this.item},{attrs:{item:this.item,slots:this.formCtx.slots,mode:this.formOptions.mode,scope:this.formCtx.formScope,size:this.formOptions.size,rawRules:this.rawRules,isWatchFormatValue:!0,defaultRender:this.formOptions.defaultRender,controlDefault:(e,t)=>this.item.formatter||this.formCtx.isDetail||this.item.detail?(t,i)=>e.formatter(t,i,!0):e.input,"data-prop":this.item.prop}}]))]))()])])}}),Pe=Object(se.a)(je,void 0,void 0,!1,null,null,null).exports,Ae=a({name:"group",data:()=>({activeName:""}),props:{border:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},hiddenHeader:{type:Boolean,default:!1},collapse:{type:Boolean,default:!0},icon:{type:String},hidden:{type:Boolean,default:!1},label:{type:String},tag:{type:Boolean,default:!0}},watch:{text(e){this.activeName=[e]}},computed:{text(){return this.collapse?1:0},isHeader(){return this.$slots.header&&!this.hiddenHeader||(this.label||this.icon)&&!this.hiddenHeader}},created(){this.activeName=[this.text]},methods:{handleChange(e){this.$emit("change",e)}}}),Be=Object(se.a)(Ae,(function(){var e=this,t=e._self._c;e._self._setupProxy;return e.hidden?e._e():t("div",{class:[e.b({header:!e.isHeader,arrow:e.disabled,border:e.border})]},[e._t("tabs"),e._v(" "),t("el-collapse",{attrs:{value:e.text},on:{change:e.handleChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-collapse-item",{attrs:{name:1,disabled:e.disabled},scopedSlots:e._u([{key:"title",fn:function(){return[e.$slots.header&&!e.hiddenHeader?t("div",{class:[e.b("header")]},[e._t("header")],2):!e.label&&!e.icon||e.hiddenHeader?e._e():t("div",{class:[e.b("header")]},[e.icon?t("i",{class:[e.icon,e.b("icon")]}):e._e(),e._v(" "),e.label?t("h1",{class:[e.b("title"),e.tag?e.b("tag"):""]},[e._v("\n            "+e._s(e.label)+"\n          ")]):e._e()])]},proxy:!0}],null,!0)},[e._v(" "),e._t("default")],2)],1)],2)}),[],!1,null,null,null).exports,Ie=a({inheritAttrs:!1,name:"button",props:{time:{type:Number,default:300},size:String,scope:{},onClick:{},confirm:{},customConfirm:{},successBack:{},textSubmit:{},batchConfirm:{}},data:()=>({isDebounce:!1,attrs:{}}),watch:{$attrs(){this.attrs=this.getBindAttrs()}},created(){this.attrs=this.getBindAttrs()},methods:{getBindAttrs(){const e={};return Object.keys(this.$attrs).forEach(t=>{Object(m.a)(this.$attrs[t])?e[t]=this.$attrs[t](this.scope):e[t]=this.$attrs[t]}),e},getIsShow(e){const t=e.hasPermi;return!(t&&this.$scOpt.checkPermission&&!this.$scOpt.checkPermission(t))&&(void 0!==e.hidden?"function"==typeof e.hidden?!e.hidden(this.scope):!e.hidden:void 0!==e.innerHide?"function"==typeof e.innerHide?!e.innerHide(this.scope):!e.innerHide:void 0===e.show||("function"==typeof e.show?e.show(this.scope):e.show))},handleClick(e=this){this.beforeClick((...t)=>{e.onClick?e.onClick(this.scope,...t):this.$emit("click",...t),this.isDebounce=!0,setTimeout(()=>{this.isDebounce=!1},this.time)},e)},beforeClick(e,t){t.confirm?this.handleConfirm(t.confirm,e):t.customConfirm?this.handleCustomConfirm(t.customConfirm,e):t.successBack?this.handleSuccessBack(t.successBack,e):t.textSubmit?this.handleFormSubmit(t.textSubmit,e):t.batchConfirm?this.$scDialog({presetType:"batchConfirm",...t.batchConfirm}).show(e):e()},handleConfirm(e,t){if(Object(m.a)(e)&&(e=e(this.scope)),!0===e||"string"==typeof e){const i=!0===e?"确定要执行此操作吗？":e;return void this.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t()})}const{label:i,title:s="提示",confirmButtonText:o="确定",cancelButtonText:r="取消",type:n="warning"}=e;this.$confirm(i||"确定要执行此操作吗？",s,{confirmButtonText:o,cancelButtonText:r,type:n}).then(()=>{t()})},handleCustomConfirm(e,t){Object(m.a)(e)&&(e=e(this.scope)),this.$scDialog({presetType:"confirmTip",label:e.label,content:e.content,title:e.title}).show(t)},handleSuccessBack(e,t){const i=this.$scDialog({presetType:"successBack",onClick:()=>{Object(m.a)(e)?(e(this.scope),i.hide()):setTimeout(()=>{this.$router.go(-1),i.hide()},50)}});t(()=>i.show())},handleFormSubmit(e,t){Object(m.a)(e)&&(e=e(this.scope)),this.$scDialog({presetType:"textSubmit",...e,submit:t}).show()}}}),Fe=Object(se.a)(Ie,(function(){var e=this,t=e._self._c;e._self._setupProxy;return e.attrs.children?t("el-dropdown",e._b({directives:[{name:"show",rawName:"v-show",value:e.getIsShow(e.attrs),expression:"getIsShow(attrs)"}],attrs:{trigger:"click",size:e.size,disabled:e.isDebounce||e.attrs.disabled}},"el-dropdown",e.attrs,!1),[t("el-button",e._b({class:e.b(),attrs:{size:e.size,disabled:e.isDebounce||e.attrs.disabled}},"el-button",e.attrs,!1),[e.attrs.label?t("span",[e._v(e._s(e.attrs.label))]):e._e(),e.$slots.default?e._t("default"):e._e(),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})],2),e._v(" "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.attrs.children,(function(i,s){return t("el-dropdown-item",e._b({directives:[{name:"show",rawName:"v-show",value:e.getIsShow(i),expression:"getIsShow(child)"}],key:s,nativeOn:{click:function(t){return e.handleClick(i)}}},"el-dropdown-item",i,!1),[e._v(e._s(i.label))])})),1)],1):t("el-button",e._b({directives:[{name:"show",rawName:"v-show",value:e.getIsShow(e.attrs),expression:"getIsShow(attrs)"}],class:e.b(),attrs:{disabled:e.isDebounce||e.attrs.disabled,size:e.size},on:{click:function(t){return e.handleClick()}}},"el-button",e.attrs,!1),[e.attrs.label?t("span",[e._v(e._s(e.attrs.label))]):e._e(),e._v(" "),e.$slots.default?e._t("default"):e._e()],2)}),[],!1,null,null,null).exports,Ne=a({name:"form-action",inject:["formCtx"],components:{Cell:ve,button_:Fe},computed:{showAction(){return z(this.action,null,this.formActionButtons.length>0)},action(){return this.formCtx.formOptions.action},scope(){return{ctx:this.formCtx,row:this.formCtx.value}},layoutCell(){return"grid"===this.formCtx.formOptions.layout?"cell":"el-row"===this.formCtx.formOptions.layout?"el-col":void 0},widthSize(){return this.action.widthSize?this.action.widthSize:!1!==this.action.fill?this.formCtx.formOptions.columns:1},formActionButtons(){const e=[],t=A("btn.form",this.action,{ctx:this.formCtx,row:this.formCtx.value},this.formActionTemps);return e.push(...t),e},formActionTemps(){return{submit:(e,{ctx:t})=>({label:"提交",icon:"el-icon-check",type:"primary",onClick:this.formCtx.submit}),reset:(e,{ctx:t})=>({icon:"el-icon-refresh",label:"重置",onClick:this.formCtx.reset})}}}}),Ve=Object(se.a)(Ne,(function(){var e=this,t=e._self._c;e._self._setupProxy;return e.showAction?t(e.layoutCell,{tag:"component",class:e.b([e.action.align]),attrs:{widthSize:e.widthSize}},[t("el-form-item",{attrs:{"label-width":"0px"}},e._l(e.formActionButtons,(function(i,s){return t("button_",e._b({key:s,attrs:{size:e.formCtx.formOptions.size,loading:e.formCtx.loadingStatus,scope:e.scope}},"button_",i,!1))})),1)],1):e._e()}),[],!1,null,null,null).exports;var ze={session:{set(e,t){sessionStorage&&null!=e&&null!=t&&sessionStorage.setItem(e,t)},get:e=>sessionStorage?null==e?null:sessionStorage.getItem(e):null,setJSON(e,t){null!=t&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(null!=t)return JSON.parse(t)},remove(e){sessionStorage.removeItem(e)}},local:{set(e,t){localStorage&&null!=e&&null!=t&&localStorage.setItem(e,t)},get:e=>localStorage?null==e?null:localStorage.getItem(e):null,setJSON(e,t){null!=t&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(null!=t)return JSON.parse(t)},remove(e){localStorage.removeItem(e)}}},Le=a({name:"form-draft",inject:["formCtx"],props:{size:{type:String,default:"medium",validator:e=>["default","medium","small","mini"].includes(e)}},data:()=>({isExpanded:!1,shouldExpandHorizontal:!1,hideTimer:null,draftList:[],draftVisible:!1,searchKeyword:""}),created(){this.loadDraftsFromStorage()},computed:{filteredDraftList(){if(!this.searchKeyword)return this.draftList;const e=this.searchKeyword.toLowerCase();return this.draftList.filter(t=>t.name.toLowerCase().includes(e))},draftNumber(){return this.draftList.length}},methods:{handleMouseEnter(){this.hideTimer&&clearTimeout(this.hideTimer),this.isExpanded=!0},handleMouseLeave(){this.hideTimer=setTimeout(()=>{this.isExpanded=!1},200)},handleDraft(){this.draftVisible=!0},handleSaveDraft(){this.$prompt("请输入草稿名称","保存草稿",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S+/,inputErrorMessage:"草稿名称不能为空",inputValue:"草稿_"+(new Date).toLocaleString()}).then(({value:e})=>{try{const t={id:"draft_"+Date.now(),name:e.trim(),formData:JSON.parse(JSON.stringify(this.formCtx.value)),createTime:(new Date).toISOString(),updateTime:(new Date).toISOString()},i=[...this.draftList],s=i.findIndex(e=>e.name===t.name);if(-1!==s)return this.$confirm("已存在同名草稿，是否覆盖？","提示",{type:"warning",confirmButtonText:"覆盖",cancelButtonText:"取消"}).then(()=>{i[s]=t,this.saveDraftsToStorage(i),this.$message.success("草稿已更新")}).catch(()=>{this.handleSaveDraft()});i.unshift(t),this.saveDraftsToStorage(i),this.draftList=i,this.$message.success("保存成功")}catch(e){console.error("保存草稿失败:",e),this.$message.error("保存失败："+e.message)}})},getCacheKey(){return this.$route?this.$route.path.replace(/\/?\d+$/,""):""},saveDraftsToStorage(e){try{if(!this.$route)return;let t=ze.local.getJSON("SC_FORM_DRAFTS")||{};t[this.getCacheKey()]=e,ze.local.setJSON("SC_FORM_DRAFTS",t)}catch(e){throw console.error("保存到本地存储失败:",e),new Error("保存到本地存储失败")}},loadDraftsFromStorage(){try{const e=ze.local.getJSON("SC_FORM_DRAFTS")||{};this.draftList=e[this.getCacheKey()]||[]}catch(e){console.error("加载草稿列表失败:",e),this.draftList=[]}},async handleLoadDraft(e,t=!1){if(e||(e=this.filteredDraftList[0]),e)try{const i=JSON.parse(JSON.stringify(e.formData));let s;if(t)s=i;else{const e={...this.formCtx.value},t=await this.formCtx.filterDisabledData(i);s={...e,...t}}this.formCtx.$emit("input",s);const o={...e,updateTime:(new Date).toISOString()},r=this.draftList.findIndex(t=>t.id===e.id);-1!==r&&(this.draftList.splice(r,1),this.draftList.unshift(o),this.saveDraftsToStorage(this.draftList)),this.draftVisible=!1,this.formCtx.clearValidate(),this.$message.success("加载成功"),this.formCtx.$emit("draft-loaded",e)}catch(e){console.error("加载草稿失败:",e),this.$message.error("加载失败："+e.message)}},validateDraftData(e){if(!e||"object"!=typeof e)return!1;return this.formCtx.trueRenderColumns.some(t=>void 0!==e[t.prop])},handleDeleteDraft(e){this.$confirm("确认删除该草稿？删除后将无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{try{const t=this.draftList.findIndex(t=>t.id===e);if(-1===t)return;const i=this.draftList[t];this.draftList.splice(t,1),this.saveDraftsToStorage(this.draftList),this.formCtx.$emit("draft-deleted",i),0===this.draftList.length&&(this.draftVisible=!1)}catch(e){console.error("删除草稿失败:",e)}}).catch(()=>{})},handleClearDraft(){this.$confirm("确认清空草稿箱？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.draftList=[],this.saveDraftsToStorage([])})},formatTime:e=>new Date(e).toLocaleString(),handlePreviewDraft(e){const t=this.formCtx.trueRenderColumns.reduce((e,t)=>(e[t.prop]=t.label||t.prop,e),{}),i=Object.entries(e.formData).map(([e,i])=>{const s=t[e]||e;let o=i;return Array.isArray(i)||"object"==typeof i&&null!==i?o=JSON.stringify(i):""!==i&&null!=i||(o="空"),`${s}: ${o}`}).join("\n");this.$alert(i,"草稿预览",{confirmButtonText:"关闭",customClass:"sc-form-draft__preview-dialog",callback:()=>{}})}}}),Ke=Object(se.a)(Le,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-drawer",{attrs:{title:"草稿箱",visible:e.draftVisible,direction:"rtl",size:"600","append-to-body":!0,"destroy-on-close":!1},on:{"update:visible":function(t){e.draftVisible=t}}},[t("div",{class:e.b()},[t("div",{staticClass:"draft-header"},[t("div",{staticClass:"draft-header__left"},[t("el-tooltip",{attrs:{content:"清空草稿箱",placement:"top"}},[t("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:e.handleClearDraft}})],1)],1),e._v(" "),t("div",{staticClass:"draft-header__right"},[t("el-input",{attrs:{placeholder:"搜索草稿","prefix-icon":"el-icon-search",clearable:"",size:"small"},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}})],1)]),e._v(" "),t("div",{staticClass:"draft-list"},[e.filteredDraftList.length?e._l(e.filteredDraftList,(function(i){return t("div",{key:i.id,staticClass:"draft-item"},[t("div",{staticClass:"draft-item__header"},[t("span",{staticClass:"draft-item__name"},[e._v(e._s(i.name))]),e._v(" "),t("span",{staticClass:"draft-item__time"},[e._v(e._s(e.formatTime(i.updateTime)))])]),e._v(" "),t("div",{staticClass:"draft-item__footer"},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleLoadDraft(i)}}},[e._v("\n            加载当前\n          ")]),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleLoadDraft(i,!0)}}},[e._v("\n            完整加载\n          ")]),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handlePreviewDraft(i)}}},[e._v("\n            预览\n          ")]),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleDeleteDraft(i.id)}}},[e._v("\n            删除\n          ")])],1)])})):t("el-empty",{attrs:{description:"暂无草稿"}})],2)])])}),[],!1,null,null,null).exports,He={methods:{contextMenuTemps(){return{quickMock:{label:"生成测试数据",icon:"el-icon-magic-stick",onClick:()=>{this.$refs.batchMockData.quickGenerateData()}},mock:{label:"自定义生成测试数据",icon:"el-icon-magic-stick",onClick:()=>{this.openMockDialog()}},reset:{label:"重置表单",icon:"el-icon-refresh",onClick:()=>{this.$emit("handleChild","resetField",null,!0)}},copy:{label:"复制数据",icon:"el-icon-document-copy",onClick:async()=>{try{const e=this.trueRenderColumns.reduce((e,t)=>(t.hidden||void 0===this.value[t.prop]||(e[t.prop]=this.value[t.prop]),e),{}),t=JSON.stringify(e,null,2);await navigator.clipboard.writeText(t),this.$message.success("表单数据已复制到剪贴板"),this.$emit("copy",t)}catch(e){this.$message.error("复制失败："+e.message)}}},paste:{label:"粘贴数据",icon:"el-icon-document-add",children:[{label:"粘贴当前",onClick:async()=>{try{await this.handlePasteData()}catch(e){this.$message.error("导入失败："+e.message)}}},{label:"粘贴全部",onClick:async()=>{try{await this.handlePasteData(!0)}catch(e){this.$message.error("导入失败："+e.message)}}}]},saveDraft:{label:"保存为草稿",icon:"el-icon-plus",onClick:()=>{this.$refs.draftDrawer.handleSaveDraft()}},loadDraft:{label:"加载最新草稿",icon:"el-icon-bottom",children:[{label:"加载当前",onClick:()=>{this.$refs.draftDrawer.handleLoadDraft()}},{label:"完整加载",onClick:()=>{this.$refs.draftDrawer.handleLoadDraft(null,!0)}}]},draft:{label:`草稿箱 (${this.$refs.draftDrawer.draftNumber})`,icon:"el-icon-notebook-2",onClick:()=>{this.$refs.draftDrawer.handleDraft()}}}},handleContextMenu(e){if(!1===z(this.formOptions.contextMenu))return;if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)||"true"===e.target.contentEditable)return;e.preventDefault();const t=A("btn.form.contextMenu",this.formOptions.contextMenu,this.formScope,this.contextMenuTemps());this.$contextmenu({items:K(t,this.formOptions,this.formScope,"contextMenu"),event:e,customClass:"sc-form-contextmenu",zIndex:3e3,minWidth:180})},validatePasteData(e){return!(!e||"object"!=typeof e)&&this.trueRenderColumns.some(t=>void 0!==e[t.prop])},async filterDisabledData(e){const t={};if(this.isDisabled)return t;const i=this.trueRenderColumns.map(async i=>{if(void 0===e[i.prop])return;const s=await new Promise(e=>{this.$emit("handleChild","getComponentConfig",i.prop,e)});null!=s&&s.disabled||i.disabled||i.detail||(t[i.prop]=e[i.prop])});return await Promise.all(i),t},async handlePasteData(e=!1){const t=await navigator.clipboard.readText();let i=JSON.parse(t);if(!this.validatePasteData(i))return void this.$message.error("数据结构不匹配，请检查字段");const s={...this.value},o=e?i:await this.filterDisabledData(i);Object.assign(s,o),this.$emit("input",s),this.$emit("paste",s),this.$message.success("数据导入成功"),this.clearValidate()}}},Ye=i(562),qe=i.n(Ye),We=i(743),Ge=i.n(We);k.a.extend(Ge.a);const Ue={["basic"]:[{id:"uuid",name:"UUID",description:"唯一标识符",icon:"el-icon-key",generator:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),configurable:!1}],["text"]:[{id:"chinese_name",name:"中文姓名",description:"随机中文姓名",icon:"el-icon-user",generator:()=>{const e=["李","王","张","刘","陈","杨","赵","黄","周","吴"],t=["伟","芳","娜","秀英","敏","静","丽","强","磊","军"];return e[Math.floor(Math.random()*e.length)]+t[Math.floor(Math.random()*t.length)]+(Math.random()>.5?t[Math.floor(Math.random()*t.length)]:"")},configurable:!1},{id:"chinese_text",name:"中文文本",description:"指定长度的中文文本",icon:"el-icon-document",generator:e=>{const t="的一是了我不人在他有这个上们来到时大地为子中你说生国年着就那和要她出也得里后自以会家可下而过天去能对小多然于心学么之都好看起发当没成只如事把还用第样道想作种开美总从无情己面最女但现前些所同日手又行意动方期它头经长儿回位分爱老因很给名法间斯知世什两次使身者被高已亲其进此话常与活正感",{minLength:i=2,maxLength:s=10}=e||{},o=Math.floor(Math.random()*(s-i+1))+i;let r="";for(let e=0;e<o;e++)r+=t[Math.floor(Math.random()*t.length)];return r},configurable:!0,configSchema:[{field:"minLength",label:"最小长度",type:"number",default:2,min:1},{field:"maxLength",label:"最大长度",type:"number",default:10,min:1}]},{id:"english_text",name:"英文文本",description:"随机英文单词",icon:"el-icon-document",generator:e=>{const t=["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","sed","do","eiusmod","tempor","incididunt","ut","labore","et","dolore","magna","aliqua"],{minWords:i=1,maxWords:s=5}=e||{},o=Math.floor(Math.random()*(s-i+1))+i,r=[];for(let e=0;e<o;e++)r.push(t[Math.floor(Math.random()*t.length)]);return r.join(" ")},configurable:!0,configSchema:[{field:"minWords",label:"最少单词数",type:"number",default:1,min:1},{field:"maxWords",label:"最多单词数",type:"number",default:5,min:1}]}],["number"]:[{id:"integer",name:"整数",description:"指定范围的随机整数",icon:"el-icon-s-data",generator:e=>{const{min:t=1,max:i=100}=e||{};return Math.floor(Math.random()*(i-t+1))+t},configurable:!0,configSchema:[{field:"min",label:"最小值",type:"number",default:1},{field:"max",label:"最大值",type:"number",default:100}]},{id:"decimal",name:"小数",description:"指定精度的随机小数",icon:"el-icon-s-data",generator:e=>{const{min:t=0,max:i=100,precision:s=2}=e||{},o=Math.pow(10,s);return Math.round((Math.random()*(i-t)+t)*o)/o},configurable:!0,configSchema:[{field:"min",label:"最小值",type:"number",default:0},{field:"max",label:"最大值",type:"number",default:100},{field:"precision",label:"小数位数",type:"number",default:2,min:0,max:10}]}],["date"]:[{id:"date",name:"日期",description:"指定格式的随机日期",icon:"el-icon-date",generator:e=>{const{format:t="YYYY-MM-DD",minDate:i,maxDate:s}=e||{},o=i?k()(i):k()().subtract(3,"year"),r=s?k()(s):k()();if(o.isAfter(r))return r.format(t);const n=r.valueOf()-o.valueOf(),a=o.valueOf()+Math.floor(Math.random()*n);return k()(a).format(t)},configurable:!0,configSchema:[{field:"format",label:"日期格式",type:"select",default:"YYYY-MM-DD",options:[{label:"YYYY-MM-DD",value:"YYYY-MM-DD"},{label:"YYYY/MM/DD",value:"YYYY/MM/DD"},{label:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{label:"YYYY/MM/DD HH:mm:ss",value:"YYYY/MM/DD HH:mm:ss"},{label:"YYYY年MM月DD日",value:"YYYY年MM月DD日"},{label:"MM/DD/YYYY",value:"MM/DD/YYYY"}]},{field:"minDate",label:"最早日期",type:"date"},{field:"maxDate",label:"最晚日期",type:"date"}]},{id:"datetime",name:"日期时间",description:"带时间的随机日期",icon:"el-icon-time",generator:e=>{const{format:t="YYYY-MM-DD HH:mm:ss",minDate:i,maxDate:s,withTime:o=!0}=e||{},r=i?k()(i):k()().subtract(1,"month"),n=(s?k()(s):k()()).valueOf()-r.valueOf(),a=r.valueOf()+Math.floor(Math.random()*n);return k()(a).format(t)},configurable:!0,configSchema:[{field:"format",label:"日期格式",type:"select",default:"YYYY-MM-DD HH:mm:ss",options:[{label:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{label:"YYYY/MM/DD HH:mm:ss",value:"YYYY/MM/DD HH:mm:ss"},{label:"YYYY-MM-DD HH:mm",value:"YYYY-MM-DD HH:mm"},{label:"HH:mm:ss",value:"HH:mm:ss"},{label:"HH:mm",value:"HH:mm"}]},{field:"minDate",label:"最早日期",type:"date"},{field:"maxDate",label:"最晚日期",type:"date"}]},{id:"time_ago",name:"相对时间",description:"生成相对于当前的时间",icon:"el-icon-time",generator:e=>{const{unit:t="day",min:i=1,max:s=30,format:o="relative"}=e||{},r=Math.floor(Math.random()*(s-i+1))+i,n=k()().subtract(r,t);return"relative"===o?n.fromNow():n.format(o)},configurable:!0,configSchema:[{field:"unit",label:"时间单位",type:"select",default:"day",options:[{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"},{label:"周",value:"week"},{label:"月",value:"month"},{label:"年",value:"year"}]},{field:"min",label:"最小值",type:"number",default:1},{field:"max",label:"最大值",type:"number",default:30},{field:"format",label:"输出格式",type:"select",default:"relative",options:[{label:"相对时间",value:"relative"},{label:"YYYY-MM-DD",value:"YYYY-MM-DD"},{label:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"}]}]}],["special"]:[{id:"email",name:"邮箱",description:"随机邮箱地址",icon:"el-icon-message",generator:()=>{const e=["gmail.com","163.com","qq.com","hotmail.com","outlook.com"],t=["user","test","admin","demo","example"],i=Math.floor(1e3*Math.random());return`${t[Math.floor(Math.random()*t.length)]}${i}@${e[Math.floor(Math.random()*e.length)]}`},configurable:!1},{id:"phone",name:"手机号",description:"中国大陆手机号",icon:"el-icon-phone",generator:()=>{const e=["130","131","132","133","134","135","136","137","138","139","150","151","152","153","155","156","157","158","159","180","181","182","183","184","185","186","187","188","189"];return e[Math.floor(Math.random()*e.length)]+Math.floor(1e8*Math.random()).toString().padStart(8,"0")},configurable:!1},{id:"id_card",name:"身份证号",description:"18位身份证号码",icon:"el-icon-postcard",generator:()=>{const e="11010119900101"+Math.floor(1e3*Math.random()).toString().padStart(3,"0"),t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];let i=0;for(let s=0;s<17;s++)i+=parseInt(e[s])*t[s];return e+["1","0","X","9","8","7","6","5","4","3","2"][i%11]},configurable:!1},{id:"custom_regex",name:"自定义正则",description:"基于正则表达式生成",icon:"el-icon-edit",generator:e=>{const{pattern:t="\\d{4}"}=e||{};return"\\d{4}"===t?Math.floor(1e4*Math.random()).toString().padStart(4,"0"):"[A-Z]{3}"===t?"ABC":"REGEX_"+Math.random().toString(36).substr(2,5)},configurable:!0,configSchema:[{field:"pattern",label:"正则表达式",type:"input",default:"\\d{4}",placeholder:"例如: \\d{4}"},{field:"description",label:"规则描述",type:"input",placeholder:"描述这个规则的用途"}]}]};function Je(e){return function(){const e=[];return Object.keys(Ue).forEach(t=>{e.push(...Ue[t].map(e=>({...e,category:t})))}),e}().find(t=>t.id===e)}function Xe(e){var t,i;const s=function(e){if(null==e||!e.componentInstance)return;let t=e.componentInstance,i=t.$options.name;const s=["ElInput","ElInputNumber","ElSelect","ElDatePicker","ElTimePicker","ElTimeSelect","ElRadioGroup","ElRadio","ElCheckboxGroup","ElCheckbox","ElCascader","ElSwitch","ElSlider","ElRate","ElColorPicker","ElUpload","ElTransfer"];for(;t&&!s.includes(i);){const e=(t.$children||[])[0];if(!e)break;t=e,i=t.$options.name}return t}(e);if(!s)return null;const o=s.$options.name,r=s.$props||{},n=s.$attrs||{},a={...r,...n,disabled:!!s.disabled},l={ElInput:{type:"input",subtype:r.type||"text"},ElInputNumber:{type:"number"},ElSelect:{type:"select",options:Ze(s)},ElDatePicker:{type:"date",pickerType:r.type||"date"},ElRadioGroup:{type:"radio",options:Qe(s)},ElRadio:{type:"radio",options:[{label:s.label,value:null!==(t=s.value)&&void 0!==t?t:s.label}]},ElRadioButton:{type:"radio",options:[{label:s.label,value:null!==(i=s.value)&&void 0!==i?i:s.label}]},ElCheckboxGroup:{type:"checkbox",options:et(s)}},c={ElTimePicker:"time",ElTimeSelect:"time",ElCheckbox:"checkbox",ElCascader:"cascader",ElSlider:"slider",ElRate:"rate",ElTransfer:"transfer",ElSwitch:"switch"};return l[o]?{...a,...l[o]}:c[o]?{...a,type:c[o]}:null}function Ze(e){return tt(e,{name:"ElOption",multiple:!0}).map(e=>{var t;return{label:e.label,value:null!==(t=e.value)&&void 0!==t?t:e.label,disabled:!!e.disabled}})}function Qe(e){return tt(e,{name:["ElRadio","ElRadioButton"],multiple:!0}).map(e=>{var t;return{label:e.label,value:null!==(t=e.value)&&void 0!==t?t:e.label,disabled:!!e.disabled}})}function et(e){return tt(e,{name:"ElCheckbox",multiple:!0}).map(e=>{var t;return{label:e.label,value:null!==(t=e.value)&&void 0!==t?t:e.label,disabled:!!e.disabled}})}function tt(e,t={}){const{name:i,filter:s,deep:o=!0,multiple:r=!1}=t;if(null==e||!e.$children)return r?[]:null;const n=[];return function e(t){for(const c of t){var a;if((l=c.$options.name,!i||(Array.isArray(i)?i.includes(l):l===i))&&(!s||s(c))&&(n.push(c),!r))return!0;if(o&&null!==(a=c.$children)&&void 0!==a&&a.length){if(e(c.$children)&&!r)return!0}}var l;return!1}(e.$children),r?n:n[0]||null}i(345),i(346),i(347),i(348),i(349),i(350),i(351);var it={mockComponentName:(e,{Random:t,Mock:i,Preset:s})=>t.pick(s.mockComponentName)};const st=qe.a.Random,ot={integer:(e=1,t=100)=>st.integer(e,t),float:(e=1,t=100,i=2)=>st.float(e,t,0,i),chinese:(e=2,t=4)=>st.cword(e,t),english:(e=3,t=8)=>st.word(e,t),paragraph:(e=1,t=3)=>st.cparagraph(e,t),sentence:(e=3,t=8)=>st.csentence(e,t),email:()=>st.email(),phone:()=>qe.a.mock(/^1[3-9]\d{9}$/),id:()=>qe.a.mock(/^\d{18}$/),date:(e="yyyy-MM-dd")=>st.date(e),time:(e="HH:mm:ss")=>st.time(e),datetime:(e="yyyy-MM-dd HH:mm:ss")=>st.datetime(e),timestamp:()=>st.datetime("T"),array:(e,t=1)=>{const i="number"==typeof t?t:st.integer(t[0],t[1]);return Array.from({length:i},()=>"function"==typeof e?e():e)},image:(e=100,t=100)=>st.image(`${e}x${t}`),imageUrl:(e=1,t=100,i=100)=>`https://picsum.photos/seed/${e}/${t}/${i}`,url:()=>st.url(),pick:e=>st.pick(e),uuid:()=>st.guid()};const rt={input:function(e){const{subtype:t,maxLength:i=10,minLength:s=1}=e;switch(t){case"email":return st.email();case"url":return st.url();case"number":return st.string("number",s,i);case"tel":case"phone":return qe.a.mock(/^1[3-9]\d{9}$/);case"textarea":return st.cparagraph(1,3);default:return st.cword(s,i)}},number:function(e){const{min:t=1,max:i=100,precision:s=0}=e,o=Math.pow(10,s);return Math.round(st.float(t,i)*o)/o},select:function(e){const{options:t=[],multiple:i,multipleLimit:s=3}=e;if(!t.length)return i?[]:void 0;if(i){const e=t.filter(e=>!e.disabled),i=s||e.length,o=st.integer(1,i),r=st.pick(e.map(e=>e.value),o);return Array.isArray(r)?r:[r]}const o=t.filter(e=>!e.disabled);if(!o.length)return;return st.pick(o).value},date:function(e,t={}){const{pickerType:i,valueFormat:s}=e,{yearRange:o=1}=t,r=new Date,n=new Date(r);n.setFullYear(r.getFullYear()-o);const a=e.min?new Date(e.min):n,l=e.max?new Date(e.max):r;function c(){const e=a.getTime()+Math.random()*(l.getTime()-a.getTime()),t=new Date(e);return s?h(t,s):t.toISOString().split("T")[0]}function h(e,t){const i=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return t.replace(/yyyy/g,i).replace(/MM/g,s).replace(/dd/g,o).replace(/HH/g,r).replace(/mm/g,n).replace(/ss/g,a)}switch(i){case"datetime":{const e=new Date(a.getTime()+Math.random()*(l.getTime()-a.getTime()));return s?h(e,s):e.toISOString()}case"daterange":case"datetimerange":{const e=c();let t;do{t=c()}while(t<=e);return[e,t]}case"month":{const e=new Date(a.getTime()+Math.random()*(l.getTime()-a.getTime()));return s?h(e,s):`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}case"year":{const e=a.getFullYear(),t=l.getFullYear(),i=e+Math.floor(Math.random()*(t-e+1));return s?h(new Date(i,0,1),s):String(i)}case"dates":{const e=st.integer(1,3),t=new Set;for(;t.size<e;)t.add(c());return Array.from(t).sort()}default:return c()}},time:function(e){const{isRange:t,valueFormat:i="HH:mm:ss",format:s="HH:mm:ss",min:o="01:00:00",max:r="23:59:59",step:n=1}=e;function a(){const[e,t,s="00"]=o.split(":").map(Number),[a,l,c="59"]=r.split(":").map(Number),h=3600*e+60*t+s,d=3600*a+60*l+c;let u=st.integer(h,d);u=Math.floor(u/n)*n;const p=[Math.floor(u/3600),Math.floor(u%3600/60),u%60].map(e=>String(e).padStart(2,"0")).join(":");return i.includes("ss")?p:p.slice(0,5)}if(t){const e=a();let t;do{t=a()}while(t<=e);return[e,t]}return a()},radio:function(e){const{options:t=[]}=e;if(!t.length)return;const i=t.filter(e=>!e.disabled);if(!i.length)return;return st.pick(i).value},checkbox:function(e){if(void 0!==e.trueLabel)return st.boolean()?e.trueLabel:e.falseLabel;const{options:t=[],min:i=1,max:s=t.length}=e;if(!t.length)return[];const o=t.filter(e=>!e.disabled),r=st.integer(i,Math.min(s,o.length)),n=st.pick(o.map(e=>e.value),r);return Array.isArray(n)?n:[n]},cascader:function(e){const{options:t=[],props:i={}}=e;function s(e){return null!=e&&e.length?function e(t,s=[]){if(null==t||!t.length)return s;const o=st.pick(t);s.push(o[i.value||"value"]);const r=o[i.children||"children"];return null!=r&&r.length?i.checkStrictly&&Math.random()<.5?s:e(r,s):s}(e):[]}if(i.multiple){const e=st.integer(1,3),i=new Set;for(;i.size<e;){const e=s(t);i.add(JSON.stringify(e))}return Array.from(i).map(e=>JSON.parse(e))}return s(t)},switch:function(e){const{activeValue:t=!0,inactiveValue:i=!1}=e;return st.boolean()?t:i},slider:function(e){const{min:t=1,max:i=100,step:s=1,range:o=!1}=e,r=e=>s&&1!==s?Math.round(e/s)*s:e;if(o){const e=r(st.integer(t,i-s)),o=r(st.integer(e+s,i));return[e,o]}return r(st.integer(t,i))},rate:function(e){const{max:t=5,allowHalf:i=!1}=e;if(i){return st.integer(1,2*t)/2}return st.integer(1,t)},transfer:function(e){const{data:t=[]}=e;if(!t.length)return[];const i=t.filter(e=>!e.disabled).map(e=>e.key||e.value),s=st.integer(1,Math.min(3,i.length)),o=st.pick(i,s);return Array.isArray(o)?o:[o]}};function nt(e,t={}){if(!e)return null;const{yearRange:i=1,pattern:s,vnode:o,componentName:r}=t;if(e.disabled)return;if(s)return qe.a.mock(s);if(o&&r){const e=function(e,t){let i;if(t)i=H(null==e?void 0:e.componentInstance,t);else for(const i in it){if(H(null==e?void 0:e.componentInstance,i)){t=i;break}}if(!i)return;const s=it[t];if("function"!=typeof s)return;try{return s(i,{Random:st,Mock:qe.a,Preset:ot})}catch(e){return void console.warn(`自定义组件 ${t} 的模拟数据生成失败:`,e)}}(o,r);if(void 0!==e)return e}const n=rt[e.type];return n?n(e,{yearRange:i}):void 0}var at=a({name:"batch-mock-dialog",props:{visible:{type:Boolean,default:!1},instanceType:{type:String,default:"table",validator:e=>["table","form"].includes(e)},instanceRef:{type:Object,default:null},formInitialValue:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},valueKey:{type:String,default:"id"}},data(){return{form:{count:10,mode:"table"===this.instanceType?"append":"fill"},fields:[],addFieldDialogVisible:!1,newField:{prop:"",label:""},customFields:[],ruleCategories:[{label:"基础类型",value:"basic"},{label:"文本类型",value:"text"},{label:"数字类型",value:"number"},{label:"日期时间",value:"date"},{label:"特殊格式",value:"special"}],previewValues:{},componentConfigs:{},loadingPreviews:{},defaultManualConfig:{type:"text",convertToNumber:!1,items:[],properties:{}}}},watch:{visible(e){e&&(this.initFields(),this.loadLocalCache(),this.$nextTick(()=>{this.analyzeComponentConfigs()}))}},computed:{dialogTitle(){return"form"===this.instanceType?"生成表单数据":"批量生成表格数据"},getConfirmButtonText(){return{append:"追加数据",replace:"替换数据",fill:"补充空值"}[this.form.mode]||"确定"},showBatchOptions(){return"form"!==this.instanceType||(this.form.mode="append"===this.form.mode?"replace":this.form.mode,!0)}},methods:{initFields(){const e=e=>{var t;return null!==(t=e.comp)&&void 0!==t&&t.options?e.comp.options:"string"==typeof e.dict?this.$scDict[e.dict]:[]},t=this.getCacheKey(),i=((ze.local.getJSON("mockDataConfig")||{})[t]||{}).deletedOriginalFields||[],s=this.columns.filter(e=>e.prop&&!e.type).filter(e=>!i.includes(e.prop)).map(t=>({prop:t.prop,label:t.label,selectOptions:e(t),genType:"auto",manualValue:"",regexPattern:"",ruleId:"",ruleConfig:{},manualConfig:{...this.defaultManualConfig},col:t,isCustom:!1})),o=this.loadCustomFieldsFromCache();this.fields=[...s,...o],this.$nextTick(()=>{this.fields.forEach(e=>{this.refreshPreview(e)})})},getPattern(e){if(e){const t=e.find(e=>e.regular);if(t)return t.regular}},analyzeComponentConfigs(){if(!this.instanceRef)return;const e=e=>{var t;if(!e)return null;const i=H(null===(t=e.parent)||void 0===t?void 0:t.componentInstance,"render");return i?{config:Xe(e.parent),pattern:this.getPattern(i.rawRules),setFormatValue:i.setFormatValue}:null};("form"===this.instanceType?this.instanceRef.$el.querySelectorAll("[data-prop]"):this.instanceRef.$el.querySelectorAll(".el-table__body-wrapper td [data-prop]")).forEach(t=>{var i;const s=t.getAttribute("data-prop");if(!s||this.componentConfigs[s])return;const o=null===(i=t.__vue__)||void 0===i?void 0:i.$vnode;if(!o)return;const r=e(o);null!=r&&r.config&&(this.componentConfigs[s]=r)}),this.refreshAllPreviews()},refreshAllPreviews(){this.fields.forEach(e=>{this.refreshPreview(e)})},getRulesByCategory:e=>function(e){return Ue[e]||[]}(e),getRuleConfig(e){const t=Je(e);return t&&t.configurable?t.configSchema:null},isPreviewLoading(e){return!0===this.loadingPreviews[e]},refreshPreview(e){this.$set(this.loadingPreviews,e.prop,!0),setTimeout(()=>{try{const t=this.generateFieldValue(e);this.$set(this.previewValues,e.prop,t)}catch(t){console.error("预览生成错误:",t),this.$set(this.previewValues,e.prop,"生成错误")}finally{this.$set(this.loadingPreviews,e.prop,!1)}},100)},getPreviewType(e){const t=this.previewValues[e];return null==t?"unknown":Array.isArray(t)?"array":"number"==typeof t?"number":"object"==typeof t?"object":"string"==typeof t&&(t.match(/^\d{4}-\d{2}-\d{2}$/)||t.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/))?"date":"text"},getPreviewValue(e){const t=this.previewValues[e.prop];if(null==t)return"-";if(Array.isArray(t)||"object"==typeof t)try{return JSON.stringify(t,null,2).split("\n").map(e=>e.trim()).join("")}catch(e){return String(t)}return String(t)},generateFieldValue(e){const t=()=>{switch(e.genType){case"auto":return this.generateAutoValue(e);case"manual":return this.generateManualValue(e);case"regex":try{return e.regexPattern?qe.a.mock(new RegExp(e.regexPattern)):null}catch(e){return"正则表达式错误"}case"preset":if(!e.ruleId)return null;try{return function(e,t={}){const i=Je(e);if(!i)throw new Error("Rule not found: "+e);return i.generator(t)}(e.ruleId,e.ruleConfig)}catch(e){return"规则执行错误"}default:return null}};return this.componentConfigs[e.prop]?this.componentConfigs[e.prop].setFormatValue(t(),!0):t()},generateAutoValue(e){if(e.prop===this.valueKey)return"mock_"+Object(ae.a)();if(this.componentConfigs[e.prop])return nt(this.componentConfigs[e.prop].config,{pattern:this.componentConfigs[e.prop].pattern});if(e.selectOptions&&e.selectOptions.length>0)return qe.a.Random.pick(e.selectOptions.map(e=>e.value));if("table"===this.instanceType&&this.data&&this.data.length>0){const t=this.data.map(t=>t[e.prop]).filter(e=>!I(e));if(t.length>0)return qe.a.Random.pick(t)}const t=e.prop.toLowerCase()+(e.label||"").toLowerCase();return this.isNumberField(t)?this.generateNumberByFieldName(t):this.isDateField(t)?this.generateDateByFieldName(t):qe.a.Random.cword(2,8)},isNumberField:e=>["数量","个数","份数","件数","条数","金额","价格","单价","总价","成本","费用","工资","薪资","年龄","分数","得分","评分","积分","比例","编码","编号","排名","等级","星级","长度","宽度","高度","重量","面积","体积","容量"].some(t=>e.includes(t)),generateNumberByFieldName:e=>Math.floor(1e3*Math.random()),isDateField:e=>["日期","时间","年份","月份","date","time","year","month","day"].some(t=>e.includes(t)),generateDateByFieldName:e=>/时间|time/.test(e)?qe.a.Random.datetime("yyyy-MM-dd HH:mm:ss"):qe.a.Random.date("yyyy-MM-dd"),handleManualTypeChange(e){switch(e.manualValue=null,e.manualConfig.type){case"text":e.manualConfig.convertToNumber=!1;break;case"array":e.manualConfig.items=[];break;case"object":e.manualConfig.properties={}}this.refreshPreview(e)},addArrayItem(e){e.manualConfig.items.push(""),this.$nextTick(()=>this.refreshPreview(e))},removeArrayItem(e,t){e.manualConfig.items.splice(t,1),this.$nextTick(()=>this.refreshPreview(e))},addObjectProperty(e){const t="prop"+(Object.keys(e.manualConfig.properties).length+1);this.$set(e.manualConfig.properties,t,{key:"",value:""}),this.$nextTick(()=>this.refreshPreview(e))},removeObjectProperty(e,t){this.$delete(e.manualConfig.properties,t),this.$nextTick(()=>this.refreshPreview(e))},generateManualValue(e){const t=e.manualConfig;switch(t.type){case"text":return t.convertToNumber&&!isNaN(e.manualValue)?Number(e.manualValue):e.manualValue;case"boolean":return e.manualValue;case"array":return t.items.filter(e=>""!==e);case"object":const i={};return Object.values(t.properties).forEach(e=>{e.key&&""!==e.value&&(i[e.key]=e.value)}),i;default:return e.manualValue}},handleClose(){this.$emit("update:visible",!1),this.$emit("close")},handleConfirm(){let e;e="form"===this.instanceType?"fill"===this.form.mode?this.fillEmptyFields(this.formInitialValue):this.generateSingleData():"fill"===this.form.mode?this.fillEmptyFields(this.data):this.generateTableData(),this.saveLocalCache(),this.$emit("generate",e,this.form.mode),this.handleClose()},generateSingleData(){const e={};return this.fields.forEach(t=>{e[t.prop]=this.generateFieldValue(t)}),e},generateTableData(){const e=[],t=this.form.count;for(let i=0;i<t;i++){const t={};this.fields.forEach(e=>{t[e.prop]=this.generateFieldValue(e)}),t.$mock=!0,e.push(t)}return e},fillEmptyFields(e){if("form"===this.instanceType){const t={...e};return this.fields.forEach(e=>{I(t[e.prop])&&(t[e.prop]=this.generateFieldValue(e))}),t}{const t=[...e];return t.forEach(e=>{this.fields.forEach(t=>{I(e[t.prop])&&(e[t.prop]=this.generateFieldValue(t))})}),t}},loadLocalCache(){const e=this.getCacheKey();if(!e)return;const t=(ze.local.getJSON("mockDataConfig")||{})[e];t&&(this.form.count=t.count||10,this.form.mode=t.mode||"append",t.fields&&this.fields.forEach(e=>{const i=t.fields.find(t=>t.prop===e.prop);i&&Object.assign(e,{genType:i.genType||"auto",manualValue:i.manualValue,regexPattern:i.regexPattern,ruleId:i.ruleId,ruleConfig:i.ruleConfig||{},manualConfig:i.manualConfig||{...this.defaultManualConfig}})}),t.deletedOriginalFields&&(this.fields=this.fields.filter(e=>!t.deletedOriginalFields.includes(e.prop))))},saveLocalCache(){const e=this.getCacheKey();if(!e)return;let t=ze.local.getJSON("mockDataConfig")||{};const i=this.fields.filter(e=>!e.isCustom).map(e=>e.prop),s=this.columns.filter(e=>e.prop&&!e.type).map(e=>e.prop).filter(e=>!i.includes(e));t[e]={count:this.form.count,mode:this.form.mode,fields:this.fields.map(e=>({prop:e.prop,genType:e.genType,manualValue:e.manualValue,regexPattern:e.regexPattern,ruleId:e.ruleId,ruleConfig:e.ruleConfig,manualConfig:e.manualConfig,isCustom:e.isCustom||!1})),deletedOriginalFields:s},ze.local.setJSON("mockDataConfig",t),this.saveCustomFieldsToCache()},getCacheKey(){if(!this.$parent.$route)return"";const e=this.$parent.$route.path.replace(/\/?\d+$/,"");return`${this.instanceType}_${e}`},loadCustomFieldsFromCache(){const e=this.getCustomFieldsCacheKey();return(ze.local.getJSON(e)||[]).map(e=>({...e,manualConfig:e.manualConfig||{...this.defaultManualConfig},isCustom:!0}))},saveCustomFieldsToCache(){const e=this.getCustomFieldsCacheKey(),t=this.fields.filter(e=>e.isCustom).map(e=>({prop:e.prop,label:e.label,genType:e.genType,manualValue:e.manualValue,regexPattern:e.regexPattern,ruleId:e.ruleId,ruleConfig:e.ruleConfig,manualConfig:e.manualConfig}));ze.local.setJSON(e,t)},getCustomFieldsCacheKey(){return this.getCacheKey()+"_custom_fields"},quickGenerateData(){this.initFields(),this.loadLocalCache(),this.analyzeComponentConfigs(),this.handleConfirm()},showAddFieldDialog(){this.newField={prop:"",label:""},this.addFieldDialogVisible=!0},addCustomField(){if(!this.newField.prop)return void this.$message.error("字段名称不能为空");if(this.fields.some(e=>e.prop===this.newField.prop))return void this.$message.error("字段名称已存在");const e={prop:this.newField.prop,label:this.newField.label||this.newField.prop,selectOptions:[],genType:"auto",manualValue:"",regexPattern:"",ruleId:"",ruleConfig:{},manualConfig:{...this.defaultManualConfig},isCustom:!0};this.fields.push(e),this.saveCustomFieldsToCache(),this.refreshPreview(e),this.addFieldDialogVisible=!1,this.$message.success("字段添加成功")},confirmDeleteField(e,t){const i=t.isCustom?`确定要删除自定义字段 "${t.label||t.prop}" 吗?`:`确定要删除原始字段 "${t.label||t.prop}" 吗?\n删除后可通过重置恢复`;this.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteField(e)}).catch(()=>{})},deleteField(e){const t=this.fields[e];this.fields.splice(e,1),this.$delete(this.previewValues,t.prop),this.$delete(this.loadingPreviews,t.prop),t.isCustom&&this.saveCustomFieldsToCache(),this.saveLocalCache(),this.$message.success("字段已删除")},resetFields(){this.$confirm("确定要重置所有字段吗？这将恢复所有原始字段并删除所有自定义字段","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=this.getCacheKey(),t=this.getCustomFieldsCacheKey();let i=ze.local.getJSON("mockDataConfig")||{};i[e]&&(i[e].deletedOriginalFields=[],ze.local.setJSON("mockDataConfig",i)),ze.local.setJSON(t,[]),this.initFields(),this.$message.success("已重置所有字段")}).catch(()=>{})}}}),lt=Object(se.a)(at,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-dialog",{class:[e.b(),"sc-dialog"],attrs:{title:e.dialogTitle,visible:e.visible,width:"800px","append-to-body":"","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{attrs:{model:e.form,"label-width":"100px",size:"small"}},[e.showBatchOptions?t("el-form-item",{attrs:{label:"数据处理"}},[t("el-row",{attrs:{gutter:10,type:"flex",align:"middle"}},["table"===e.instanceType?t("el-col",{attrs:{span:8}},[t("el-input-number",{attrs:{min:1,"controls-position":"right",disabled:"fill"===e.form.mode},model:{value:e.form.count,callback:function(t){e.$set(e.form,"count",t)},expression:"form.count"}}),e._v(" "),t("span",{staticClass:"form-tip"},[e._v("条数据")])],1):e._e(),e._v(" "),t("el-col",{attrs:{span:16}},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.form.mode,callback:function(t){e.$set(e.form,"mode",t)},expression:"form.mode"}},["table"===e.instanceType?t("el-radio-button",{attrs:{label:"append"}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 追加数据\n            ")]):e._e(),e._v(" "),t("el-radio-button",{attrs:{label:"replace"}},[t("i",{staticClass:"el-icon-refresh"}),e._v(" 替换数据\n            ")]),e._v(" "),t("el-radio-button",{attrs:{label:"fill"}},[t("i",{staticClass:"el-icon-edit"}),e._v(" 补充空值\n            ")])],1),e._v(" "),t("el-tooltip",{attrs:{placement:"top"}},[t("div",{attrs:{slot:"content"},slot:"content"},["table"===e.instanceType?t("p",[e._v("\n                追加：保留现有数据并添加新数据\n              ")]):e._e(),e._v(" "),t("p",[e._v("替换：清空现有数据后添加新数据")]),e._v(" "),t("p",[e._v("补充：仅填充现有数据中的空值字段")])]),e._v(" "),t("i",{staticClass:"el-icon-question help-icon"})])],1)],1)],1):e._e(),e._v(" "),t("el-divider",{attrs:{"content-position":"center"}},[e._v("\n      字段配置\n      "),t("div",{staticStyle:{display:"inline-block","margin-left":"10px"}},[t("el-button",{attrs:{type:"text",icon:"el-icon-plus",size:"mini"},on:{click:e.showAddFieldDialog}},[e._v("\n          添加字段\n        ")]),e._v(" "),t("el-button",{attrs:{type:"text",icon:"el-icon-refresh-right",size:"mini"},on:{click:e.resetFields}},[e._v("\n          重置字段\n        ")])],1)]),e._v(" "),t("div",{staticClass:"fields-container"},e._l(e.fields,(function(i,s){return t("el-form-item",{key:i.prop,staticClass:"field-item",attrs:{label:i.label||i.prop}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:15}},[t("el-select",{staticClass:"gen-type-select",attrs:{placeholder:"选择生成方式"},on:{change:()=>e.refreshPreview(i)},model:{value:i.genType,callback:function(t){e.$set(i,"genType",t)},expression:"field.genType"}},[t("el-option",{attrs:{label:"默认",value:"auto"}}),e._v(" "),t("el-option",{attrs:{label:"手动输入",value:"manual"}}),e._v(" "),t("el-option",{attrs:{label:"预设规则",value:"preset"}})],1),e._v(" "),"manual"===i.genType?[t("el-select",{staticClass:"mb-8 mt-8 full-width",attrs:{placeholder:"选择数据类型"},on:{change:()=>e.handleManualTypeChange(i)},model:{value:i.manualConfig.type,callback:function(t){e.$set(i.manualConfig,"type",t)},expression:"field.manualConfig.type"}},[t("el-option",{attrs:{label:"文本",value:"text"}}),e._v(" "),t("el-option",{attrs:{label:"布尔值",value:"boolean"}}),e._v(" "),t("el-option",{attrs:{label:"数组",value:"array"}}),e._v(" "),t("el-option",{attrs:{label:"对象",value:"object"}})],1),e._v(" "),"text"===i.manualConfig.type?t("div",{staticClass:"manual-text-input"},[t("el-input",{staticClass:"mt-8",attrs:{type:i.manualConfig.convertToNumber?"number":"textarea",placeholder:"请输入文本"},on:{input:()=>e.refreshPreview(i)},model:{value:i.manualValue,callback:function(t){e.$set(i,"manualValue",t)},expression:"field.manualValue"}}),e._v(" "),t("el-checkbox",{staticClass:"mt-8",on:{change:()=>e.refreshPreview(i)},model:{value:i.manualConfig.convertToNumber,callback:function(t){e.$set(i.manualConfig,"convertToNumber",t)},expression:"field.manualConfig.convertToNumber"}},[e._v("\n                  数字\n                ")])],1):e._e(),e._v(" "),"boolean"===i.manualConfig.type?t("el-radio-group",{staticClass:"mt-8",on:{change:()=>e.refreshPreview(i)},model:{value:i.manualValue,callback:function(t){e.$set(i,"manualValue",t)},expression:"field.manualValue"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1):e._e(),e._v(" "),"array"===i.manualConfig.type?t("div",{staticClass:"mt-8"},[e._l(i.manualConfig.items,(function(s,o){return t("div",{key:o,staticClass:"array-item"},[t("el-input",{staticClass:"array-input",attrs:{placeholder:"请输入数组项"},model:{value:i.manualConfig.items[o],callback:function(t){e.$set(i.manualConfig.items,o,t)},expression:"field.manualConfig.items[index]"}},[t("template",{slot:"append"},[t("el-button",{attrs:{icon:"el-icon-delete"},on:{click:function(t){return e.removeArrayItem(i,o)}}})],1)],2)],1)})),e._v(" "),t("el-button",{staticClass:"mt-8",attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){return e.addArrayItem(i)}}},[e._v("\n                  添加数组项\n                ")])],2):e._e(),e._v(" "),"object"===i.manualConfig.type?t("div",{staticClass:"mt-8"},[e._l(i.manualConfig.properties,(function(s,o){return t("div",{key:o,staticClass:"object-item"},[t("el-input",{staticClass:"object-key",attrs:{placeholder:"键名"},model:{value:i.manualConfig.properties[o].key,callback:function(t){e.$set(i.manualConfig.properties[o],"key",t)},expression:"field.manualConfig.properties[key].key"}}),e._v(" "),t("el-input",{staticClass:"object-value",attrs:{placeholder:"值"},model:{value:i.manualConfig.properties[o].value,callback:function(t){e.$set(i.manualConfig.properties[o],"value",t)},expression:"field.manualConfig.properties[key].value"}},[t("template",{slot:"append"},[t("el-button",{attrs:{icon:"el-icon-delete"},on:{click:function(t){return e.removeObjectProperty(i,o)}}})],1)],2)],1)})),e._v(" "),t("el-button",{staticClass:"mt-8",attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){return e.addObjectProperty(i)}}},[e._v("\n                  添加属性\n                ")])],2):e._e()]:e._e(),e._v(" "),"preset"===i.genType?[t("el-select",{staticClass:"mt-8 full-width",attrs:{placeholder:"选择规则类型"},on:{change:()=>e.refreshPreview(i)},model:{value:i.ruleId,callback:function(t){e.$set(i,"ruleId",t)},expression:"field.ruleId"}},e._l(e.ruleCategories,(function(i){return t("el-option-group",{key:i.value,attrs:{label:i.label}},e._l(e.getRulesByCategory(i.value),(function(i){return t("el-option",{key:i.id,attrs:{label:i.name,value:i.id}},[t("i",{class:[e.b("rule-icon"),i.icon]}),e._v(" "),t("span",[e._v(e._s(i.name))]),e._v(" "),t("span",{class:[e.b("rule-desc")]},[e._v(e._s(i.description))])])})),1)})),1),e._v(" "),i.ruleId&&e.getRuleConfig(i.ruleId)?t("div",{class:[e.b("rule-config"),"mt-8"]},e._l(e.getRuleConfig(i.ruleId),(function(s){return t("el-form-item",{key:s.field,class:[e.b("rule-config-item")],attrs:{label:s.label,"label-width":"90px"}},["input"===s.type?t("el-input",{attrs:{placeholder:s.placeholder},on:{input:()=>e.refreshPreview(i)},model:{value:i.ruleConfig[s.field],callback:function(t){e.$set(i.ruleConfig,s.field,t)},expression:"field.ruleConfig[config.field]"}}):"number"===s.type?t("el-input-number",{attrs:{min:s.min,max:s.max,"controls-position":"right"},on:{change:()=>e.refreshPreview(i)},model:{value:i.ruleConfig[s.field],callback:function(t){e.$set(i.ruleConfig,s.field,t)},expression:"field.ruleConfig[config.field]"}}):"select"===s.type?t("el-select",{attrs:{placeholder:"请选择"},on:{change:()=>e.refreshPreview(i)},model:{value:i.ruleConfig[s.field],callback:function(t){e.$set(i.ruleConfig,s.field,t)},expression:"field.ruleConfig[config.field]"}},e._l(s.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):"date"===s.type?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},on:{change:()=>e.refreshPreview(i)},model:{value:i.ruleConfig[s.field],callback:function(t){e.$set(i.ruleConfig,s.field,t)},expression:"field.ruleConfig[config.field]"}}):e._e()],1)})),1):e._e()]:e._e()],2),e._v(" "),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"preview-container"},[t("div",{staticClass:"preview-header"},[t("span",[e._v("预览")]),e._v(" "),t("div",[t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-refresh"},on:{click:function(t){return e.refreshPreview(i)}}}),e._v(" "),t("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.confirmDeleteField(s,i)}}})],1)]),e._v(" "),t("div",{staticClass:"preview-value"},[e.isPreviewLoading(i.prop)?[t("i",{staticClass:"el-icon-loading"})]:["text"===e.getPreviewType(i.prop)?[t("span",[e._v(e._s(e.getPreviewValue(i)))])]:"number"===e.getPreviewType(i.prop)?[t("span",{staticClass:"preview-number"},[e._v(e._s(e.getPreviewValue(i)))])]:"date"===e.getPreviewType(i.prop)?[t("span",{staticClass:"preview-date"},[e._v(e._s(e.getPreviewValue(i)))])]:"array"===e.getPreviewType(i.prop)||"object"===e.getPreviewType(i.prop)?[t("span",{class:["preview-"+e.getPreviewType(i.prop)]},[e._v(e._s(e.getPreviewValue(i)))])]:[t("span",[e._v(e._s(e.getPreviewValue(i)))])]]],2)])])],1)],1)})),1)],1),e._v(" "),t("el-dialog",{class:["sc-dialog"],attrs:{title:"添加自定义字段",visible:e.addFieldDialogVisible,width:"400px","append-to-body":""},on:{"update:visible":function(t){e.addFieldDialogVisible=t}}},[t("el-form",{attrs:{model:e.newField,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"字段名称",required:""}},[t("el-input",{attrs:{placeholder:"请输入字段名称(英文)"},model:{value:e.newField.prop,callback:function(t){e.$set(e.newField,"prop",t)},expression:"newField.prop"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"显示名称"}},[t("el-input",{attrs:{placeholder:"请输入显示名称"},model:{value:e.newField.label,callback:function(t){e.$set(e.newField,"label",t)},expression:"newField.label"}})],1)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addFieldDialogVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addCustomField}},[e._v("确定")])],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("\n      "+e._s(e.getConfirmButtonText)+"\n    ")])],1)],1)}),[],!1,null,null,null).exports,ct=["model","rules","labelPosition","labelWidth","labelSuffix","inline","inlineMessage","statusIcon","showMessage","size","disabled","validateOnRuleChange","hideRequiredAsterisk"];const ht={promise:Promise.resolve(),isProcessing:!1,add(e){this.isProcessing=!0;const t=this.promise.then(async()=>{try{await e()}catch(e){console.error("Form init error:",e)}finally{this.promise===t&&(this.isProcessing=!1)}});return this.promise=t,t}};function dt(e){const t=e.comp||{},i=t.name;return!!["el-checkbox-group","sc-checkbox"].includes(i)||(!("el-select"!==i&&"sc-select"!==i||!t.multiple)||("el-cascader"===i?!1!==t.emitPath:!(!t.options||!t.multiple)))}function ut(e,t={}){return dt(t)?[]:null==e?"":Array.isArray(e)?[]:"object"==typeof e?{}:"number"==typeof e?0:"boolean"!=typeof e&&""}function pt(e=[],t=1){let i=0;const s=e.findIndex((e,s)=>(i+=e.widthSize||1,i===t));return-1===s?e.length-1:s}var mt={data:()=>({isInitializing:!1,formBind:{}}),watch:{value(){this.isInitializing||ht.isProcessing||this.initFormValue()}},methods:{async initFormValue(){this.isInitializing||await ht.add(async()=>{this.isInitializing=!0;try{await this.$nextTick();let e={...this.value};this.trueRenderColumns.forEach(t=>{if(void 0===this.getByProp(e,t.prop)){const i=function(e){return void 0!==e.initValue?e.initValue:dt(e)?[]:""}(t);this.setByProp(e,t.prop,i)}}),this.setControl(),this.$emit("input",e),await this.$nextTick(),this.clearValidate()}finally{this.isInitializing=!1}})},setControl(){this.trueRenderColumns.forEach(e=>{let t=e.prop,i=e.deepProp;if(!this.formBind[t]){let e=[];if(i){let s=this.$watch("value."+t,(e,t)=>{e!=t&&Object(Y.a)(this.value,i,e)}),o=this.$watch("value."+i,(e,i)=>{e!=i&&this.$set(this.value,t,e)});e.push(s),e.push(o),this.$set(this.value,t,Object(g.a)(this.value,i))}this.formBind[t]=e}})}}},ft={methods:{validate(e){return new Promise((t,i)=>{this.$refs.formRef.validate((s,o)=>{s?(e&&e(!0),t()):(i(o),e&&e(!1),this.formOptions.scrollError&&function(e,t){const i=Object.keys(e)[0],s=t[i]&&t[i][0].$refs.formItem;Object.keys(e).length&&s&&s.$el.scrollIntoView({behavior:"smooth",block:"center"})}(o,this.$refs))})})},async submit(){await this.validate(),this.loadingStatus=!0,this.runBefore("submit",()=>{this.loadingStatus=!1},this.value)},clearValidate(e){this.$refs.formRef&&this.$refs.formRef.clearValidate(e)},validateField(e){this.$refs.formRef&&this.$refs.formRef.validateField(e)}}},gt={methods:{reset(e=!0,t=[]){e?this.completelyClear(t):this.$refs.formRef&&this.$refs.formRef.resetFields(),this.$emit("reset",this.value)},completelyClear(e=[]){const t=this.value;this.trueRenderColumnsBeforeFilter.forEach(i=>{const s=i.prop;if(e.includes(s))return;if(void 0!==i.initValue)return void this.setByProp(t,s,i.initValue);const o=ut(this.getByProp(this.value,s),i);this.setByProp(t,s,o)}),this.$nextTick(()=>{this.clearValidate()})},resetField(e,t=!0){(Array.isArray(e)?e:[e]).forEach(e=>{if(t){const t=this.columnsMap[e],i=ut(this.getByProp(this.value,e),t);this.setByProp(this.value,e,i)}else this.$emit("handleChild","resetField",e)})}}},yt={methods:{initColumn(e,t){const i=e.detail;if(i){const t=i.formatter||i.comp||i.render;e.detail=function(e,t,i){if(!1!==t)return t=P("render",(t=Object(T.a)(t)?t:{}).presetType,t),i=Object(f.a)(i),!0!==t.hidden?Object(y.a)({label:e.label,prop:e.prop,...i},t):void 0}(e,i,t?Object(re.a)(e,["label","prop","required","regular","rules"]):Object(w.a)(e,["detail"]))}},groupBy(e){return function(e,t){return t&&Array.isArray(t)?t.map(t=>({label:t.label,children:t.children.map(t=>e.find(e=>e.prop===t))})):e}(e,this.formOptions.group)},refreshForm(){const e=Object(f.a)(this.value);this.$emit("input",{}),this.key=Math.random(),setTimeout(()=>{this.$emit("input",e)},100)},getFirstRowLastCellIndex:(e=[],t=1)=>pt(e,t),calcEmptyCount(){return function(e,t){const i=e.length,s=t(),o=i%s;return o===s-1||1===s?0:0===o?s-1:s-o-1}(this.trueRenderColumns,()=>{const e=this.$refs.gridRef.$el;if(!e)return 1;return window.getComputedStyle(e).gridTemplateColumns.split(" ").length})}}},bt=a({name:"form",components:{grid:ye,cell:ve,group:Be,formItem:Pe,formAction:Ve,position:oe,draftDrawer:Ke,batchMockData:lt},props:{value:{type:Object,default:()=>({})},scope:{type:Object,default:()=>({})},loading:{type:Boolean},actionInLastCell:Boolean},provide(){return{formCtx:this,controlCtx:this}},mixins:[J("formOptions"),Z,He,Q,mt,ft,gt,yt],data:()=>({key:1,loadingStatus:!1,emptyCount:0,mockDialogVisible:!1}),created(){this.initFormValue()},mounted(){this.extendMethod(this.$refs.formRef),this.actionInLastCell&&(this.emptyCount=this.calcEmptyCount(),this.resizeObserver=new ResizeObserver(()=>{this.emptyCount=this.calcEmptyCount()}),this.resizeObserver.observe(this.$el))},updated(){this.actionInLastCell&&this.$nextTick(()=>{this.emptyCount=this.calcEmptyCount()})},beforeDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()},computed:{formOptions(){return this.resultOptions},isGroup(){return this.formOptions.group||""===this.formOptions.group},isDetail(){return this.formOptions.detail||""===this.formOptions.detail},isBorder(){return this.formOptions.border||""===this.formOptions.border},isDisabled(){return this.loadingStatus||this.formOptions.disabled},isLoading(){return!!this.isDetail&&this.loadingStatus},columns(){return this.groupBy(N(this.resultColumns,this.formScope))},trueRenderColumns(){let e=[];return this.columns.forEach(t=>{t.children?e.push(...t.children):e.push(t)}),e},trueRenderColumnsBeforeFilter(){let e=[];return this.groupBy(this.resultColumns).forEach(t=>{t.children?e.push(...t.children):e.push(t)}),e},columnsMap(){const e={};return this.trueRenderColumns.forEach(t=>{e[t.prop]=t}),e},formScope(){const e={row:this.value,form:this.$refs.formRef};return this.scope?{...this.scope,...e}:e},slots(){return this.formOptions.slots||this.$scopedSlots},layoutCell(){return"grid"===this.formOptions.layout?"cell":"el-row"===this.formOptions.layout?"el-col":void 0},firstRowLastCellIndex(){if(this.isGroup){return this.columns.reduce((e,t,i)=>(e[i]=pt(t.children,t.columns),e),{})||{}}return pt(this.columns,this.formOptions.columns)},formProps(){return function(e){const t={};return Object.keys(e).forEach(i=>{t[F(i)]=e[i]}),Object(re.a)(t,ct)}(this.formOptions)}},watch:{loading:{handler(e){void 0!==e&&(this.loadingStatus=e)},immediate:!0},loadingStatus(e){this.$emit("update:loading",e)}},methods:{openMockDialog(){this.mockDialogVisible=!0},handleGenerateFormData(e){for(const t in e)this.$set(this.value,t,e[t]);this.$message.success("已生成测试数据")}}}),vt=Object(se.a)(bt,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:[e.b(),{"sc-form--border":e.isDetail&&e.isBorder,"sc-form--group":e.isGroup}],style:{padding:e.formOptions.gap},on:{contextmenu:e.handleContextMenu}},[t("div",{staticStyle:{"min-height":"0",position:"relative"}},[t("position",{attrs:{slotName:"title",render:e.formOptions.titleRender,slots:e.$scopedSlots}},[e.formOptions.title?t("div",{staticClass:"sc-title"},[e._v("\n        "+e._s(e.formOptions.title)+"\n      ")]):e._e()]),e._v(" "),t("el-form",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],key:e.key,ref:"formRef",attrs:{disabled:e.isDisabled,model:e.value},nativeOn:{submit:function(e){e.preventDefault()}}},"el-form",e.formProps,!1),[e.isGroup?[e._l(e.columns,(function(i,s){return t("group",e._b({key:s,attrs:{border:!e.isBorder}},"group",i,!1),[i.children?t(e.formOptions.layout,e._b({tag:"component",style:{padding:`0 ${i.gap}px`}},"component",i,!1),e._l(i.children,(function(i,o){return t("formItem",e._b({key:o,ref:i.prop,refInFor:!0,attrs:{col:i,"is-first-row":o<=e.firstRowLastCellIndex[s]}},"formItem",i,!1))})),1):t("position",{attrs:{slotName:i.prop,render:i.render,slots:e.slots,scope:e.formScope}})],1)})),e._v(" "),t("formAction")]:t(e.formOptions.layout,e._b({ref:"gridRef",tag:"component",style:{padding:`0 ${e.formOptions.gap}px`}},"component",e.formOptions,!1),[e._l(e.columns,(function(i,s){return t("formItem",e._b({key:s,ref:i.prop,refInFor:!0,attrs:{col:i,"is-first-row":s<=e.firstRowLastCellIndex}},"formItem",i,!1))})),e._v(" "),e._l(e.emptyCount,(function(e){return t("cell",{key:"empty"+e,staticStyle:{visibility:"hidden"}})})),e._v(" "),t("formAction")],2)],2)],1),e._v(" "),t("draftDrawer",{ref:"draftDrawer"}),e._v(" "),t("batchMockData",{ref:"batchMockData",attrs:{visible:e.mockDialogVisible,columns:e.trueRenderColumns,"instance-type":"form","instance-ref":e.$refs.formRef,formInitialValue:e.value},on:{"update:visible":function(t){e.mockDialogVisible=t},generate:e.handleGenerateFormData}})],1)}),[],!1,null,null,null).exports,wt=a({props:{ctx:{type:Object,default:()=>{}},mode:String,scope:{type:Object,default:()=>{}},loading:Boolean},components:{scForm:vt},computed:{formOptions(){return{...Object(y.a)({},this.ctx.crudOptions.formOptions,this.ctx.crudOptions[this.mode+"Form"]),renderColumns:N(this.ctx.getRenderColumns(this.mode))}},options(){return{detail:"view"===this.mode,labelPosition:"left",columns:2,columnGap:"10px",slots:this.ctx.extendsScopedSlots,mode:this.mode,defaultRender:(e,t)=>Object(m.a)(this.formOptions.defaultRender)?this.formOptions.defaultRender(e,t):"view"===t.mode&&"table"===this.formOptions.viewType?u.formatter(e,t):u.input(e,t),...this.formOptions}}},mounted(){this.ctx.$refs.crudForm=this.$refs.crudForm},methods:{}}),xt=Object(se.a)(wt,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("scForm",{ref:"crudForm",attrs:{options:e.options,scope:e.scope,loading:e.loading},on:{"update:loading":function(t){e.loading=t}},model:{value:e.ctx.form,callback:function(t){e.$set(e.ctx,"form",t)},expression:"ctx.form"}})}),[],!1,null,null,null).exports,St=(e={})=>a({name:"dialog",mixins:[J("dialogOptions",e)],data:()=>({visible:!1,loading:!1,value:{}}),created(){this.$nextTick(()=>{Object(m.a)(e.created)&&e.created(this)})},mounted(){this.$nextTick(()=>{Object(m.a)(e.mounted)&&e.mounted(this)})},computed:{dialogOptions(){let t=this.resultOptions;return e.presetType&&(t.presetType=e.presetType),t=A("render",[t],this,{},!0)[0],t},dialogType(){return this.dialogOptions.drawer?"elDrawer":"elDialog"},footerTemps(){return{confirm:{icon:"el-icon-circle-check",label:"确定",type:"primary",onClick:this.confirm},cancel:{icon:"el-icon-circle-close",label:"取消",onClick:this.cancel},close:{label:"关闭",type:"primary",onClick:this.hide}}},footerButtons(){const e={...this.dialogOptions.footer};return e?A("btn.dialog",e,{ctx:this},this.footerTemps):[]},showFooter(){return z(this.dialogOptions.footer,null,this.footerButtons.length>0)},omitProps(){return Object(w.a)(this.dialogOptions,["size","beforeClose","title","fullscreen"])}},methods:{async confirm(e){const t=e=>{this.visible=!1,this.confirmCb(this,e)},i=H(this,["sc-crud","sc-form","ElForm"],10,"down");return i&&i.validate&&await i.validate(),"function"==typeof this.dialogOptions.confirm?this.dialogOptions.confirm(t,this,e):t(),this},cancel(e){const t=e=>{this.visible=!1,this.cancelCb(this,e)};return"function"==typeof this.dialogOptions.cancel?this.dialogOptions.cancel(t,this,e):t(),this},closed(){this.dialogOptions.cache||this.destroy(),Object(m.a)(this.dialogOptions.closed)&&this.dialogOptions.closed(this)},destroy(){this.$destroy(),this.$el.remove()},hide(){return this.visible=!1,this},show(e=(()=>{}),t=(()=>{})){return this.visible=!0,this.confirmCb=e,this.cancelCb=t,this}},render(e){const t={...this.dialogOptions,"update:visible":e=>{this.visible=e},closed:this.closed};return e(this.dialogType,c()([{directives:[{name:"sc-dialog-drag",value:this.dialogOptions.drag},{name:"sc-dialog-drag-height",value:this.dialogOptions.dragSize},{name:"sc-dialog-fullscreen",value:this.dialogOptions.fullscreen}],class:[this.b(),this.dialogOptions.class],attrs:{size:V(this.dialogOptions.width||"600px"),width:V(this.dialogOptions.width||"600px"),visible:this.visible,beforeClose:this.cancel,"close-on-click-modal":!1}},{props:this.omitProps},{},{on:t},{scopedSlots:{title:()=>e("div",{class:[this.b("title")],style:{height:this.dialogOptions.drawer?"":"50px"}},[e("span",[this.dialogOptions.title]),this.dialogOptions.drawer?null:e("span",[this.dialogOptions.fullscreen&&e("i",{attrs:{title:"最大化"},class:"el-icon-full-screen"}),this.dialogOptions.drag&&e("i",{attrs:{title:"拖拽"},class:"el-icon-rank dialog-drag"})])])}}]),[e("div",{class:[this.b("body"),this.showFooter?"has-footer":""]},[(e=>e(Re,c()([{directives:[{name:"loading",value:this.loading}],attrs:{prop:"value"}},{props:this.dialogOptions},{attrs:{item:this.dialogOptions,scope:{ref:this,row:this},controlDefault:()=>null}}])))(e)]),(e=>{if(!1===this.showFooter)return;const t=this.dialogOptions.footer.render,i=()=>this.footerButtons.map(t=>e(Fe,c()([{},{props:t},{},{attrs:Object(w.a)(t,["onClick"])},{attrs:{loading:this.loading,size:this.dialogOptions.size,scope:this},on:{click:()=>t.onClick(this)}}])));return e("div",{class:this.b("footer",this.dialogOptions.footer.align||"right")},[t?L(t,e,this,i):i()])})(e)])}}),Ct=function(e){const t=this||{};let i=window.Vue.extend(St(e));const s={beforeCreate(){this._routerRoot=t._routerRoot}};t._routerRoot&&i.mixin(s);let o=new i;return o.vm=o.$mount(),document.body.appendChild(o.vm.$el),o.vm},Ot={data(){return this.title={add:"新增",edit:"编辑",view:"查看"},{dialogLoading:!1}},computed:{dialogOptions(){return this.crudOptions.dialog}},watch:{dialogLoading(e){this.$refs.dialogVm&&(this.$refs.dialogVm.loading=e)}},methods:{changeDialogLoading(e=!1){this.dialogLoading=e},handleAdd(e){this.runBefore(["add"],(t={})=>{this.form=t,this.openDialogForm("add",{},e)},{mode:"add"})},handleView(e){this.runBefore(["view"],t=>{this.openDialogForm("view",e),this.getDetail(e,t)},{...e,mode:"view"})},getDetail(e,t){this.changeDialogLoading(!0);this.runBefore("getDetail",i=>{this.form=t||i||Object(f.a)(e.row),this.changeDialogLoading()},e,this.changeDialogLoading)},handleEdit(e){this.runBefore(["edit"],t=>{this.openDialogForm("edit",e),this.getDetail(e,t)},{...e,mode:"view"})},handleSave(e,t,i){this.$refs.crudForm.validate().then(()=>{this.changeDialogLoading(!0);this.runBefore(["save"],s=>{"add"===e.mode?"first"===i?this.list.unshift(s||this.form):this.list.push(s||this.form):this.$set(this.list,e.$index,s||this.form),t(),this.changeDialogLoading(),this.getList()},e,this.changeDialogLoading)})},openDialogForm(e,t={},i){const s=this.$createElement;t={...t,row:this.form,mode:e},this.$refs.dialogVm=Ct({title:this.title[e],render:()=>s(xt,{attrs:{loading:this.dialogLoading,ctx:this,mode:e,scope:t}}),confirm:e=>{const s={...t,formRef:this.$refs.crudForm};this.handleSave(s,e,i)},footer:"view"!==e,...this.dialogOptions}),this.$refs.dialogVm.show()}}},$t={props:{selected:{type:[Object,Array]}},data:()=>({selectionRow:[],shiftOrAltDown:!1,CtrlDown:!1,EscDown:!1}),mounted(){this.showSelection&&(this.$el.addEventListener("keydown",this.keyDown,{passive:!0}),this.$el.addEventListener("keyup",this.keyUp,{passive:!0}))},beforeDestroy(){this.showSelection&&(this.$el.removeEventListener("keydown",this.keyDown),this.$el.removeEventListener("keyup",this.keyUp))},watch:{selected:{handler(e,t){this.showSelection&&!this._isInternalUpdateSelection&&this.$nextTick(()=>{e&&t&&!Object(ne.a)(e.map(e=>null==e?void 0:e[this.operateKey]),t.map(e=>null==e?void 0:e[this.operateKey]))&&this.updateSelection()})},immediate:!0}},computed:{showSelection(){return z(this.crudOptions.selection)},showSingleSelection(){return z(this.crudOptions.singleSelection)},selection(){return{dataSyncSelected:this.crudOptions.dataSyncSelected,...this.crudOptions.selection}},singleSelection(){return this.crudOptions.singleSelection},maxSelectionRow(){return 0==this.selectionRow.length?null:this.selectionRow.reduce((e,t)=>e.$index>t.$index?e:t)},minSelectionRow(){return 0==this.selectionRow.length?null:this.selectionRow.reduce((e,t)=>e.$index<t.$index?e:t)},operateKey(){return this.selection.spanProp||this.valueKey},selectedOperateKeys(){return this.selected&&this.selected.length>0?this.selected.map(e=>e[this.operateKey]):[]}},methods:{keyDown(e){switch(e.keyCode){case 17:this.CtrlDown=!0,document.body.style.cursor="pointer";break;case 16:this.shiftOrAltDown=!0,document.body.style.cursor="cell",document.onselectstart=()=>!1,document.body.style.userSelect="none";break;case 27:this.EscDown=!0}},keyUp(e){switch(e.keyCode){case 17:this.CtrlDown=!1,document.body.style.cursor="";break;case 16:this.shiftOrAltDown=!1,document.body.style.cursor="",document.onselectstart=null,document.body.style.userSelect="";break;case 27:this.EscDown=!1}},rowClassName_({row:e,rowIndex:t,column:i,columnIndex:s}){return this.crudOptions.rowClassName?this.crudOptions.rowClassName.call(null,{row:e,column:i,rowIndex:t,columnIndex:s}):""},selectRowClick(e,t,i){if(this.showSingleSelection&&!1!==this.singleSelection.ctrlSelect&&this.CtrlDown){if(Object(m.a)(this.singleSelection.selectable)){if(!this.singleSelection.selectable(e,e.$index))return}return void this.$emit("update:selected",e)}if(!this.showSelection)return;if(!this.selectionSelectable(e,e.$index))return;let s=this.$refs.tableRef;if(!1!==this.selection.ctrlSelect&&this.CtrlDown)return s.toggleRowSelection(e),void this.select(this.selectionRow,e);if(!1!==this.selection.shiftSelect&&this.shiftOrAltDown){var o,r,n,a;let t=this.getmaxAndminObj(e.$index,null!==(o=null===(r=this.maxSelectionRow)||void 0===r?void 0:r.$index)&&void 0!==o?o:e.$index,null!==(n=null===(a=this.minSelectionRow)||void 0===a?void 0:a.$index)&&void 0!==n?n:0);s.clearSelection(),this.clearSelection();for(let e=t.min;e<=t.max;e++)s.toggleRowSelection(this.flatList[e],!0);this.select(this.selectionRow,e),this.shiftOrAltDown=!1}},getmaxAndminObj:(e=0,t,i)=>e>t||e<t&&e>i?{min:i,max:e}:e<i?{min:e,max:t}:e==i||e==t?{min:i,max:t}:void 0,updateSelection(){var e;if(!this.$refs.tableRef)return;if(null===(e=this.selected)||void 0===e||!e.length)return;this._isInternalUpdateSelection=!0,this._isPaging||this.$refs.tableRef.clearSelection();const t=new Map;this.selected.forEach((e,i)=>{const s=e[this.operateKey];void 0!==s&&t.set(s,{item:e,index:i})});const i=[];this.flatList.forEach(e=>{const s=e[this.operateKey];if(void 0!==s&&t.has(s)){const{item:o}=t.get(s);this.selection.dataSyncSelected&&Object(y.a)(e,o),i.push(e),this.$refs.tableRef.toggleRowSelection(e,!0),t.delete(s)}}),t.forEach(({item:e})=>{i.push(e)}),(i.length>0||this.selected.length>0)&&this.selected.splice(0,this.selected.length,...i),this._isPaging=!1,setTimeout(()=>{this._isInternalUpdateSelection=!1},100)},selectionChange(e){this._isInternalUpdateSelection||(this.selectionRow=e,this.$emit("selection-change",e))},select(e,t){if(!this.selected)return;if(void 0===t[this.operateKey])return void console.error(`[CRUD Error] row.${this.operateKey}不存在，没有唯一值无法进行选中数据绑定，请设置正确的valueKey`);const i=this.flatList.findIndex(e=>e===t);if(-1!==i&&this.getRowErrorType){const e=this.getRowErrorType(i);if(e){const t={MISSING_ID:"[CRUD Error] 该行缺失ID字段，无法选中",DUPLICATE_ID:"[CRUD Error] 该行ID与其他行重复，无法选中"};return void console.error(t[e]||"[CRUD Error] 该行数据异常，无法选中")}}this.selectionSelectable(t,t.$index)&&(e.indexOf(t)>-1?this.addSelection(t):this.removeSelection(t))},selectAll(e){if(!this.selected)return;if(this.invalidRows&&this.invalidRows.size>0){const e=Array.from(this.invalidRows.values()).filter(e=>"MISSING_ID"===e).length,t=Array.from(this.invalidRows.values()).filter(e=>"DUPLICATE_ID"===e).length;let i="当前页面存在异常数据，将跳过问题行";e>0&&t>0?i+=`（缺失ID ${e}行，重复ID ${t}行）`:e>0?i+=`（缺失ID ${e}行）`:t>0&&(i+=`（重复ID ${t}行）`),console.error("[CRUD Error] "+i)}const t=this.$refs.tableRef.store.states.isAllSelected,i=new Set(this.flatList.map(e=>e[this.operateKey]));if(t){const t=[];e.forEach(e=>{const i=this.flatList.findIndex(t=>t===e);if(this.getRowErrorType&&-1!==i&&this.getRowErrorType(i))return;-1===this.selected.findIndex(t=>t[this.operateKey]===e[this.operateKey])&&this.selectionSelectable(e,e.$index)&&t.push(e)}),t.length>0&&this.selected.push(...t)}else{const e=this.selected.filter(e=>!i.has(e[this.operateKey])||!this.selectionSelectable(e,e.$index));e.length!==this.selected.length&&this.selected.splice(0,this.selected.length,...e)}},addSelection(e){if(!this.selected)return;const t=e[this.operateKey];if(void 0!==t)if(this.selection.spanProp){this.removeSelection(e);const i=[],s=[];this.flatList.forEach(e=>{e[this.operateKey]===t&&(i.push(e),s.push(e))}),i.length>0&&(this.selected.push(...i),this.$nextTick(()=>{this.$refs.tableRef&&s.forEach(e=>{this.$refs.tableRef.toggleRowSelection(e,!0)})}))}else-1===this.selectedOperateKeys.indexOf(t)&&(this.selected.push(e),this.$nextTick(()=>{this.$refs.tableRef&&this.$refs.tableRef.toggleRowSelection(e,!0)}));else console.error(`[CRUD Error] 无法添加选中项：${this.operateKey} 不存在`)},removeSelection(e){if(!this.selectionSelectable(e,e.$index))return;if(!this.selected)return;const t=e[this.operateKey];if(void 0!==t)if(this.selection.spanProp){const e=[],i=[];this.selected.forEach((s,o)=>{s[this.operateKey]===t&&(i.push(o),e.push(s))}),i.length>0&&(i.sort((e,t)=>t-e),i.forEach(e=>{this.selected.splice(e,1)}),this.$nextTick(()=>{this.$refs.tableRef&&e.forEach(e=>{this.$refs.tableRef.toggleRowSelection(e,!1)})}))}else{const i=this.selectedOperateKeys.indexOf(t);if(i>-1){const t=this.selected[i];this.selected.splice(i,1),this.$nextTick(()=>{this.$refs.tableRef&&this.$refs.tableRef.toggleRowSelection(t||e,!1)})}}else console.error(`[CRUD Error] 无法移除选中项：${this.operateKey} 不存在`)},removeSingleSelection(){this.$emit("update:selected",null)},clearSelection(){if(this.$refs.tableRef.clearSelection(),this.selectionRow=[],!this.selected)return;const e=this.selected.filter(e=>!this.selectionSelectable(e,e.$index));e.length!==this.selected.length&&(this.selected.splice(0,this.selected.length,...e),e.length&&this.$nextTick(()=>{e.forEach(e=>{this.$refs.tableRef&&this.$refs.tableRef.toggleRowSelection(e,!0)})}))},selectionSelectable(e,t){if(Object(m.a)(this.selection.selectable)){if(!this.selection.selectable(e,t))return!1}return!0}}},_t={data(){return{tableTop:0,wrapperTop:0,innerHeight:innerHeight,observer:new IntersectionObserver(e=>{e.forEach(e=>{this.visibilityCallback&&this.visibilityCallback(e.isIntersecting)})}),visibilityCallback:null}},created(){this.handleResize=Object(ue.a)(this.handleResize,200)},mounted(){window.addEventListener("resize",this.handleResize),this.getClientTop()},destroyed(){window.removeEventListener("resize",this.handleResize),this.observer.disconnect()},computed:{defaultHeight(){return this.crudOptions.defaultHeight||200},isAutoHeight(){return"auto"===this.crudOptions.height},tableHeight(){if(!this.isAutoHeight)return this.crudOptions.height;const e=(this.crudOptions.calcHeight||0)+this.footerHeight,t=this.defaultHeight-(this.tableTop-this.wrapperTop)-this.footerHeight;return Math.max(Math.ceil(this.innerHeight-this.tableTop-e),t)+"px"},wrapperHeight(){if(!this.isAutoHeight)return"auto";const e=this.crudOptions.calcHeight||0;return Math.max(Math.ceil(this.innerHeight-this.wrapperTop-e),this.defaultHeight)+"px"},footerHeight(){return!1===z(this.crudOptions.pagination,null,this._total>0)?0:50}},updated(){this.getClientTop()},activated(){this.getClientTop()},methods:{getClientTop(){this.isAutoHeight&&this.$nextTick(()=>{var e;const t=null===(e=this.$refs.tableRef)||void 0===e?void 0:e.$el;this.observeVisibility(t,e=>{if(e){var i;const e=null==t?void 0:t.getBoundingClientRect().top;this.tableTop!==e&&(this.tableTop=e);const s=null===(i=this.$refs.wrapper)||void 0===i?void 0:i.getBoundingClientRect().top;this.wrapperHeight!==s&&(this.wrapperTop=s)}this.$nextTick(()=>{this.observer.disconnect()})})})},observeVisibility(e,t){this.visibilityCallback=t,this.observer.observe(e)},handleResize(){this.innerHeight=innerHeight,this.getClientTop(),this.$refs.searchRef.calculateCollapsedHeight()}}},kt={computed:{sameRowMap(){const e=Array.from(new Set(this.sameRowSpans));if(!e.length)return{};const t={};return e.forEach(i=>{const s=this.createGroupMap(this.list,i,e);this.addSpanIndex(s),t[i]=s}),t},sumColumnList(){return this.trueRenderColumns.filter(e=>e.summary)},showSummary(){return this.crudOptions.showSummary||""===this.crudOptions.showSummary||this._showSummary||Object(m.a)(this.crudOptions.summaryMethod)}},methods:{addSpanIndex(e){if(!e)return;const t=[];Object.keys(e).forEach(i=>{e[i].forEach(e=>{t.push(e)})}),t.sort((e,t)=>e.firstIndex-t.firstIndex),t.forEach((e,t)=>{e.spanIndex=t})},_sortedData(e,t){const i=[...t||this.crudOptions.sortProps||this.sameRowSpans];i.length&&i.forEach((t,s)=>{const o=i.slice(0,s).map(e=>"string"==typeof e?e:e.prop),r="string"==typeof t?t:t.prop;this.sortByFieldWithinGroups(r,o,t,e)})},sortByFieldWithinGroups(e,t,i,s){if(!t.length)return this.sortByFieldPreservingOrder(s,e),Object(m.a)(null==i?void 0:i.sortMethod)&&s.sort((e,t)=>null==i?void 0:i.sortMethod(e,t)),void(null!=i&&i.order&&s.sort((t,s)=>this.compareValue(t,s,e,i)));const o=this.groupByFields(s,t),r=Object.keys(o);let n=0;r.forEach(t=>{const r=o[t];this.sortByFieldPreservingOrder(r,e),Object(m.a)(null==i?void 0:i.sortMethod)&&r.sort((e,t)=>null==i?void 0:i.sortMethod(e,t)),null!=i&&i.order&&r.sort((t,s)=>this.compareValue(t,s,e,i)),r.forEach((e,t)=>{s[n+t]=e}),n+=r.length})},groupByFields:(e,t)=>e.reduce((e,i)=>{const s=t.map(e=>i[e]).join("_");return e[s]||(e[s]=[]),e[s].push(i),e},{}),compareValue(e,t,i,s={}){const{order:o="asc",nullsPosition:r="last"}=s,n=e[i],a=t[i],l=null==n||""===n,c=null==a||""===a;if(l&&c)return 0;if(l)return"first"===r?-1:1;if(c)return"first"===r?1:-1;if(!isNaN(n)&&!isNaN(a))return"asc"===o?Number(n)-Number(a):Number(a)-Number(n);if("string"==typeof n&&"string"==typeof a){const e=n.localeCompare(a);return"asc"===o?e:-e}return 0},sortByFieldPreservingOrder(e,t){const i=new Set;let s=0;for(;s<e.length;){if(i.has(s)){s++;continue}const o=e[s][t];i.add(s);let r=s+1;for(let s=r;s<e.length;s++)if(!i.has(s)&&e[s][t]===o){if(s!==r){const t=e[s];for(let t=s;t>r;t--)e[t]=e[t-1];e[r]=t}i.add(r),r++}s=r}return e},spanMethod(e){const{row:t,column:i,rowIndex:s}=e,o=i.col,r=i.options;if(!o&&!r)return;if(null!=r&&r.spanMethod){const t=r.spanMethod(e);if(t)return t}if(o.spanMethod)return o.spanMethod(e);const n=o.spanProp||o.sameRowSpan;if(n){const e="string"==typeof n?n:o.prop,i=this.sameRowMap[e];if(i){const o=(i[t[e]]||[]).find(e=>s>=e.firstIndex&&s<e.firstIndex+e.span);if(o)return s===o.firstIndex?{rowspan:o.span,colspan:1}:{rowspan:0,colspan:0}}}},createGroupMap(e,t,i){const s={};let o=[],r={};return e.forEach((e,n)=>{this.isGroupChanged(e,r,i,t)?(o.length>0&&this.processGroup(s,o,r[t]),o=[{item:e,index:n}],i.forEach(t=>{r[t]=e[t]})):o.push({item:e,index:n})}),o.length>0&&this.processGroup(s,o,r[t]),s},isGroupChanged(e,t,i,s){if(0===Object.keys(t).length)return!0;const o=i.indexOf(s);for(let s=0;s<=o;s++){const o=i[s];if(e[o]!==t[o])return!0}return!1},processGroup(e,t,i){e[i]||(e[i]=[]),e[i].push({firstIndex:t[0].index,span:t.length,items:t.map(e=>e.item)})}}},Dt={methods:{resetBatchEdit(){this.$refs.menuBar&&this.$refs.menuBar.resetBatchEdit()},resetField(e){this.$emit("handleChild","resetField",e)},reset(){this.$refs.tableFormRef&&this.$refs.tableFormRef.resetFields(),this.$emit("reset")},sortedData(e,t){this._sortedData(e||this.list,t)},addRow(e={},t="last",i){this.handleRowAdd(e,t,i)},setRowEdit(e,t={}){const{type:i="edit",prop:s}=t;(Array.isArray(e)?e:[e]).forEach(e=>{const t={row:e,$index:e.$index};switch(i){case"edit":this.handleRowEdit(t,s);break;case"cancel":this.handleRowCancel(t);break;case"save":this.handleRowSave(t)}})},setBatchEdit(e="edit",t){"edit"===e?this.handleBatchRowEdit(t):"save"===e?this.handleBatchRowSave(void 0,t):"cancel"===e&&this.handleBatchRowCancel(t)},setCellEdit(e,t){if(!t)return;const i=this.columnsMap[t];if(!i)return;const s={row:e,$index:e.$index};this.handleCellEdit(s,i)},getEditingRows(){var e;return(null===(e=this.editState)||void 0===e?void 0:e.getEditingRows().map(e=>e.row))||[]},clearAllEdit(){var e;null===(e=this.editState)||void 0===e||e.clearAllEditStatus(),this.resetBatchEdit(),this.forceUpdate()},forceUpdate(){this._forceUpdate()}}},Et={methods:{insertColumns(e,t,i){if(t=[...t],!Array.isArray(e))return t;let s=-1;if("string"==typeof i){if(s=t.findIndex(e=>e.prop===i),s+=1,-1===s)return console.warn(`insertColumns: 未找到prop为${i}的列`),t}else if("number"==typeof i){if(i<0||i>t.length)return console.warn("insertColumns: index超出范围"),t;s=i}else s=t.length;return e.forEach(e=>{this.initColumn(e,s)}),t.splice(s,0,...e),t},prepareData(e,t,i=0,s){if(!Array.isArray(e)||null==t||!t.length)return[];if(s)return e;const o=t[i];return o?"function"==typeof o.dataTransformer?o.dataTransformer(e):e.flatMap(e=>{const t=e[o.path||"children"];return Array.isArray(t)?t:[]}):[]},generateDynamicColumns(e,t){const i=(e,s=0,o="")=>{if(null==e||!e.length||s>=t.length)return[];const r=t[s],n=new Map;return e.forEach(e=>{const t=e[r.prop],i="function"==typeof r.label?r.label(e):e[r.label];t&&(n.has(t)?n.get(t).sourceItems.push(e):n.set(t,{...r,prop:t,label:i||"未命名-"+t,sourceItems:[e]}))}),Array.from(n.values()).map(({prop:e,label:n,sourceItems:a,path:l,dataTransformer:c,...h})=>{const d=o?`${o}.${e}`:e,u={...h,label:n,prop:d+"."+r.prop};if(s<t.length-1){const e=this.prepareData(a,t,s+1);u.children=i(e,s+1,d)}return r.columnConfig&&Object.assign(u,r.columnConfig(d,a)),u})},s=this.prepareData(e,t,0,t[0].root);return i(s)},flattenData(e,t){const i=(e,t,i="")=>{const s=e,o=(e,i,r)=>{if(!i)return;const n=e[i.path||"children"];Array.isArray(n)&&n.forEach(e=>{const n="function"==typeof i.prop?i.prop(e):e[i.prop];if(!n)return;const a=r?`${r}-${n}`:n;Object.entries(e).forEach(([e,t])=>{Array.isArray(t)||this.$set(s,`${a}-${e}`,t)});const l=t[t.indexOf(i)+1];l&&o(e,l,a)})};return o(e,t[0],i),s};e.forEach(e=>i(e,t))},transformToTree(e,t){const i=(e,t)=>{const i=(e,s,o=0)=>{if(!s)return;const r=e[s.path];Array.isArray(r)&&r.forEach(r=>{const n="function"==typeof s.prop?s.prop(r):r[s.prop];if(!n)return;this.$set(e,n,r);const a=t[o+1];a&&r[a.path]&&i(r,a,o+1)})};i(e,t[0],0)};e.forEach(e=>i(e,t))}}},Rt={mixins:[Q],data:()=>({isTree:!1,loadingStatus:!1,localFilteredData:void 0,getListResolve:()=>{},pageVisibilityMap:new Map,invalidRows:new Map,internalTotal:void 0}),computed:{list(){return this.filterData()},flatList(){return S()(this.list)},isTreeStructure(){return Array.isArray(this.data)&&this.data.some(e=>Array.isArray(e[this.childrenKey]))},_total(){return this.crudOptions.listApi?this.internalTotal:this.total}},watch:{data:{handler(e,t){const i=e!==t;this.updateTreeStatus(),i&&(this.transformData(),this.getListResolve()),this.$emit("dataChange")},immediate:!0},rowKey_(e,t){e!==t&&(this.transformData(),this.refreshTable())},loading:{handler(e){void 0!==e&&(this.loadingStatus=e)},immediate:!0},loadingStatus(e){this.$emit("update:loading",e)}},methods:{updateTreeStatus(){this.isTree=this.crudOptions.rowKey||this.crudOptions.autoLazy||this.isTreeStructure},filterData(){let e=this.data;return void 0!==this.localFilteredData&&(e=this.localFilteredData),this.crudOptions.localPagination?this.getLocalPaginationData(e):e},transformData(){const e=this.list;this.validateUniqueValues(e),this.processRowData(e),this.restoreEditState(e),this.processTreeData(e),this.processDynamicColumns(e),this.sortedData(),this.updateTableState()},validateUniqueValues(e){this.invalidRows.clear();const t=new Map;if(e.forEach((e,i)=>{const s=e[this.valueKey];s||0===s?t.has(s)?(this.invalidRows.set(i,"DUPLICATE_ID"),this.invalidRows.set(t.get(s),"DUPLICATE_ID")):t.set(s,i):this.invalidRows.set(i,"MISSING_ID")}),this.invalidRows.size>0){const e=Array.from(this.invalidRows.values()).filter(e=>"MISSING_ID"===e).length,t=Array.from(this.invalidRows.values()).filter(e=>"DUPLICATE_ID"===e).length;console.warn(`[CRUD Warning] 发现数据问题：缺失ID ${e}行，重复ID ${t}行`)}},getRowErrorType(e){return this.invalidRows.get(e)||null},isRowSafeForSelection(e,t){return!this.invalidRows.has(t)},processRowData(e){const t=this.crudOptions.uniqueId,i=this.crudOptions.delayRender,s=this.crudOptions.delayRenderIndex||30,o=this.shouldDelayRenderForIndex(s),r=(e,s=null,n=0)=>{Array.isArray(e)&&e.forEach((e,a)=>{i&&o(a)&&this.$set(e,"$delay",[]),t&&!e.$uniqueId&&(e.$uniqueId=Object(ae.a)()),this.isTree&&(null===s||e.$parent||(e.$parentId=s[this.valueKey],Object.defineProperty(e,"$parent",{value:s,writable:!0,enumerable:!1})),e.$level||(e.$level=n)),this.initRow(e),this.isTriggerEdit&&this.$set(e,"$edit",e.$edit||!1),this.isTree&&e[this.childrenKey]&&e[this.childrenKey].length&&r(e[this.childrenKey],e,n+1)})};r(e)},shouldDelayRenderForIndex(e){const t=this.query[this.crudOptions.props.pageNum]||1,i=this.pageVisibilityMap.get(t);if(!i)return t=>t>=e;const{maxVisibleIndex:s}=i;if(s<e)return t=>t>=e;const o=Math.max(e,s-e),r=s;return function(e){return!(e>=o&&e<=r)}},recordCellVisibility(e,t){const i=this.query[this.crudOptions.props.pageNum]||1;if(this.pageVisibilityMap.has(i)){const t=this.pageVisibilityMap.get(i);t.visibleIndexes.add(e),t.maxVisibleIndex=Math.max(t.maxVisibleIndex,e)}else this.pageVisibilityMap.set(i,{maxVisibleIndex:e,visibleIndexes:new Set([e])})},collectVisibleRows(e){const t=new Set;let i=-1;this.list.forEach((e,s)=>{(!e.$delay||e.$delay.length>0)&&(t.add(s),i=Math.max(i,s))}),t.size>0&&this.pageVisibilityMap.set(e,{maxVisibleIndex:i,visibleIndexes:t})},restoreEditState(e){var t;const i=(null===(t=this.editState)||void 0===t?void 0:t.getAddedRows())||[];i.length>0&&i.forEach(t=>{const{addType:i,row:s}=t;"first"===i?e.unshift(s):"last"===i&&e.push(s)});const s=this.editState.editingRows||[];e.forEach(e=>{const t=e[this.valueKey];s.get(t)&&(e.$edit=!0)})},processTreeData(e){this.isTree&&this.crudOptions.autoLazy&&(this.lazyTreeData=Object(f.a)(e),this.handleLocalLazy(e),this.treeNodeMap.forEach((e,t)=>{const{tree:i,treeNode:s,resolve:o}=e;this.lazyLoad(i,s,o)}))},processDynamicColumns(e){(this.crudOptions.flattenConfig||this.crudOptions.dynamicConfig)&&this.transformToTree(e,this.crudOptions.flattenConfig||this.crudOptions.dynamicConfig)},updateTableState(){this.$nextTick(()=>{this.$refs.tableRef.layout.updateElsHeight(),this.selected&&this.selected.length>0&&!this._isInternalUpdateSelection&&this.updateSelection()})},getLocalPaginationData(e){const{pageNum:t,pageSize:i}=this.crudOptions.props,s=(this.query[t]-1)*this.query[i],o=s+this.query[i];return e.slice(s,o)},changeLoading(e=!1){this.crudOptions.remote&&(this.crudOptions.disableLoading||(this.loadingStatus=e))},initQuery(){this.$nextTick(()=>{this.query=Object.assign({},this.query,this.searchParams),this.getList()})},getList(){return this.crudOptions.listApi?this.callGetListApi():(this.$emit("getList"),new Promise((e,t)=>{this.getListResolve=e}))},callGetListApi(){return new Promise(async(e,t)=>{if(Object(m.a)(this.crudOptions.listApi))try{this.loadingStatus=!0;const t=await this.crudOptions.listApi(this.query);this.handleApiResponse(t),e()}catch(e){t(),console.error("API调用失败:",e)}finally{this.loadingStatus=!1}else console.warn("API配置无效，请传入一个函数")})},handleApiResponse(e){let t=[],i=0;Array.isArray(e)?(t=e,i=e.length):e&&"object"==typeof e&&(t=e.data||e.list||e.records||e.rows||e[this.crudOptions.props.data]||[],i=e.total||e.count||e[this.crudOptions.props.total]||t.length),this.updatedData(t),this.internalTotal=i,this.$emit("getList",{data:t,total:i}),this.$emit("update:total",i)},async callDeleteApi(e){if(this.crudOptions.deleteApi)try{this.changeLoading(!0),Array.isArray(e)?await this.crudOptions.deleteApi(e.map(e=>e[this.valueKey]).join(",")):await this.crudOptions.deleteApi(e[this.valueKey]),this.changeLoading(!1)}catch(e){throw this.changeLoading(!1),console.error("删除API调用失败:",e),e}},initRow(e){this.trueRenderColumns.forEach(t=>{var i,s,o;null!==(i=t.form)&&void 0!==i&&i.prop&&void 0===this.getByProp(e,t.form.prop)?this.setByProp(e,t.form.prop,null!==(s=t.form.initValue)&&void 0!==s?s:""):void 0===this.getByProp(e,t.prop)&&this.setByProp(e,t.prop,null!==(o=t.initValue)&&void 0!==o?o:"")})},updatedData(e){this.data.splice(0,this.data.length),this.data.push(...e)}}};const Tt={sum(e,t={}){const{ignoreZero:i,absolute:s}=t;let o=[...e];return i&&(o=o.filter(e=>0!==e)),s&&(o=o.map(e=>Math.abs(e))),o.reduce((e,t)=>e+t,0)},avg(e,t={}){const{ignoreZero:i}=t;let s=[...e];return i&&(s=s.filter(e=>0!==e)),s.length?s.reduce((e,t)=>e+t,0)/s.length:0},count(e,t={}){const{ignoreZero:i,predicate:s}=t;return Object(m.a)(s)?e.filter(s).length:i?e.filter(e=>0!==e).length:e.length},max(e,t={}){const{absolute:i}=t;if(!e.length)return 0;let s=[...e];return i&&(s=s.map(e=>Math.abs(e))),Math.max(...s)},min(e,t={}){const{absolute:i}=t;if(!e.length)return 0;let s=[...e];return i&&(s=s.map(e=>Math.abs(e))),Math.min(...s)}};var Mt={methods:{summaryMethod(e){if(!this.showSummary)return;const{columns:t}=e,i=this.crudOptions.summaryData||this.list;let s={},o=new Array(t.length).fill("");if(Object(m.a)(this.crudOptions.summaryMethod))try{o=this.crudOptions.summaryMethod(e)}catch(e){return console.error("自定义统计方法执行出错:",e),this.sumsList={},o}else t.forEach((e,t)=>{const r=e.col;if(null!=r&&r.summary)try{const n=this.normalizeSummaryConfig(r.summary),a=this.calculateSummary(i,e,n);o[t]=this.formatSummaryResult(a,n),e.property&&(s[e.property]=o[t])}catch(i){console.error(`列 ${e.property} 统计计算出错:`,i),o[t]=""}});return this.sumsList=s,o},normalizeSummaryConfig:e=>"string"==typeof e?{type:e}:"function"==typeof e?{type:"custom",method:e}:e,calculateSummary(e,t,i){const{type:s,method:o,path:r,ignoreZero:n,absolute:a,predicate:l}=i;let c;if(c="count"===s?e.map(e=>r?Object(g.a)(e,r):e[t.property]):e.map(e=>{const i=r?Object(g.a)(e,r):e[t.property];return Number(i)}).filter(e=>!isNaN(e)),"custom"===s&&Object(m.a)(o))return o(c,e);const h=Tt[s.toLowerCase()];return h?h(c,{ignoreZero:n,absolute:a,predicate:l}):(console.warn("未知的统计类型: "+s),s)},formatSummaryResult(e,t){const{prefix:i="",suffix:s="",decimals:o=0}=t;if(null==e)return"";return`${i}${Number.isFinite(e)?Number(Number(e).toFixed(o)).toString():e}${s}`}}},jt={methods:{initColumn(e,t){var i;(e.form||this.isEdit||e.isEdit)&&!1!==e.form&&!1!==e.isEdit&&(e.form=this.extendsOption(e,e.form,Object(re.a)(e,["label","prop","required","regular","rules"]))),(e.form||e.add)&&!1!==e.add&&(e.add=this.extendsOption(e,e.add,e.form)),(e.form||e.edit)&&!1!==e.edit&&(e.edit=this.extendsOption(e,e.edit,e.form)),(e.form||e.view)&&!1!==e.view&&(e.view=this.extendsOption(e,e.view,e.form)),e.search&&(e.search=this.extendsOption(e,e.search,{})),(e.search||e.searchHeader)&&!1!==e.searchHeader&&(e.searchHeader=this.extendsOption(e,e.searchHeader,e.search));const s=null===(i=this.setOptions)||void 0===i?void 0:i.sort[e.prop];e.order=0===s||s?s:t;const o=e.spanProp||e.sameRowSpan;o&&!this.sameRowSpans.includes(o)&&("string"==typeof o?this.sameRowSpans.push(o):this.sameRowSpans.push(e.prop)),e.summary&&(this._showSummary=!0),e.minWidth||e.width||(e.minWidth=this.getDefaultColumnMinWidth(e))},extendsOption(e,t,i){if(!1===t)return!1;t=P("render",(t=Object(T.a)(t)?t:{}).presetType,t);const s=Object(g.a)(t,"formatData.type")||t.formatData;return"string"==typeof s&&(t.formatData=Object.assign({},t.formatData,B("formatData",s,t))),i=Object(f.a)(i),Object(y.a)({label:e.label,prop:e.prop,dict:e.dict,...i},t)},isDefaultColumn(e){return this._runWithoutDeps(()=>!(e.comp||e.render||e.html||e.isEdit||this.extendsScopedSlots[e.prop]||e.position||e.formatData)&&(!this.validateEditMode()||!1===e.isEdit))},showEditIcon(e){return!(!this.ctx.validateEditMode("cell")||!1===e.isEdit||"function"==typeof e.isEdit)},getDefaultColumnMinWidth(e){if(this.labelMinWidthMap.has(e.label))return this.labelMinWidthMap.get(e.label);const t=document.createElement("span");t.innerText=e.label,document.body.appendChild(t);let i=t.getBoundingClientRect().width+20;return e.search&&(i+=20),e.sortable&&(i+=25),this.showRequired(e)&&(i+=10),this.showEditIcon(e)&&(i+=20),document.body.removeChild(t),i=Math.max(Math.round(i),80),this.labelMinWidthMap.set(e.label,i),i},extendsSlots(e,t,i){Object.keys(e).forEach(s=>{if(s.endsWith("-"+i)){const o=`${s.slice(0,-(i.length+1))}-${t}`;e[o]||(e[o]=e[s])}})},showEditIcon(e){return!(!this.validateEditMode("cell")||!e.isEdit)},showRequired(e){return this.validateEditMode("cell")&&!0===e.required}}};class Pt{constructor(e={}){this.storageKey=e.storageKey||"appStateOptions",this.storageType=e.storageType||"local",this.useRouteKey=!1!==e.useRouteKey,this.defaultCacheKey=e.defaultCacheKey||"default"}getStorage(){return"local"===this.storageType?localStorage:sessionStorage}getCacheKey(e){return this.useRouteKey&&e&&e.path?e.path.replace(/\/?\d+$/,""):this.defaultCacheKey}getStorageData(){const e=this.getStorage().getItem(this.storageKey);return e?JSON.parse(e):{}}setStorageData(e){this.getStorage().setItem(this.storageKey,JSON.stringify(e))}save(e,t=null,i=null){let s,o,r;1===arguments.length||2===arguments.length&&t&&t.path?(s=null,o=e,r=t):(s=e,o=t,r=i);const n=this.getCacheKey(r);let a=this.getStorageData();a[n]||(a[n]={}),s?a[n][s]=o:a[n].__default__=o,this.setStorageData(a)}restore(e=null,t=null){(0===arguments.length||1===arguments.length&&e&&e.path)&&(t=e,e=null);const i=this.getCacheKey(t),s=this.getStorageData();return s[i]?e?s[i][e]||null:s[i].__default__||null:null}clear(e=null,t=null){(0===arguments.length||1===arguments.length&&e&&e.path)&&(t=e,e=null);const i=this.getCacheKey(t);let s=this.getStorageData();if(!s[i])return;const o=e||"__default__";s[i][o]&&(delete s[i][o],0===Object.keys(s[i]).length&&delete s[i],this.setStorageData(s))}clearAll(){this.getStorage().removeItem(this.storageKey)}resetCacheKey(e=null){const t=this.getCacheKey(e);let i=this.getStorageData();i[t]&&(delete i[t],this.setStorageData(i))}getAllStates(e=null){const t=this.getCacheKey(e);return this.getStorageData()[t]||{}}hasState(e=null,t=null){(0===arguments.length||1===arguments.length&&e&&e.path)&&(t=e,e=null);const i=this.getCacheKey(t),s=this.getStorageData();if(!s[i])return!1;const o=e||"__default__";return!!s[i][o]}}var At={data:()=>({setOptions:{fixed:{},fixedWidth:{},sort:{},hidden:[],pageSize:null},stateStorageManager:null}),created(){this.stateStorageManager=new Pt({storageKey:"tableOptions",useRouteKey:!0}),this.getLocalCache()},methods:{getLocalCache(){if(!this.stateStorageManager||!this.$route)return;const e=this.stateStorageManager.restore(this.crudOptions.stateKey,this.$route);e&&(this.setOptions=Object.assign(this.setOptions,e))},resetLocalCache(){this.setOptions.fixed={},this.setOptions.sort={},this.setOptions.hidden=[],this.saveLocalCache()},saveLocalCache(e=!0){this.stateStorageManager&&this.$route&&(this.stateStorageManager.save(this.crudOptions.stateKey,this.setOptions,this.$route),e&&this.refreshTable())},clearCurrentCache(){this.stateStorageManager&&this.$route&&this.stateStorageManager.clear(this.crudOptions.stateKey,this.$route)},clearAllCache(){this.stateStorageManager&&this.stateStorageManager.clearAll()}}},Bt={methods:{handleLocalSearch(){if(!this.crudOptions.localSearch)return;const e=t=>{const i=Object.entries(this.query).every(([e,i])=>{if(I(i))return!0;if(Array.isArray(i)&&i.every(I))return!0;const s=this.columnsMap[e];if(!s)return!0;const o=t[e];return null!=o&&this.filterBySearchType(s,o,i,t)});if(this.isTree&&t[this.childrenKey]&&t[this.childrenKey].length>0){const s=t[this.childrenKey].map(t=>e(t)).filter(Boolean);if(i||s.length>0){const e={...t};return e[this.childrenKey]=s,t.$parent&&Object.defineProperty(e,"$parent",{value:t.$parent,writable:!0,enumerable:!1}),void 0!==t.$level&&(e.$level=t.$level),t.$parentId&&(e.$parentId=t.$parentId),e}return null}return i?t:null};if(this.localFilteredData=this.data.map(t=>e(t)).filter(Boolean),this.crudOptions.localPagination){const{pageNum:e}=this.crudOptions.props;this.query[e]=1}},filterDateValue(e,t){if(!e||!t)return!0;const i=k()(e);if(Array.isArray(t)){const[e,s]=t.map(e=>k()(e));return e.isSame(s,"day")?i.isSame(e,"day"):e.isValid()&&s.isValid()?(i.isAfter(e.startOf("day"))||i.isSame(e,"day"))&&(i.isBefore(s.endOf("day"))||i.isSame(s,"day")):e.isValid()?i.isAfter(e.startOf("day"))||i.isSame(e,"day"):!s.isValid()||(i.isBefore(s.endOf("day"))||i.isSame(s,"day"))}return i.isSame(k()(t),"day")},isSameDay:(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),filterBySearchType(e,t,i,s){var o,r,n;const a=(null===(o=e.search)||void 0===o?void 0:o.type)||{"el-input":"input","el-select":"select","el-date-picker":"date","el-cascader":"cascader"}[null===(r=e.search)||void 0===r||null===(r=r.comp)||void 0===r?void 0:r.name]||"input";if(Object(m.a)(null===(n=e.search)||void 0===n?void 0:n.filter))return e.search.filter(t,i,s,this.data);switch(a){case"input":return String(t).toLowerCase().includes(String(i).toLowerCase());case"select":return String(t)===String(i);case"date":return this.filterDateValue(t,i);default:return!0}},handleSearch(){this.changeLoading(!0),this.runBefore("search",e=>{this.changeLoading(),this.handleLocalSearch(),!this.crudOptions.localSearch&&this.$nextTick(this.getList),this.$emit("closeSearchPopover")})},handleReset(e){this.changeLoading(!0),this.runBefore("reset",t=>{this.changeLoading();const i=this.$refs.searchRef;i&&(e?i.resetField(e):(i.resetFields(),i.searchForm.renderColumns.forEach(e=>{Object(m.a)(e.reset)&&e.reset()})),!this.crudOptions.localSearch&&this.$nextTick(this.getList),this.crudOptions.localSearch&&(this.localFilteredData=void 0))},e)}}},It={data:()=>({_tempMock:!1}),methods:{handleGenerateMockData(e,t){if(!e||!e.length)return;let i=[],s="";switch(t){case"append":i=[...this.list,...e],s=`成功追加 ${e.length} 条测试数据`;break;case"replace":i=[...e],s=`成功替换为 ${e.length} 条测试数据`;break;case"fill":i=[...e],s="成功补充空值字段";break;default:return}this.updatedData(i),this.$message({type:"success",message:s}),"replace"===t&&this.clearSelection(),this.$nextTick(()=>{this.refreshTable()})},handleCloseMockDialog(){this._tempMock&&this.$nextTick(()=>{this._tempMock=!1,this.data.shift()})},clearMock(){const e=this.list.filter(e=>!e.$mock);this.updatedData(e)}}},Ft=a({name:"crud-search",inject:["ctx"],components:{scForm:vt},data:()=>({searchHeight:"0px",delayShowSearch:!1}),computed:{hasAlwaysSearch(){return this.options.renderColumns.some(e=>e.alwaysShow)},searchForm(){const e=this.ctx.crudOptions.searchForm,t=N(this.ctx.getRenderColumns("search"));return t.some(e=>e.alwaysShow)?{...e,renderColumns:t.slice().sort((e,t)=>(!0===t.alwaysShow)-(!0===e.alwaysShow)).map(e=>({...e,hidden:e.hidden||!this.delayShowSearch&&!e.alwaysShow}))}:{...e,renderColumns:t}},options(){return Object(y.a)({size:this.ctx.crudOptions.size,shrinkLabel:!1,columnWidth:"300px",action:{fill:!1,search:{label:"查询",icon:"el-icon-search",type:"primary",onClick:this.ctx.handleSearch},reset:{icon:"el-icon-refresh",label:"重置",onClick:()=>this.ctx.handleReset()}},slots:this.ctx.extendsScopedSlots,mode:"search",defaultRender:(e,t)=>Object(m.a)(this.searchForm.defaultRender)?this.searchForm.defaultRender(e,t):u.input(e,t)},this.searchForm)}},watch:{"ctx.query":{handler(e){this.queryChange=!0,Object.keys(e).forEach(t=>{this.ctx.search[t]!==e[t]&&(this.ctx.search[t]=e[t])}),this.$nextTick(()=>{this.queryChange=!1})},deep:!0},"ctx.search":{handler(e){this.queryChange||this.$nextTick(()=>{this.ctx.query={...this.ctx.query,...e}})},deep:!0,immediate:!0}},created(){var e;(this.searchForm&&this.searchForm.initShow||null!==(e=this.ctx.crudOptions)&&void 0!==e&&e.expandSearch)&&(this.ctx.showSearch=!0),this.hasAlwaysSearch&&this.initShowSearch()},methods:{saveInitSearch(){this.ctx.search&&(this._search={...this.ctx.search})},setInitSearch(){this._search&&setTimeout(()=>{Object.keys(this._search).forEach(e=>{this.$set(this.ctx.query,e,this._search[e])})},0)},resetField(e){this.$refs.searchForm.resetField(e)},resetFields(){this.$refs.searchForm.reset()},initShowSearch(){this.$watch("ctx.showSearch",e=>{this.$nextTick(()=>{const t=this.$refs.searchWrapper;e?(this.delayShowSearch=e,setTimeout(()=>{this.searchHeight=t.scrollHeight+"px"},300)):(this.calculateCollapsedHeight(),setTimeout(()=>{this.delayShowSearch=e},300))})},{immediate:!0})},getItemsPerRow(){const e=this.$refs.searchWrapper.querySelector(".sc-grid");if(!e)return 1;const t=e.offsetWidth,i=Number.parseInt(this.options.columnWidth)||300,s=Math.floor(t/i);return Math.max(1,s)},calculateCollapsedHeight(){const e=this.$refs.searchWrapper;if(!e)return;const t=e.querySelectorAll(".sc-cell");if(0===t.length)return;const i=this.ctx.getRenderColumns("search").filter(e=>e.alwaysShow).length,s=this.getItemsPerRow(),o=Math.ceil((i+1)/s),r=t[0];if(!r)return void(this.searchHeight="50px");const n=o*r.offsetHeight;this.searchHeight=n+"px"}}}),Nt=Object(se.a)(Ft,(function(){var e=this,t=e._self._c;e._self._setupProxy;return e.hasAlwaysSearch?t("div",{ref:"searchWrapper",style:{height:e.searchHeight,overflow:"hidden",transition:"height 0.3s"}},[t("scForm",{ref:"searchForm",attrs:{actionInLastCell:"",autoFill:!0,options:e.options,loading:e.ctx.loadingStatus},model:{value:e.ctx.query,callback:function(t){e.$set(e.ctx,"query",t)},expression:"ctx.query"}})],1):t("scForm",{ref:"searchForm",class:[e.b({"show-search":e.ctx.showSearch})],attrs:{actionInLastCell:"",autoFill:!0,options:e.options,loading:e.ctx.loadingStatus},model:{value:e.ctx.query,callback:function(t){e.$set(e.ctx,"query",t)},expression:"ctx.query"}})}),[],!1,null,null,null).exports,Vt=i(759),zt=i.n(Vt),Lt=a({name:"crud-drawer",components:{draggable:zt.a},inject:["ctx"],data:()=>({active:!1,title:"",currentValue:[]}),computed:{action(){return this.ctx.crudOptions.action||this.ctx.rowEdit?[{prop:"action",label:"操作"}]:[]},defaultColumns(){return this.ctx.defaultColumns||[]},columns(){const e=[...this.defaultColumns,...this.listColumns];return this.action.length&&e.push(...this.action),e},listColumns(){return this.ctx.columns.filter(e=>!e.hiddenList)||[]},fixed(){return this.ctx.setOptions.fixed},hidden:{get(){return this.ctx.setOptions.hidden},set(e){this.ctx.setOptions.hidden=e}},show:{get(){return this.columns.filter(e=>!this.hidden.includes(e.prop)).map(e=>e.prop)},set(e){this.hidden=this.columns.filter(t=>!e.includes(t.prop)).map(e=>e.prop)}},isIndeterminate(){return this.hidden.length>0&&this.hidden.length<this.columns.length},checkAll:{get(){return this.show.length===this.columns.length},set(e){this.hidden=e?[]:this.columns.map(e=>e.prop)}}},methods:{flatColumn(e){const t=[];return e.forEach(e=>{if(t.push(e),e.children){const i=this.flatColumn(e.children);t.push(...i)}}),t},showDrawer(){this.active=!0},reset(){this.ctx.resetLocalCache()},changeFixed(e,t){this.$set(this.ctx.setOptions.fixed,e,t),this.ctx.saveLocalCache()},handleCheckedChange(e){this.ctx.saveLocalCache()},onEnd({newIndex:e,oldIndex:t}){const i=this.ctx.setOptions.sort,s=(this.listColumns[e].prop,this.listColumns[t].prop);let o,r,n;if(t<e)o=t+1,r=e+1,n=-1;else{if(!(t>e))return;o=e,r=t,n=1}this.listColumns.slice(o,r).forEach(e=>{e.prop!==s&&this.$set(i,e.prop,e.order+n)}),this.$set(i,s,e),this.ctx.saveLocalCache()},renderColumnItems(e,t=!1){const i=this.$createElement;return e.map((e,s)=>i("div",{class:"col-item",key:s},[i("el-checkbox",{class:"col-item--left",attrs:{label:e.prop,title:e.label}},[e.label]),i("div",{class:"col-item--right"},[this.renderFixedButtons(e.prop),t&&!e.type?i("div",{class:["el-icon-sort","sort-drag","mover"]}):i("div",{style:"width: 22px; background: #fff;"})])]))},renderFixedButtons(e){const t=this.$createElement;return t("el-button-group",[["left",!1,"right"].map(i=>t("el-button",{class:"fixed-btn",attrs:{icon:i?"el-icon-arrow-"+i:"el-icon-close",type:i?this.fixed[e]===i?"primary":"default":this.fixed[e]?"default":"primary"},on:{click:()=>this.changeFixed(e,i)}}))])}},render(e){return e("el-drawer",c()([{class:this.b(),attrs:{title:"列设置",size:"300px",appendToBody:!0}},{attrs:{visible:this.active}},{},{on:{"update:visible":e=>{this.active=e}}}]),[e("div",{class:"wrapper"},[e("el-card",{attrs:{shadow:"never"}},[e("div",{class:"header"},[e("el-checkbox",{attrs:{indeterminate:this.isIndeterminate},on:{change:this.handleCheckedChange},model:{value:this.checkAll,callback:e=>{this.checkAll=e}}},[this.show.length," / ",this.columns.length]),e("span",{class:"title"},["固定 / 排序"])]),e("el-checkbox-group",{class:"col-list",on:{change:this.handleCheckedChange},model:{value:this.show,callback:e=>{this.show=e}}},[this.renderColumnItems(this.defaultColumns),e(zt.a,{attrs:{ghostClass:"ghost",handle:".sort-drag",filter:".unMover",animation:150},on:{end:this.onEnd},model:{value:this.currentValue,callback:e=>{this.currentValue=e}}},[this.renderColumnItems(this.listColumns,!0)]),this.renderColumnItems(this.action)])]),e("el-button",{class:"reset-btn",attrs:{size:"default",icon:"el-icon-refresh"},on:{click:this.reset}},["重置"])])])}}),Kt=Object(se.a)(Lt,void 0,void 0,!1,null,"39461dbc",null).exports,Ht=a({name:"crud-menuBar",inject:["ctx"],components:{drawerColumn:Kt,button_:Fe,position:oe},data:()=>({isBatchEdit:!1,showDrawer:!1}),mounted(){this.ctx.editState&&this.ctx.editState.on("edit-status-change",()=>{if(!this.ctx.editConfig.batch)return;const e=this.ctx.editState.getEditingRowKeys();0===e.length&&(this.isBatchEdit=!1),e.length===this.ctx.list.length&&(this.isBatchEdit=!0)})},computed:{showHandleRow(){return z(this.handleRow,null,!0)},showToolbar(){return z(this.toolbar,null,!0)},hasRightPositionSlot(){return this.ctx.$scopedSlots["handleRow-right"]},handleRow(){const e={...this.ctx.crudOptions.handleRow||{}},t=this.ctx.editConfig;return{add:t.add,rowAdd:t.rowAdd,batchDelete:t.batchDelete,...e}},toolbar(){let e={...this.ctx.crudOptions.toolbar||{}};const t=this.ctx.editConfig,i={batchEdit:t.batch||e.batchEdit,batchSave:t.batch||e.batchEdit,batchCancel:t.batch||e.batchEdit};return!1===e.show&&this.ctx.editConfig.batch?i:(e.cover&&(e={handles:e.handles}),{...i,search:this.hasSearch,...e})},hasSearch(){return this.ctx.trueRenderColumns.some(e=>e.search)},handleRowButtons(){const e=this.handleRow;if(!e)return;let t=[];const i=A("btn.crud.handleRow",e,{ctx:this.ctx},this.handleRowTemps);return t.push(...i),t=this.ctx.checkHiddenButtons("handleRow",t),t},toolbarButtons(){const e=this.toolbar;if(!e)return[];let t=[];const i=A("btn.crud.toolbar",e,{ctx:this.ctx,self:this},this.toolbarTemps);return t.push(...i),t=this.ctx.checkHiddenButtons("toolbar",t),t},handleRowTemps(){return{add:{icon:"el-icon-plus",label:"新增",type:"primary",onClick:()=>{var e;this.ctx.handleAdd((null===(e=this.ctx.editConfig.add)||void 0===e?void 0:e.addType)||"last")}},batchDelete:{icon:"el-icon-delete",label:"删除",type:"danger",disabled:0===this.ctx.selectionRow.length,onClick:()=>{this.ctx.handleBatchDelete()}},rowAdd:(e,{ctx:t})=>({icon:"el-icon-plus",label:"新增",type:"primary",onClick:()=>{this.ctx.handleRowAdd(e.addParams&&e.addParams(),null==e?void 0:e.addType)}})}},toolbarTemps(){var e;return{batchEdit:{label:"批量编辑",type:"primary",order:1,innerHide:this.isBatchEdit,disabled:0===this.ctx.list.length||(null===(e=this.ctx.editConfig.batch)||void 0===e?void 0:e.isSelect)&&0===this.ctx.selectionRow.length,onClick:()=>{this.isBatchEdit=!0,this.ctx.handleBatchRowEdit()}},batchSave:{order:1,type:"primary",label:"保存",style:{marginLeft:"auto"},innerHide:!this.isBatchEdit,onClick:()=>{this.ctx.handleBatchRowSave(()=>{this.isBatchEdit=!1})}},batchCancel:{order:2,label:"取消",style:{marginRight:"10px"},innerHide:!this.isBatchEdit,onClick:()=>{this.resetBatchEdit()}},excelImport:{order:3,icon:"el-icon-upload",title:"导入",circle:!0,onClick:()=>{this.ctx.showExcelImportDialog()}},excelExport:{order:4,icon:"el-icon-download",title:"导出",circle:!0,onClick:()=>{this.ctx.exportToExcel()}},zoom:{order:5,icon:"el-icon-full-screen",title:"最大化",circle:!0,onClick:()=>{this.ctx.isMaximize=!this.ctx.isMaximize,this.ctx.$emit("zoom")}},refresh:{order:6,icon:"el-icon-refresh",title:"刷新",circle:!0,onClick:()=>{this.ctx.getList(),this.ctx.$emit("refresh")}},reset:{order:7,icon:"el-icon-refresh-right",title:"重置",circle:!0,onClick:()=>{this.ctx.handleReset()}},search:{order:8,icon:"el-icon-search",title:"查询",circle:!0,onClick:()=>{this.ctx.showSearch=!this.ctx.showSearch,this.ctx.loadingStatus=!0,this.ctx.isChangeShowSearch=!0,setTimeout(()=>{this.ctx.loadingStatus=!1},300),setTimeout(()=>{this.ctx.isChangeShowSearch=!1},500)}},column:{order:9,icon:"el-icon-set-up",title:"列设置",circle:!0,onClick:()=>{this.showDrawerColumn()}}}}},methods:{showDrawerColumn(){this.showDrawer=!0,this.$nextTick(()=>{this.$refs.drawerColumn.showDrawer()})},resetBatchEdit(){this.isBatchEdit=!1,this.ctx.handleBatchRowCancel()}}}),Yt=Object(se.a)(Ht,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:e.b()},[e.showHandleRow?t("div",{class:e.b("handleRow"),style:{flex:e.hasRightPositionSlot?null:1}},[t("position",{staticStyle:{width:"100%"},attrs:{slotName:"handleRow",slots:e.ctx.$scopedSlots,scope:e.ctx.crudOptions}},[e.handleRowButtons.length>0?t("div",{staticStyle:{display:"flex",width:"100%"}},e._l(e.handleRowButtons,(function(i,s){return t("button_",e._b({key:i.key||i.title||s,attrs:{type:i.type,scope:"batchDelete"===i.key?e.ctx.selectionRow:null,loading:e.ctx.loadingStatus,disabled:void 0===i.disabled?e.ctx.crudOptions.disabled:i.disabled}},"button_",i,!1))})),1):e._e()])],1):e._e(),e._v(" "),e.showToolbar||e.ctx.editConfig.batch?t("div",{class:e.b("toolbar")},[t("position",{attrs:{slotName:"toolbar",slots:e.ctx.$scopedSlots,scope:e.ctx.crudOptions}},e._l(e.toolbarButtons,(function(i,s){return t("button_",e._b({key:i.key||i.title||s,attrs:{type:i.type,loading:e.ctx.loadingStatus}},"button_",i,!1))})),1)],1):e._e(),e._v(" "),e.showDrawer?t("drawerColumn",{ref:"drawerColumn"}):e._e()],1)}),[],!1,null,null,null).exports,qt=a({name:"crud-action-column",components:{button_:Fe},inject:["ctx"],data:()=>({buttonList:[],actionWidth:""}),created(){const e=this.calcAutoWidth;this.calcAutoWidth=Object(ue.a)(e,0)},watch:{action(){this.bindColumnConfig()}},computed:{width(){return"auto"===this.action.width?Math.max(this.actionWidth,this.action.defaultWidth):this.action.width?this.action.width:this.action.defaultWidth},fixed(){return this.action.fixed?this.action.fixed:this.ctx.setOptions.fixed[this.action.prop]},action(){const e=this.ctx.editConfig;return{type:"action",delete:e.delete,view:e.view,edit:e.edit,rowEdit:e.rowEdit,rowSave:e.rowEdit,rowCancel:e.rowEdit,addChild:e.addChild,...Object(f.a)(this.ctx.crudOptions.action)}},showAction(){return!this.ctx.setOptions.hidden.includes(this.action.prop)&&z(this.action,null,this.actionButtons.length>0)},actionButtons(){let e=[];const t=A("btn.crud.action",this.action,{ctx:this.ctx},this.actionTemps);return e.push(...t),e},actionTemps(){return{rowEdit:(e,{ctx:t})=>({icon:"el-icon-edit",label:"编辑",order:9,width:120,disabled:e=>this.ctx.disabledRowEdit({row:e.row,$index:e.$index}),innerHide:e=>!this.ctx.validateEditMode("row")||this.isRowEditing(e),onClick:e=>{this.ctx.handleRowEdit(e)}}),rowSave:(e,{ctx:t})=>({icon:"el-icon-circle-check",label:"保存",order:10,innerHide:e=>!this.ctx.validateEditMode("row")||!this.isRowEditing(e),onClick:e=>{this.ctx.handleRowSave(e)}}),rowCancel:(e,{ctx:t})=>({icon:"el-icon-circle-close",label:"取消",order:11,innerHide:e=>!this.ctx.validateEditMode("row")||!this.isRowEditing(e),onClick:e=>{this.ctx.handleRowCancel(e)}}),view:(e,{ctx:t})=>({icon:"el-icon-view",label:"查看",order:8,onClick:e=>{this.ctx.handleView(e)}}),edit:(e,{ctx:t})=>({icon:"el-icon-edit",label:"编辑",order:9,onClick:e=>{this.ctx.handleEdit(e)}}),delete:(e,{ctx:t})=>({icon:"el-icon-delete",label:"删除",order:12,innerHide:e=>this.ctx.validateEditMode("row")&&this.isRowEditing(e),onClick:e=>{this.ctx.handleDelete(e)}}),addChild:(e,{ctx:t})=>({icon:"el-icon-plus",label:"添加子级",order:13,onClick:t=>{this.ctx.handleRowAdd(e.addParams&&e.addParams(t),null==e?void 0:e.addType,t.row)}})}}},methods:{bindColumnConfig(){var e;const t=null===(e=this.$refs.column)||void 0===e?void 0:e.columnConfig;t&&(t.col={...this.action},t.options={...this.ctx.crudOptions})},isRowEditing:e=>e.row.$edit,handleActionButtons(e,t){let i=t;return this.ctx.buttonList[e.$index]=this.buttonList[e.$index]=i,this.$nextTick(()=>{this.calcAutoWidth()}),i},calcAutoWidth(){if("auto"===this.action.width){let e=this.actionWidth;document.querySelectorAll(".sc-crud-action-column").forEach(t=>{let i=t.children,s=0;for(let e=0;e<i.length;e++){const t=i[e];"none"!==t.style.display&&(s+=(Number(t.getAttribute("width"))||t.offsetWidth)+this.action.calcWidth)}s>=e&&(e=s)}),this.actionWidth=e}}}}),Wt=Object(se.a)(qt,(function(){var e=this,t=e._self._c;e._self._setupProxy;return e.showAction?t("el-table-column",e._b({ref:"column",attrs:{width:e.width,fixed:e.fixed},on:{"hook:mounted":e.bindColumnConfig},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{ref:"actionRef",class:e.b()},e._l(e.handleActionButtons(i,e.actionButtons),(function(s,o){return t("button_",e._b({key:o,attrs:{type:s.type||"text",size:e.ctx.crudOptions.size,scope:i}},"button_",s,!1))})),1)]}}],null,!1,4228605698)},"el-table-column",e.action,!1)):e._e()}),[],!1,null,null,null).exports,Gt={data:()=>({curIndex:0}),created(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")},methods:{getCharacterWidth(e,t="12px Arial"){return this.context.font=t,Math.ceil(this.context.measureText(e).width)},getMaxContentWidth(e,t,i,s){let o=0;for(let s=0;s<e.length;s++){const r=e[s];if(null!=r[t]){const e=this.getCharacterWidth(String(r[t]),i);e>o&&(o=e,this.curIndex=s)}}return o+s},getFirstContentWidth(e,t,i,s){for(let o=0;o<e.length;o++){const r=e[o];if(null!=r[t]&&r[t].toString().length>0)return this.curIndex=o,this.getCharacterWidth(String(r[t]),i)+s}return 0},calcColumnWidth(e,t,i="first",s,o=20){if(!e||!Array.isArray(t)||0===t.length)return"80px";let r;return r="first"===i?this.getFirstContentWidth(t,e,s,o):this.getMaxContentWidth(t,e,s,o),(r<80?80:r)+"px"},getColumnWidth(e,t,i,s,o,r){return"auto"===e?this.calcColumnWidth(t,i,s,o,r):e}}};function Ut(e,t,i,s){if(e.prop)return t.isTree?"list."+function e(t,i,{key:s="id",childrenKey:o="children",path:r=""}){for(let n=0;n<t.length;n++){const a=t[n];if(a[s]===i)return r+n;if(a[o]&&a[o].length>0){const t=`${r}${n}.${o}.`,l=e(a[o],i,{key:s,path:t});if(null!==l)return l}}return null}(i.list,s.row[t.valueKey],{key:t.valueKey,childrenKey:t.childrenKey})+"."+e.prop:"list."+s.$index+"."+(e.validateProp||e.prop)}function Jt(e,{col:t,scope:i,ctx:s,topProps:o}){const n=i.row.$edit,a=s.isTriggerEdit?n&&s.validateEdit(t,i):s.validateEdit(t,i),l=function(e,t){const i={...e};return t&&i[t]||i}(t,a),h=Ut(l,o,s,i),{rules:d,rawRules:p}=ee(l,i),m=a&&d.length,f=a&&m?"el-form-item":"div",y=s.validateEditMode("cell")?d.required:d.required&&a;let b;return b=!function(e,t){return!(e.comp||e.render||t.extendsScopedSlots[e.prop]||e.position||e.formatData)}(l,s)||a?function(e,t,i,s,o,r,n){return e(Re,c()([{},{props:t},{attrs:{item:t,slots:r.extendsScopedSlots,mode:i,scope:n,size:r.size,rawRules:s,defaultRender:r.defaultRender,controlDefault:(e,t)=>{if("add"===i||"edit"===i)return e.input},"data-row-key":n.row[r.valueKey],"data-full-prop":o,"data-prop":t.prop}}]))}(e,l,a,p,h,o,i):function(e,t,i){const s={...i,item:t,$value:{get:Object(g.a)(i.row,t.prop)}};return u.formatter(e,s)}(e,l,i),e(f,c()([{class:[y?"is-required":"",((...e)=>r("sc-crud-cell",...e))([t.align||"center"]),t.showOverflowTooltip&&"sc-over-ellipsis"],attrs:{"label-width":l.labelWidth,size:o.size,prop:h,rules:d},style:"width:100%"},{on:{"hook:destroyed":()=>{s.clearErrorMsg(i.row,l.prop)}}}]),[b])}var Xt=a({name:"crud-search-header",props:{item:{}},mixins:[],inject:["ctx"],provide(){return{searchHeader:this,controlCtx:null}},data:()=>({active:!1}),created(){this.$emit("update:isSearch",this.isSearch()),this.ctx.$on("closeSearchPopover",e=>{e!==this.item.prop&&this.closePopover()}),this.$watch(()=>this.item.validateProp?Object(g.a)(this.ctx.query,this.item.validateProp):this.ctx.query[this.item.prop],e=>{this.$emit("update:isSearch",this.isSearch())},{deep:!0})},computed:{searchHeader(){return this.ctx.crudOptions.searchHeader},mergeConfig(){return Object(y.a)({},this.searchHeader,this.item)},componentStrategy(){return[{rule:"*input",comp:{nativeOn:{keyup:e=>{13===e.keyCode&&this.search()}},on:{clear:()=>{this.search()}}}},{rule:"*select",comp:{on:{change:e=>{this.isChange=!0},"visible-change":e=>{!e&&this.isChange&&(this.isChange=!1,this.search())}}}},{rule:"*cascader",comp:{on:{change:e=>{this.isChange=!0},"visible-change":e=>{!e&&this.isChange&&(this.isChange=!1,this.search())}}}},{rule:"*date-picker",comp:{on:{change:e=>{this.search()}}}}]}},methods:{closePopover(){this.$refs.popover&&this.$refs.popover.doClose()},search(e){this.justSearched||(this.justSearched=!0,this.ctx.handleSearch(),this.closePopover(),setTimeout(()=>{this.justSearched=!1},200))},reset(){Object(m.a)(this.item.reset)&&this.item.reset(),this.ctx.handleReset(this.item.prop),this.closePopover()},popClick(e){e.stopPropagation()},isSearch(){const e=this.item.validateProp?Object(g.a)(this.ctx.query,this.item.validateProp):this.ctx.query[this.item.prop];return Array.isArray(e)&&e.length?e.every(e=>!I(e)):Object(T.a)(e)&&Object.keys(e).length?Object.values(e).every(e=>!I(e)):!I(e)}},render(e){return e("el-popover",c()([{attrs:{"popper-class":this.b(),placement:"bottom",trigger:"click"},ref:"popover"},{props:this.mergeConfig},{on:{show:()=>{this.ctx.$emit("closeSearchPopover",this.item.prop),this.ctx.showPopperNum++,this.$nextTick(()=>{var e;null===(e=this.instance)||void 0===e||null===(e=e.$el.querySelector("input"))||void 0===e||e.focus()})},hide:()=>{this.isSearch&&this.search(),this.ctx.showPopperNum>0&&this.ctx.showPopperNum--}},scopedSlots:{reference:()=>e("i",{class:"el-icon-search search-btn",on:{click:this.popClick}})}}]),[(()=>e(Re,c()([{},{props:this.item},{attrs:{item:this.item,slots:this.ctx.extendsScopedSlots,scope:{row:this.ctx.query},mode:"searchHeader",size:this.ctx.crudOptions.size,compStrategy:this.componentStrategy,commonCompStrategy:{mounted:(e,t)=>{this.instance=t}},defaultComp:{name:"el-input",props:{clearable:!0}}}}])))(),(()=>e("div",{style:"display: flex; align-items: center;"},[this.mergeConfig.searchBtn&&e("el-button",{attrs:{icon:"el-icon-search",type:"primary"},on:{click:this.search},style:"margin-left: 10px;"}),this.mergeConfig.resetBtn&&e("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:this.reset},style:"margin-left: 10px;"})]))()])}}),Zt=Object(se.a)(Xt,void 0,void 0,!1,null,null,null).exports,Qt=i(504);Qt.TableColumn.destroyed=function(){if(!this.$parent)return;let e=this.$parent;"sc-crud-column"===e.$options.name&&(e=e.$parent),this.owner.store.commit("removeColumn",this.columnConfig,this.isSubColumn?e.columnConfig:null)};var ei=a({name:"crud-column",props:{col:Object},inject:["ctx"],mixins:[Gt],data:()=>({isSearch:!1}),components:{TableColumn:Qt.TableColumn,column:ti,searchHeader:Zt,position:oe},watch:{col(){this.bindColumnConfig()}},computed:{showOverflowTooltip(){const e=this.col;return void 0!==e.showOverflowTooltip?e.showOverflowTooltip:this.ctx.isDefaultColumn(e)},calcOpts(){return{...this.ctx.crudOptions.calcColumnWidth,...this.col}},isShow(){return!this.col.hiddenList&&!this.hidden},hidden(){if(this.ctx.setOptions.hidden.includes(this.col.prop))return!0},fixed(){if(this.col.fixed)return this.col.fixed;const e=this.ctx.setOptions.fixed[this.col.prop];return e||void 0},showSearchHeader(){var e,t;if(!1===this.col.searchHeader)return;if(null!==(e=this.col.searchHeader)&&void 0!==e&&e.hidden)return!1;if(null!==(t=this.col.search)&&void 0!==t&&t.hidden)return!1;const i=z(this.ctx.crudOptions.searchHeader);return this.col.search&&i||this.col.searchHeader&&i},showEditIcon(){return!(!this.ctx.validateEditMode("cell")||!1===this.col.isEdit)}},methods:{bindColumnConfig(){var e;const t=null===(e=this.$refs.column)||void 0===e?void 0:e.columnConfig;t&&(t.col={...this.col},t.options={...this.ctx.crudOptions})},getTopProps(){const e=this.ctx.crudOptions;return{isTree:this.ctx.isTree,childrenKey:this.ctx.childrenKey,valueKey:this.ctx.valueKey,extendsScopedSlots:this.ctx.extendsScopedSlots,isTriggerEdit:this.ctx.isTriggerEdit,size:e.size,itemSize:e.itemSize,delayRenderConfig:e.delayRenderConfig,defaultRender:e.defaultRender}}},render(e){const{col:t,ctx:i,showSearchHeader:s,showOverflowTooltip:o,isShow:r,fixed:n}=this,a=i.isDefaultColumn(t);if(!r)return null;const l=i.setOptions.fixedWidth[t.prop],h=this.getTopProps(),d=s=>function(e,{col:t,scope:i,ctx:s,topProps:o}){if(i.row.$delay&&!i.row.$delay.includes(t.prop)){const r=Ut(t,o,s,i);return e("div",{attrs:{"data-row-key":i.row[o.valueKey],"data-full-prop":r,"data-prop":t.prop},style:{height:(o.itemSize||40)+"px"},directives:[{name:"scObserveVisibility",value:{onVisible:()=>{i.row.$delay.push(t.prop)},rootClass:"el-table__body-wrapper",batchConfig:o.delayRenderConfig}}]})}return Jt(e,{col:t,scope:i,ctx:s,topProps:o})}(e,{col:t,scope:s,ctx:i,topProps:h});return e(Qt.TableColumn,c()([{ref:"column"},{props:t},{attrs:{prop:t.prop,fixed:n,"header-align":t.headerAlign||t.align||"center",align:t.align||"center",width:l||t.width,"min-width":t.minWidth,"show-overflow-tooltip":o},scopedSlots:{default:a?null:e=>d(e),header:()=>e("div",{class:[this.b(["header"])],style:{color:this.isSearch?"var(--color-primary)":""}},[this.showEditIcon&&e("i",{class:"el-icon-edit-outline",style:"margin-right:5px;color:var(--color-primary)"}),e(oe,{attrs:{slotName:t.prop+"-header",render:t.labelRender||t.headerRender,slots:i.$scopedSlots}},[e("span",c()([{style:"white-space: nowrap;"},{domProps:{innerHTML:t.label}}]))]),s&&e(Zt,c()([{},{on:{"update:isSearch":e=>{this.isSearch=e}}},{attrs:{item:t.searchHeader}}]))])}},{on:{"hook:mounted":()=>{this.bindColumnConfig()}}}]),[t.children&&t.children.map(t=>e(ti,{key:t.label+t.prop,attrs:{col:t}}))])}}),ti=Object(se.a)(ei,void 0,void 0,!1,null,null,null).exports,ii={inject:["ctx"],props:{col:Object},watch:{col(){this.bindColumnConfig()}},created(){const e=this.col.spanProp||this.col.sameRowSpan;e&&this.ctx.sameRowSpans.push(e)},computed:{crudOptions(){return this.ctx.crudOptions},defaultFixed(){return this.fixed},showColumn(){return!this.ctx.setOptions.hidden.includes(this.col.prop)},fixed(){if(this.col.fixed)return this.col.fixed;const e=this.ctx.setOptions.fixed[this.col.prop];return e||void 0}},methods:{bindColumnConfig(){var e;const t=null===(e=this.$refs.column)||void 0===e?void 0:e.columnConfig;t&&(t.col={...this.col},t.options={...this.ctx.crudOptions})}},render(e){if(!this.showColumn)return null;const t=(t,i)=>e("el-table-column",c()([{ref:"column",key:this.col.type,attrs:{prop:this.col.type,type:i,fixed:this.defaultFixed}},{props:this.col},{},{on:{"hook:mounted":this.bindColumnConfig}},{scopedSlots:t}]));if(this.ctx.showSingleSelection)return t({default:t=>{let i=!1;return Object(m.a)(this.ctx.singleSelection.selectable)&&(i=!this.ctx.singleSelection.selectable(t.row,t.$index)),e("el-radio",{attrs:{value:this.ctx.selected[this.ctx.operateKey],label:t.row[this.ctx.operateKey],disabled:i},on:{change:()=>{this.ctx.$emit("update:selected",t.row)}}},["  "])}});const i=this.col.spanProp||this.col.sameRowSpan;return"index"===this.col.type&&(Object(m.a)(this.col.index)||i)?t({default:t=>{if(i){var s;const o=this.ctx.sameRowMap[i]||{},r=t.row[i]||"",n=null==o||null===(s=o[r])||void 0===s?void 0:s.find(e=>t.$index>=e.firstIndex&&t.$index<e.firstIndex+e.span),a=(null==n?void 0:n.spanIndex)||t.$index;return this.col.render?this.col.render(e,a+1):a+1}return this.col.index(t.$index,t)}},this.col.type):t({default:this.col.render||this.ctx.$scopedSlots[this.col.type]?t=>this.col.render?this.col.render(e,t):this.ctx.$scopedSlots[this.col.type]?this.ctx.$scopedSlots[this.col.type](t):void 0:null},this.col.type)}},si=Object(se.a)(ii,void 0,void 0,!1,null,null,null).exports,oi=a({name:"crud-pagination",inject:["ctx"],data:()=>({pageScrollMap:new Map}),computed:{showPagination(){return z(this.pagination,null,this.total>0)},pagination(){return this.ctx.crudOptions.pagination},paginationOn(){var e;return null===(e=this.pagination)||void 0===e?void 0:e.on},props(){return this.ctx.crudOptions.props},pageNum:{get(){return this.ctx.query[this.props.pageNum]},set(e){this.ctx.query[this.props.pageNum]=e}},pageSize:{get(){return this.ctx.query[this.props.pageSize]},set(e){this.ctx.query[this.props.pageSize]=e}},total(){return void 0!==this.ctx._total?this.ctx._total:this.ctx.crudOptions.localPagination?void 0!==this.ctx.localFilteredData?(null===(e=this.ctx.localFilteredData)||void 0===e?void 0:e.length)||0:this.ctx.data.length:0;var e}},watch:{total(e){e===(this.pageNum-1)*this.pageSize&&0!=e&&(this.pageNum=this.pageNum-1)},pageNum(e,t){this.pagination.memorizeScroll&&this.ctx.collectVisibleRows(t),this.saveScrollPosition(t)}},created(){this.initPage()},methods:{initPage(){this.$set(this.ctx.query,this.props.pageNum,this.ctx.search[this.props.pageNum]||this.pagination.pageNum||1),this.$set(this.ctx.query,this.props.pageSize,this.ctx.search[this.props.pageSize]||this.ctx.setOptions.pageSize||this.pagination.pageSize||10)},saveScrollPosition(e){const t=this.ctx.$refs.tableRef.$refs.bodyWrapper;t&&this.pageScrollMap.set(e,{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft})},setScrollPosition(e){this.pagination.memorizeScroll&&this.$nextTick(()=>{const t=this.ctx.$refs.tableRef.$refs.bodyWrapper;if(!t)return;const i=this.pageScrollMap.get(e);i?(t.scrollTop=i.scrollTop,t.scrollLeft=i.scrollLeft):(t.scrollTop=0,t.scrollLeft=0)})},handleSizeChange(e){this.saveScrollPosition(this.pageNum),this.pageNum*e>this.total&&(this.pageNum=1),this.ctx.setOptions.pageSize=e,this.ctx.saveLocalCache(!1),this.handleDataChange(),this.setScrollPosition(this.pageNum),this.ctx.$emit("sizeChange",e)},handleCurrentChange(e){this.handleDataChange(),this.ctx.$emit("currentChange",e)},handleDataChange(){this.ctx._isPaging=!0,this.ctx.crudOptions.localPagination?this.$nextTick(()=>{this.ctx.updateSelection()}):this.$nextTick(()=>{this.ctx.getList().then(()=>{this.setScrollPosition(this.pageNum)})})}}}),ri=Object(se.a)(oi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-pagination",e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.showPagination,expression:"showPagination"}],class:e.b(),style:{"text-align":e.pagination.align},attrs:{"current-page":e.pageNum,"page-size":e.pageSize,total:e.total,disabled:e.ctx.loadingStatus},on:{"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.pagination,!1),e.paginationOn))}),[],!1,null,null,null).exports,ni=i(801),ai=a({name:"crud-select-banner",inject:["ctx"],computed:{selected(){return this.ctx.showSelection?Object(ni.a)(this.ctx.selected,this.ctx.operateKey):this.ctx.showSingleSelection?this.ctx.selected:void 0},selection(){return this.ctx.showSingleSelection?this.ctx.singleSelection:this.ctx.selection},singleLabelText(){var e;return this.selected[this.labelKey]||(null===(e=this.ctx.flatList.find(e=>e[this.operateKey]==this.selected[this.operateKey]))||void 0===e?void 0:e[this.labelKey])},labelKey(){return this.selection.labelKey||this.ctx.operateKey||this.ctx.valueKey},showClearAction(){return this.ctx.showSelection?this.selection.clear:this.ctx.showSingleSelection?this.ctx.singleSelection.clear:void 0},showBanner(){return this.ctx.showSelection?this.selected.length>0:!!this.ctx.showSingleSelection&&this.selected}},methods:{}}),li=Object(se.a)(ai,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.showBanner,expression:"showBanner"}],class:e.b()},[e.ctx.showSelection?t("div",{class:e.b("banner-content")},[t("span",[e._v("已选择 "+e._s(e.selected.length)+" 项")]),e._v(" "),e.selected.length<=e.selection.maxDisplay?[t("span",{class:e.b("selected-items")},e._l(e.selected,(function(i){return t("el-tag",{key:i[e.ctx.operateKey],class:e.b("remove-tag"),attrs:{size:"small",closable:"","disable-transitions":""},on:{close:function(t){return e.ctx.removeSelection(i)}}},[e._v(e._s(i[e.labelKey]))])})),1)]:[t("el-popover",{attrs:{placement:"bottom",trigger:"hover","popper-class":e.b("popover")},scopedSlots:e._u([{key:"reference",fn:function(){return[t("span",{class:e.b("popover-selected-preview")},[e._l(e.selected.slice(0,e.selection.maxDisplay),(function(i){return t("el-tag",{key:i[e.ctx.operateKey],class:e.b("remove-tag"),attrs:{size:"small",closable:"","disable-transitions":""},on:{close:function(t){return e.ctx.removeSelection(i)}}},[e._v(e._s(i[e.labelKey]))])})),e._v("\n            等 "+e._s(e.selected.length)+" 项\n          ")],2)]},proxy:!0}],null,!1,2988529298)},[e._v(" "),t("div",{class:e.b("popover-list")},e._l(e.selected.slice(e.selection.maxDisplay),(function(i){return t("div",{key:i[e.ctx.operateKey],class:e.b("popover-item")},[t("span",[e._v(e._s(i[e.labelKey]))]),e._v(" "),t("el-tag",{class:e.b("popover-remove-tag"),attrs:{size:"small",closable:"","disable-transitions":""},on:{close:function(t){return e.ctx.removeSelection(i)}}})],1)})),0)])],e._v(" "),t("div",{class:e.b("banner-actions")},[e.showClearAction?t("el-button",{attrs:{type:"text"},on:{click:e.ctx.clearSelection}},[e._v("\n        清空选择\n      ")]):e._e()],1)],2):e.selected?t("div",{class:e.b("banner-content")},[t("span",[e._v("已选择")]),e._v(" "),t("span",{class:e.b("selected-items")},[t("el-tag",{class:e.b("remove-tag"),attrs:{size:"small",closable:"","disable-transitions":""},on:{close:e.ctx.removeSingleSelection}},[e._v(e._s(e.singleLabelText))])],1),e._v(" "),t("div",{class:e.b("banner-actions")},[e.showClearAction?t("el-button",{attrs:{type:"text"},on:{click:e.ctx.removeSingleSelection}},[e._v("\n        清空选择\n      ")]):e._e()],1)]):e._e()])}),[],!1,null,null,null).exports,ci=i(790),hi=i(761),di=["data","size","width","height","maxHeight","fit","stripe","border","rowKey","context","showHeader","showSummary","sumText","summaryMethod","rowClassName","rowStyle","cellClassName","cellStyle","headerRowClassName","headerRowStyle","headerCellClassName","headerCellStyle","highlightCurrentRow","highlightSelectionRow","currentRowKey","emptyText","expandRowKeys","defaultExpandAll","defaultSort","tooltipEffect","spanMethod","selectOnIndeterminate","indent","treeProps","lazy","load"],ui=a({name:"crud",components:{columnAction:Wt,column:ti,defaultColumn:si,menuBar:Yt,pagination:ri,search:Nt,group:Be,position:oe,selectBanner:li,virtualScroll:ci.a,batchMockData:lt,ElTableExcelExtends:hi.a},mixins:[J("crudOptions"),de,Ot,me,fe,Z,$t,_t,kt,Dt,Et,Mt,Rt,jt,At,Bt,It],props:{scope:Object,data:{type:Array,default:()=>[]},total:{type:Number},search:{type:Object,default:()=>({})},loading:{type:Boolean},slots:{},searchParams:{},load:Function},provide(){return{ctx:this,controlCtx:this}},data:()=>({key:Math.random(),showSearch:!1,isMaximize:!1,query:{},form:{},selectionRow:[],isChangeShowSearch:!1,virtualList:[],lazyTreeData:[],showPopperNum:0,sameRowSpans:[],_showSummary:!1,treeNodeMap:new Map,labelMinWidthMap:new Map,oldVNodeMap:new Map,showMockDialog:!1}),mounted(){this.crudOptions.init&&this.initQuery(),this.extendMethod(this.$refs.tableFormRef,["validate","clearValidate"]),this.extendMethod(this.$refs.tableRef),this.refactorTableHeaderClick()},computed:{rowKey_(){if(this.isTree||this.crudOptions.selection.reserveSelection||this.crudOptions.selection["reserve-selection"]||this.crudOptions.rowKey)return this.valueKey},virtualized(){return this.crudOptions.virtualized},valueKey(){return this.crudOptions.uniqueId?"$uniqueId":this.crudOptions.rowKey?this.crudOptions.rowKey:this.crudOptions.valueKey},childrenKey(){var e;return(null===(e=this.crudOptions)||void 0===e||null===(e=e.treeProps)||void 0===e?void 0:e.children)||"children"},crudOptions(){return this.resultOptions},tableProps(){const e={};Object.keys(this.crudOptions).forEach(t=>{e[F(t)]=this.crudOptions[t]});const t=Object(re.a)(e,di),i=this.tableHeight;return i?t.height=i:delete t.height,t},tableListeners(){const e={...Object(w.a)(this.$listeners,"input","selection-change","selectionChange")};return Object.keys(this.crudOptions).forEach(t=>{"function"==typeof this.crudOptions[t]&&(e[t]=this.crudOptions[t])}),e},defaultColumns(){const e=[],t=Object(re.a)(this.crudOptions,["expand","index","selection","singleSelection"]);return Object.keys(t).forEach(i=>{z(t[i])&&e.push({type:i,...t[i]})}),N(e.sort((e,t)=>e.order-t.order))},columns(){if(this.crudOptions.dynamicConfig){const e=(this.generateDynamicColumns(this.data,this.crudOptions.dynamicConfig)||[]).map(this.handleInitColumn);return N(this.insertColumns(e,this.resultColumns,this.crudOptions.dynamicInsertPosition))}return N(this.resultColumns)},flatColumns(){return S()(this.columns)},trueRenderColumns(){const e=[...this.defaultColumns,...this.flatColumns.filter(e=>!e.children)];return this.sortColumnsByFixed(e)},columnsMap(){const e={};return this.trueRenderColumns.forEach(t=>{e[t.prop]=t}),e},extendsScopedSlots(){const e={...this.$scopedSlots};return this.extendsSlots(e,"add","form"),this.extendsSlots(e,"edit","form"),this.extendsSlots(e,"view","form"),this.extendsSlots(e,"searchHeader","search"),e},wrapperPadding(){if(this.crudOptions.padding)return this.crudOptions.padding;const{gap:e=0}=this.crudOptions;return this.isAutoHeight?`${e}px ${e}px 0`:e+"px"},showEmpty(){return z(this.crudOptions.empty,null,this.$scopedSlots.empty)},enabledAreaSelection(){return z(this.areaSelection)},areaSelection(){return this.crudOptions.areaSelection||{}}},watch:{showPopperNum(){this.$emit("update:showPopper",0!==this.showPopperNum)}},methods:{refactorTableHeaderClick(){const e=this.$refs.tableRef.$refs.tableHeader;e.handleHeaderClick;e.handleHeaderClick=(t,i)=>e.$parent.$emit("header-click",i,t)},lazyLoad(e,t,i){if(this.crudOptions.autoLazy){this.treeNodeMap.set(e[this.valueKey],{tree:e,treeNode:t,resolve:i});const{item:s}=O()(this.lazyTreeData,t=>t[this.valueKey]===e[this.valueKey]);if(s&&s[this.childrenKey]&&s[this.childrenKey].length){const t=Object(f.a)(s[this.childrenKey]);this.handleLocalLazy(t),e.children=t,i(t)}else this.$set(this.$refs.tableRef.store.states.lazyTreeNodeMap,e[this.valueKey],[])}this.load&&this.load(e,t,i)},handleLocalLazy(e){e.forEach(e=>{e[this.childrenKey]&&e[this.childrenKey].length&&(delete e[this.childrenKey],e.hasChildren=!0)})},getRenderColumns(e){var t,i;const s=this.crudOptions,o=e+"Form";return!Object(T.a)(s.formOptions)||!Array.isArray(s.formOptions.renderColumns)||null!==(t=s[o])&&void 0!==t&&t.renderColumns||!1===s[o]?Object(T.a)(s[o])&&Array.isArray(s[o].renderColumns)?s[o].renderColumns||[]:null===(i=this.columns)||void 0===i?void 0:i.filter(t=>t[e]&&!1!==t[e]&&!1!==s[o]).map(t=>t[e]):s.formOptions.renderColumns||[]},refreshTable(){this.$refs.tableRef.doLayout(),this.$nextTick(()=>{this.key=Date.now()})},defineRowIndex({row:e,rowIndex:t}){return Object.defineProperty(e,"$index",{value:t,writable:!0,enumerable:!1}),this.crudOptions.rowStyle?this.crudOptions.rowStyle.call(null,{row:e,rowIndex:t}):null},_runWithoutDeps(e){const t=this.$data.__ob__.dep.constructor,i=t.target;t.target&&(t.target=null);try{return e()}finally{t.target=i}},executeWithDeps(e,t=!0,...i){if(e)return!1===t?this._runWithoutDeps(()=>e.call(null,...i)):e.call(null,...i)},cellClassName_({row:e,column:t,rowIndex:i,columnIndex:s}){const{cellClassName:o,methodCollectDepends:r,editTheme:n}=(null==t?void 0:t.options)||{};let a=this.executeWithDeps(o,r,{row:e,column:t,rowIndex:i,columnIndex:s})||"";const l=t.col;return l?(!l.type&&n&&this.validateEdit(l,{row:e,$index:i})&&(a+=(a?" ":"")+"edit-cell"),l.type||this.isDefaultColumn(l)||(a+=(a?" ":"")+"custom-cell"),a):a},checkHiddenButtons(e,t,i){return t=K(t,this.crudOptions,i,e)},handleWrapperClick(){this.showPopperNum>0&&this.$emit("closeSearchPopover")},_forceUpdate(){var e;null===(e=this.$refs)||void 0===e||null===(e=e.tableRef)||void 0===e||null===(e=e.store)||void 0===e||e.updateColumns()},rowClick(e,t,i){var s;this.selectRowClick(e,t,i),t&&"action"!==(null===(s=t.col)||void 0===s?void 0:s.type)&&this.handleRowClick({row:e,$index:e.$index},t.col.prop,"click")},rowDblclick(e,t,i){var s;t&&"action"!==(null===(s=t.col)||void 0===s?void 0:s.type)&&this.handleRowClick({row:e,$index:e.$index},t.col.prop,"dblclick")},cellClick(e,t,i,s){var o;t&&"action"!==(null===(o=t.col)||void 0===o?void 0:o.type)&&this.handleCellClick({row:e,$index:e.$index},t.col,"click")},cellDblclick(e,t,i,s){var o;t&&"action"!==(null===(o=t.col)||void 0===o?void 0:o.type)&&this.handleCellClick({row:e,$index:e.$index},t.col,"dblclick")},headerDragend(e,t,i,s){this.crudOptions.persistWidth&&i&&i.property&&(this.setOptions.fixedWidth[i.property]=e,this.saveLocalCache(!1))},cellMouseEnter(e,t,i,s){this.triggerValidateTooltip(e,t,i,s)},cellMouseLeave(e,t,i,s){this.removeValidateTooltip(e,t,i,s)},sortColumnsByFixed(e){const t=e=>!0===e.fixed||"left"===e.fixed?"left":"right"===e.fixed?"right":e.prop&&this.setOptions.fixed[e.prop]?this.setOptions.fixed[e.prop]:null,i=[],s=[],o=[];return e.forEach(e=>{const r=t(e);"left"===r?i.push(e):"right"===r?o.push(e):s.push(e)}),[...i,...s,...o]},getCellValueMethod(e){var t;const{row:i,column:s}=e,o=s.col,r=(null==o||null===(t=o.form)||void 0===t?void 0:t.prop)||(null==o?void 0:o.prop);if(r)return this.areaSelection.getCellValueMethod?this.areaSelection.getCellValueMethod({...e,value:this.getByProp(i,r)}):this.getByProp(i,r)},setCellValueMethod(e,t){var i;const{row:s,column:o,value:r}=e,n=o.col,a=(null==n||null===(i=n.form)||void 0===i?void 0:i.prop)||(null==n?void 0:n.prop);if(a&&this.checkPastePermission(s,n))return this.areaSelection.setCellValueMethod?this.areaSelection.setCellValueMethod(e,t):(t(s,a,r),!0)},checkPastePermission(e,t){var i;if(this.areaSelection.pastePermission)return this.areaSelection.pastePermission(e,t);if("all"===(null===(i=this.areaSelection)||void 0===i?void 0:i.operationType))return!0;const s={row:e,$index:e.$index},{mode:o,disabled:r,isRowEdit:n}=this.editConfig,a="function"==typeof t.isEdit?t.isEdit(s):t.isEdit;return"row"===o?!(n&&!1===n(s)||!1===a||r)&&(this.setRowEdit(e),!0):["cell","free"].includes(o)?!1!==a&&!r:!(!a||r)},customMapping({value:e,column:t,rowIndex:i,columnIndex:s},o){var r,n;if(null!=o&&null!==(r=o.comp)&&void 0!==r&&r.options||null!=o&&o.dictData){var a;return((null==o||null===(a=o.comp)||void 0===a?void 0:a.options)||(null==o?void 0:o.dictData)).find(t=>t.label===e).value||e}const l=null==o||null===(n=o.$children)||void 0===n?void 0:n[0],c=null==l?void 0:l.options;if(c){const t=null==c?void 0:c.find(t=>t.label===e);return(null==t?void 0:t.value)||e}return this.areaSelection.customMapping?this.areaSelection.customMapping({value:e,column:t,rowIndex:i,columnIndex:s},o):e}}}),pi=Object(se.a)(ui,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{ref:"wrapper",class:[e.b(),{[e.b("maximize")]:e.isMaximize,[e.b("is-auto-height")]:e.isAutoHeight,[e.b("is-change-show-search")]:e.isChangeShowSearch}],style:{padding:e.wrapperPadding,height:e.wrapperHeight},attrs:{tabindex:"0"},on:{click:e.handleWrapperClick}},[t("position",{attrs:{slotName:"title",slots:e.$scopedSlots}},[e.crudOptions.title?t("div",{staticClass:"sc-title"},[e._v("\n      "+e._s(e.crudOptions.title)+"\n    ")]):e._e()]),e._v(" "),t("search",{ref:"searchRef"}),e._v(" "),t("menuBar",{ref:"menuBar"}),e._v(" "),e.selection.banner||e.singleSelection.banner?t("selectBanner"):e._e(),e._v(" "),t("el-form",{ref:"tableFormRef",staticClass:"height--form",attrs:{model:{list:e.list},"show-message":!1,size:e.crudOptions.size,disabled:e.crudOptions.disabled},on:{validate:e.createListError},nativeOn:{submit:function(e){e.preventDefault()}}},[t(e.enabledAreaSelection?"ElTableExcelExtends":"div",e._g(e._b({ref:"areaSelectionRef",tag:"component",attrs:{customMapping:e.customMapping,getCellValueMethod:e.getCellValueMethod,setCellValueMethod:e.setCellValueMethod}},"component",e.areaSelection,!1),e.$listeners),[t(e.virtualized?"virtualScroll":"div",e._b({tag:"component",attrs:{data:e.virtualized?e.list:null,"key-prop":e.valueKey,virtualized:e.virtualized},on:{change:t=>e.virtualList=t}},"component",e.$attrs,!1),[t("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loadingStatus,expression:"loadingStatus"}],key:e.key,ref:"tableRef",attrs:{"element-loading-text":e.crudOptions.loadingText,"element-loading-spinner":e.crudOptions.loadingSpinner,"element-loading-background":e.crudOptions.loadingBackground,"highlight-current-row":"","highlight-selection-row":"",data:e.virtualized?e.virtualList:e.list,"row-key":e.rowKey_,"row-style":e.defineRowIndex,"cell-class-name":e.cellClassName_,"row-class-name":e.rowClassName_,lazy:e.crudOptions.lazy||e.crudOptions.autoLazy,load:e.lazyLoad,spanMethod:e.spanMethod,"summary-method":e.summaryMethod,"show-summary":e.showSummary},on:{"cell-mouse-enter":e.cellMouseEnter,"cell-mouse-leave":e.cellMouseLeave,"row-contextmenu":e.openContextMenu,"header-contextmenu":e.openContextHerderMenu,"selection-change":e.selectionChange,select:e.select,"select-all":e.selectAll,"row-click":e.rowClick,"row-dblclick":e.rowDblclick,"cell-click":e.cellClick,"cell-dblclick":e.cellDblclick,"header-dragend":e.headerDragend}},"el-table",e.tableProps,!1),e.tableListeners),[t("template",{slot:"empty"},[e.showEmpty?t("div",{class:e.b("empty")},[e.$scopedSlots.empty?e._t("empty"):t("el-empty",{attrs:{image:e.crudOptions.empty.image,"image-size":e.crudOptions.empty.size,description:e.crudOptions.empty.text}})],2):e._e()]),e._v(" "),e._l(e.defaultColumns,(function(e){return t("defaultColumn",{key:e.type,attrs:{col:e}})})),e._v(" "),e._t("default"),e._v(" "),e._l(e.columns,(function(e){return t("column",{key:e.prop||e.label,attrs:{col:e}})})),e._v(" "),t("columnAction")],2)],1)],1),e._v(" "),t("el-tooltip",{ref:"tooltip",attrs:{effect:"light","popper-class":e.b("error-tip"),placement:"top",content:e.errorContent}})],1),e._v(" "),t("batchMockData",{attrs:{visible:e.showMockDialog,columns:e.columns,data:e.list,"value-key":e.valueKey,"instance-type":"table","instance-ref":e.$refs.tableRef},on:{"update:visible":function(t){e.showMockDialog=t},generate:e.handleGenerateMockData,close:e.handleCloseMockDialog}}),e._v(" "),e.editConfig.lastAdd?t("div",{class:e.b("add-button"),on:{click:e.handleLastAdd}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增一行\n  ")]):e._e(),e._v(" "),t("position",{attrs:{inline:!1,slotName:"pagination",slots:e.$scopedSlots}},[t("pagination",{ref:"paginationRef"})],1)],1)}),[],!1,null,null,null).exports;const mi=["primary","success","warning","danger"],fi=["plain","light"];var gi=a({name:"value-format",props:{value:{require:!1},multiple:{default:!0,require:!1},separator:{default:",",require:!1},color:{require:!1},effect:{require:!1},autoColors:{type:Array},autoEffects:{type:Array},scope:Object,props:{type:Object,default:()=>({value:"value",label:"label",color:"color"})}},data:()=>({}),computed:{COLOR_LIST:()=>mi,options(){if(null==this.value||""===this.value)return[];if(this.loading)return[];const e=this.dictDataMap,t=this.getValueArr(),i=[],s=this.props;if(null==e||0===Object.keys(e).length){for(const e of t){const t={};t[s.value]=e,t[s.label]=e,this.setColor(t,s),i.push(t)}return i}for(const o of t){let t=e[o];null!=t?(this.setColor(t,s),i.push(t)):(t={},t[s.value]=o,t[s.label]=o,this.setColor(t,s),i.push(t))}return i},dictDataMap(){var e;return this.$attrs.options?this.formatMap(this.$attrs.options):null===(e=this.scope.dict)||void 0===e?void 0:e.toMap()}},methods:{formatMap(e){const t={};return e.forEach(e=>{t[e.value]=e,e.children&&this.formatMap(e.children,t)}),t},getValueArr(){let e=[];return e="string"==typeof this.value&&this.multiple&&null!=this.separator&&""!==this.separator?this.value.split(this.separator):this.value instanceof Array?this.value:[this.value],e},onClick(e){this.$emit("click",{item:e})},setColor(e,t){if(!e.effect&&this.effect&&(e.effect=this.effect),!e[t.color])if("auto"===this.color){const i=this.hashcode(e[t.value]),s=this.autoColors?this.autoColors:mi;e[t.color]=s[i%s.length];const o=this.autoEffects?this.autoEffects:fi;e.effect=o[Math.floor(i/s.length)%o.length]}else e[t.color]=this.color},hashcode(e){if(null==e)return 0;"string"!=typeof e&&(e=JSON.stringify(e));let t,i,s,o=0;if(0===e.length)return o;for(t=0,s=e.length;t<s;t++)i=e.charCodeAt(t),o=(o<<5)-o+i,o|=0;return o}}}),yi=Object(se.a)(gi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("span",[e._l(e.options,(function(i,s){return[i[e.props.color]&&e.COLOR_LIST.includes(i[e.props.color])?t("el-tag",e._b({key:i[e.props.value],attrs:{size:"small",type:i[e.props.color],effect:i.effect,"disable-transitions":""},on:{click:function(t){return e.onClick(i)}}},"el-tag",e.$attrs,!1),[e._v("\n      "+e._s(i[e.props.label])+"\n    ")]):t("span",{key:i[e.props.value],style:{color:i[e.props.color]},on:{click:function(t){return e.onClick(i)}}},[e._v(e._s(i[e.props.label]+(s===e.options.length-1?"":"、")))])]}))],2)}),[],!1,null,null,null).exports,bi=a({name:"cascade-format",props:{value:{type:[String,Array],require:!0},separator:{default:",",require:!1},multiple:{type:Boolean,default:!1},scope:Object,options:Array,props:{type:Object,default:()=>({value:"value",label:"label",children:"children"})}},data:()=>({}),computed:{labels(){return null==this.value?[]:this.buildValueItem(this.value)},multipleLabels(){if(null==this.value)return[];const e=[];for(const t of this.value)e.push(this.buildValueItem(t));return e},_options(){return this.options||this.scope.dict}},methods:{getValueArr(e){if(null==e)if(this.multiple){e=[];for(const t of this.value)for(const i of t)e.push(i)}else e=this.value;if(null==e)return[];let t=null;return t="string"!=typeof e||this.multiple||null==this.separator||""===this.separator?e instanceof Array?e:[e]:e.split(this.separator),t},getDictItem(e,t,i){let s="value";if(this.props.value&&(s=this.props.value),i){let i="children";return this.props.children&&(i=this.props.children),this.deepMatch(e,s,i,t)}for(const i of t)if(i[s]===e)return i},deepMatch(e,t,i,s){for(const i of s)if(i[t]===e)return i;for(const o of s)if(o[i]){const s=this.deepMatch(e,t,i,o[i]);if(s)return s}},buildValueItem(e){const t=this.getValueArr(e);let i="label";null!=this.props&&null!=this.props.label&&(i=this.props.label);let s="children";null!=this.props&&null!=this.props.children&&(s=this.props.children);const o=[];if(this._options&&this._options.length>0){let e=this._options;const r=1===t.length;for(const n of t){if(null!=e){const t=this.getDictItem(n,e,r);if(null!=t){e=t[s],o.push(t[i]);continue}}o.push(n)}}return o}}}),vi=Object(se.a)(bi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("span",[e.multiple?e._l(e.multipleLabels,(function(i,s){return t("div",{key:s},e._l(i,(function(i,s){return t("span",{key:s},[0!==s?t("span",[e._v(" / ")]):e._e(),e._v(" "),t("span",[e._v(e._s(i))])])})),0)})):e._l(e.labels,(function(i,s){return t("span",{key:s},[0!==s?t("span",[e._v(" / ")]):e._e(),e._v(" "),t("span",[e._v(e._s(i))])])}))],2)}),[],!1,null,null,null).exports,wi={mixins:[{props:{value:{required:!1}},data:()=>({currentValue:void 0}),mounted(){},methods:{isValueChanged(e){return this.currentValue!==e},setValue(e){this.currentValue=e,this.onInput(e)},onInput(e){this.$emit("input",e)}}}],watch:{value(e,t){this.isValueChanged(e)&&this.setValue(e)}},created(){this.setValue(this.value)}},xi={mounted(){this.extendMethod(this.$refs.target)},methods:{extendMethod(e,t=[]){const i=Object.entries(e);for(const[e,s]of i)e.includes("$")||e.includes("_")||!Object(m.a)(s)||this[e]||t.includes(e)||(this[e]=s)}}},Si=a({name:"cascader",mixins:[wi,xi],props:{value:{default:()=>[],require:!1},scope:Object,options:Array},data:()=>({}),computed:{_options(){var e;return this.options||(null===(e=this.scope)||void 0===e?void 0:e.dict)},listeners(){return Object(w.a)(this.$listeners,["input"])}},methods:{setValue(e){null!=e?"string"!=typeof this.value?this.currentValue=e instanceof Array?e:[]:this.currentValue=e.split(","):this.currentValue=[]}}}),Ci=Object(se.a)(Si,(function(){var e=this._self._c;this._self._setupProxy;return e("el-cascader",this._g(this._b({ref:"target",attrs:{value:this.currentValue,options:this._options},on:{input:this.onInput}},"el-cascader",this.$attrs,!1),this.listeners))}),[],!1,null,null,null).exports,Oi=a({name:"select",mixins:[wi,xi],props:{value:{type:[Number,String,Boolean,Array],require:!1},separator:{default:",",require:!1},multiple:{default:!1},scope:Object,options:Array,props:{type:Object,default:()=>({value:"value",label:"label"})}},computed:{_options(){var e;return this.options||(null===(e=this.scope)||void 0===e?void 0:e.dict)||[]},listeners(){return Object(w.a)(this.$listeners,["input","change"])}},methods:{setValue(e){if(!this.multiple){if(e===this.currentValue)return;return void(this.currentValue=e)}if(null==e)return void(this.currentValue=[]);if("string"==typeof e&&null!=this.separator&&""!==this.separator)return void(this.currentValue=e.split(this.separator));if(!(e instanceof Array))return void(this.currentValue=[e]);const t=[];for(const i of e)null!=i&&t.push(i);this.currentValue=t,1===e.length&&null==e[0]&&this.onInput(t)},onChange(e){e instanceof Array?this.$emit("objectChange",this._options.filter(t=>e.includes(t[this.props.value]))):this.$emit("objectChange",this._options.find(t=>t[this.props.value]===e)),this.$emit("change",e)}}}),$i=Object(se.a)(Oi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-select",e._g(e._b({ref:"target",staticStyle:{width:"100%"},attrs:{value:e.currentValue,filterable:"","value-key":e.props.value,multiple:e.multiple},on:{input:e.onInput,change:e.onChange}},"el-select",e.$attrs,!1),e.listeners),e._l(e._options,(function(i){return t("el-option",e._b({key:i[e.props.value],attrs:{value:i[e.props.value],label:i[e.props.label]}},"el-option",i,!1))})),1)}),[],!1,null,null,null).exports,_i=a({name:"radio",mixins:[wi,xi],props:{value:{require:!1},type:{type:String,default:"el-radio"},scope:Object,options:Array,props:{type:Object,default:()=>({value:"value",label:"label"})}},computed:{_options(){var e;return this.options||(null===(e=this.scope)||void 0===e?void 0:e.dict)},listeners(){return Object(w.a)(this.$listeners,["input","change"])}},methods:{onChange(e){this.$emit("objectChange",this._options.find(t=>t[this.props.value]===e)),this.$emit("change",e)}}}),ki=Object(se.a)(_i,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-radio-group",e._g(e._b({ref:"target",staticStyle:{width:"100%"},attrs:{value:e.currentValue},on:{input:e.onInput,change:e.onChange}},"el-radio-group",e.$attrs,!1),e.listeners),e._l(e._options,(function(i){return t(e.type,e._b({key:i[e.props.value],tag:"component",attrs:{label:i[e.props.value]}},"component",i,!1),[e._v(e._s(i[e.props.label]))])})),1)}),[],!1,null,null,null).exports,Di=a({name:"switch",mixins:[xi],props:{value:{require:!1},scope:Object,options:Array,props:{type:Object,default:()=>({value:"value",label:"label",color:"color"})},showText:{type:Boolean,default:!0}},data:()=>({}),computed:{_options(){var e;return this.options||(null===(e=this.scope)||void 0===e?void 0:e.dict)},_active(){var e;return(null===(e=this._options)||void 0===e?void 0:e.length)>0?this._options[0]:{}},_inActive(){var e;return(null===(e=this._options)||void 0===e?void 0:e.length)>1?this._options[1]:{}},listeners(){return Object(w.a)(this.$listeners,["input"])}},methods:{onElInput(e){this.onInput(e)}}}),Ei=Object(se.a)(Di,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-switch",e._g(e._b({ref:"target",attrs:{"active-color":e._active[e.props.color],"active-value":e._active[e.props.value],"active-text":e.showText?e._active[e.props.label]:"","inactive-color":e._inActive[e.props.color],"inactive-value":e._inActive[e.props.value],"inactive-text":e.showText?e._inActive[e.props.label]:""},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},"el-switch",e.$attrs,!1),e.listeners))}),[],!1,null,null,null).exports,Ri=a({name:"checkbox",mixins:[wi,xi],props:{value:{type:[Number,String,Boolean,Array],require:!1},separator:{default:",",require:!1},type:{type:String,default:"el-checkbox"},scope:Object,options:Array,props:{type:Object,default:()=>({value:"value",label:"label"})}},data:()=>({}),computed:{_options(){var e;return this.options||(null===(e=this.scope)||void 0===e?void 0:e.dict)},listeners(){return Object(w.a)(this.$listeners,["input","change"])}},methods:{setValue(e){null!=e?"string"!=typeof e||null==this.separator||""===this.separator?this.currentValue=e:this.currentValue=e.split(this.separator):this.currentValue=[]},onChange(e){this.$emit("objectChange",this._options.filter(t=>e.includes(t[this.props.value]))),this.$emit("change",e)}}}),Ti=Object(se.a)(Ri,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-checkbox-group",e._g(e._b({ref:"target",staticStyle:{width:"100%"},attrs:{value:e.currentValue},on:{input:e.onInput,change:e.onChange}},"el-checkbox-group",e.$attrs,!1),e.listeners),e._l(e._options,(function(i){return t(e.type,e._b({key:i[e.props.value],tag:"component",attrs:{label:i[e.props.value]}},"component",i,!1),[e._v(e._s(i[e.props.label]))])})),1)}),[],!1,null,null,null).exports,Mi=a({name:"tabs",props:{value:{},tabList:{type:Array,default:()=>[]},lazy:{type:Boolean,default:!0},cache:{type:Boolean,default:!0},all:[Boolean,Object],border:Boolean,cacheActive:{type:Boolean,default:!0},refresh:{type:Boolean,default:!1}},components:{Render:Re},data:()=>({activeName:"",renderedTabs:new Set,currentTab:"",isRefreshing:!1,scope:{row:{}}}),computed:{omitListeners(){return Object(w.a)(this.$listeners,["tab-click","input"])},allConfig(){const e={label:"全部",name:null};return Object(T.a)(this.all)?{...e,...this.all}:e}},watch:{value:{handler(e){this.initActiveName(e)},immediate:!0},activeName:{handler(e){if(!e)return;this.handleTabTransition(e),this.renderedTabs.add(e);const t=this.all&&"all"===e?this.allConfig.name:e;this.$emit("input",t)},immediate:!0},tabList:{handler(){this.initActiveName(this.value)}}},mounted(){var e;this.cacheActive&&null!==(e=this.$route)&&void 0!==e&&e.query.tabActive&&(this.activeName=this.$route.query.tabActive),this.$nextTick(this.updateContentHeight),this.resizeObserver=new ResizeObserver(()=>{this.updateContentHeight()}),this.observeActivePane()},updated(){this.$nextTick(this.updateContentHeight)},beforeDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{handleTabClick(e){this.$nextTick(()=>{this.cacheActive&&this.updateRouteQuery(this.activeName),this.$emit("tab-click",e,this.tabList.find(e=>this.getItemName(e)===this.activeName))})},initActiveName(e){this.tabList.length&&(this.activeName=e||this.all&&"all"||this.getItemName(this.tabList[0],0))},getItem:e=>Object(T.a)(e)?e:{},getItemKey:(e,t)=>""+((null==e?void 0:e.label)||t),getItemLabel:e=>(null==e?void 0:e.label)||e,getItemName:(e,t)=>""+((null==e?void 0:e.name)||(null==e?void 0:e.value)||t),shouldRenderTab(e,t){if(!1===this.lazy)return!0;const i=this.getItemName(e,t);return(void 0===e.cache?this.cache:e.cache)?this.renderedTabs.has(i):this.currentTab===i},updateRouteQuery(e){this.$route&&this.$router.replace({path:this.$route.path,query:{...this.$route.query,tabActive:e}})},async refreshTab(e,t){if(this.isRefreshing)return;this.$emit("refresh",e,t);const i=this.getItemName(e,t);this.isRefreshing=!0,this.renderedTabs.delete(i),await this.$nextTick(),setTimeout(()=>{this.renderedTabs.add(i),this.isRefreshing=!1},300)},updateContentHeight(){const e=this.$el.querySelector(".tab-pane.is-active");if(e){const t=e.offsetHeight,i=this.$el.querySelector(".sc-tabs__content");i&&(i.style.height=t+"px")}},observeActivePane(){const e=this.$el.querySelector(".tab-pane.is-active");e&&this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver.observe(e))},async handleTabTransition(e){this.currentTab=e,await this.$nextTick(),this.observeActivePane()}}}),ji=Object(se.a)(Mi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:[e.b(),{[e.b("border")]:e.border||"card"===e.$attrs.type}]},[e.tabList.length?t("el-tabs",e._g(e._b({on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},"el-tabs",e.$attrs,!1),e.omitListeners),[e.all?t("el-tab-pane",{attrs:{label:e.allConfig.label,name:"all"}}):e._e(),e._v(" "),e._l(e.tabList,(function(i,s){return t("el-tab-pane",e._b({key:e.getItemKey(i,s),attrs:{label:e.getItemLabel(i),name:e.getItemName(i,s)},scopedSlots:e._u([{key:"label",fn:function(){return[i.icon?t("i",{class:i.icon}):e._e(),e._v(" "),e.$scopedSlots[e.getItemName(i,s)+"-label"]?e._t(e.getItemName(i,s)+"-label",null,null,i):[e._v(e._s(e.getItemLabel(i)))],e._v(" "),e.refresh&&e.cache&&e.activeName===e.getItemName(i,s)?t("i",{staticClass:"el-icon-refresh",class:{rotating:e.isRefreshing},attrs:{title:"刷新"},on:{click:function(t){return t.stopPropagation(),e.refreshTab(i,s)}}}):e._e()]},proxy:!0}],null,!0)},"el-tab-pane",e.getItem(i),!1))}))],2):e._e(),e._v(" "),e._t("default"),e._v(" "),t("div",{class:[e.b("content"),{[e.b("is-refresh")]:e.isRefreshing}]},[t("transition-group",{attrs:{name:"fade-transform",mode:"out-in"}},[e._l(e.tabList,(function(i,s){return[e.shouldRenderTab(i,s)?t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentTab===e.getItemName(i,s),expression:"currentTab === getItemName(item, index)"}],key:e.getItemKey(i,s),staticClass:"tab-pane",class:{"is-active":e.currentTab===e.getItemName(i,s)}},[e.$scopedSlots[e.getItemName(i,s)]?e._t(e.getItemName(i,s)):t("Render",e._b({attrs:{item:i,scope:{row:i.value}}},"Render",i,!1))],2):e._e()]}))],2)],1)],2)}),[],!1,null,null,null).exports,Pi=a({name:"verify-input",inject:{elForm:{default:""},elFormItem:{default:""}},props:{length:{type:Number,default:6},size:String,disabled:{type:Boolean,default:!1},allowLetters:{type:Boolean,default:!1}},data(){return{codes:Array.from({length:this.length},()=>""),timer:null}},mounted(){this.$nextTick(()=>{this.$refs.codeInput[0].focus()})},watch:{value(e){this.codes=e.split("")},codes(e){this.$emit("input",e.join(""))}},computed:{omitListeners(){return Object(w.a)(this.$listeners,["input"])},_elFormItemSize(){return(this.elFormItem||{}).elFormItemSize},inputSize(){return this.size||this._elFormItemSize||(this.$ELEMENT||{}).size},inputDisabled(){return this.disabled||(this.elForm||{}).disabled}},methods:{handleKeyDown(e,t){t.key>=0&&t.key<=9?(this.codes.splice(e,1,""),this.timer=setTimeout(()=>{e<this.codes.length-1&&this.$refs.codeInput[e+1].focus()},10)):"Backspace"===t.key&&(this.timer=setTimeout(()=>{e>0&&this.$refs.codeInput[e-1].focus()},10))},handlePaste(e){e.preventDefault();const t=e.clipboardData.getData("text").replace(/[^\d]/g,"").split("").slice(0,this.length);t.length>0&&(this.codes=Array.from({length:this.length},(e,i)=>t[i]||""),t.length>=this.length?this.$refs.codeInput[this.length-1].focus():this.$refs.codeInput[t.length].focus())},focus(e=0){this.$refs.codeInput[e].focus()}},beforeDestroy(){clearTimeout(this.timer)}}),Ai=Object(se.a)(Pi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:[e.b(),e.inputSize?"sc-verify-input--"+e.inputSize:""]},e._l(e.codes,(function(i,s){return t("input",e._g(e._b({directives:[{name:"model",rawName:"v-model",value:e.codes[s],expression:"codes[index]"}],key:s,ref:"codeInput",refInFor:!0,attrs:{type:"number",min:"0",max:"9",required:"",disabled:e.inputDisabled,placeholder:""},domProps:{value:e.codes[s]},on:{keydown:function(t){return e.handleKeyDown(s,t)},paste:function(t){return e.handlePaste(t)},input:function(t){t.target.composing||e.$set(e.codes,s,t.target.value)}}},"input",e.$attrs,!1),e.omitListeners))})),0)}),[],!1,null,null,null).exports,Bi=a({name:"lazy-render",props:{rootClass:String,tag:{type:String,default:"div"},loadingText:{type:String,default:"加载中..."},loadingHeight:{type:[String,Number],default:"40px"},once:{type:Boolean,default:!0}},data:()=>({delay:!0,loaded:!1}),methods:{onVisible(e,t){this.once&&this.loaded||(this.$emit("visible",e,t),this.delay=!1,this.loaded=!0)}}}),Ii=Object(se.a)(Bi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t(e.tag,{directives:[{name:"scObserveVisibility",rawName:"v-scObserveVisibility",value:{onVisible:e.onVisible,rootClass:e.rootClass},expression:"{\n    onVisible: onVisible,\n    rootClass: rootClass,\n  }"}],tag:"component",class:e.b()},[e.delay?[e._t("delay",(function(){return[t("div",{staticClass:"sc-lazy-loading-stripe",style:{height:e.loadingHeight}},[t("span",{staticClass:"sc-lazy-loading-text"},[e._v(e._s(e.loadingText))])])]}))]:[e._t("default")]],2)}),[],!1,null,null,null).exports;class Fi{constructor(e={}){this.steps=e.steps||[],this.currentStep=0,this.stepData={},this.listeners=new Map}goToStep(e){if(e<0||e>=this.steps.length)return!1;if(!this.canNavigateToStep(e))return!1;const t=this.currentStep;return this.currentStep=e,this.emit("step-change",{from:t,to:e,step:this.getCurrentStep()}),!0}next(){let e=this.currentStep+1;for(;e<this.steps.length&&!this.isStepVisible(e);)e++;return e<this.steps.length&&(this.goToStep(e),!0)}prev(){let e=this.currentStep-1;for(;e>=0&&!this.isStepVisible(e);)e--;return e>=0&&(this.goToStep(e),!0)}canNavigateToStep(e,t=this.stepData){return!!this.isStepVisible(e,t)&&(this.currentStep,!0)}getCurrentStep(){return this.steps[this.currentStep]}setStepData(e,t){return!(e<0||e>=this.steps.length)&&(this.stepData="object"==typeof t?{...this.stepData,...t}:t,this.emit("data-change",{stepIndex:e,data:this.stepData}),!0)}isStepVisible(e,t=this.stepData){const i=this.steps[e];return!!i&&("function"!=typeof i.condition||i.condition(t))}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}emit(e,t){(this.listeners.get(e)||[]).forEach(e=>e(t))}}var Ni=a({name:"step-form",mixins:[{methods:{getStepValidationRules(e,t){const i={};return(e.columns||[]).forEach(e=>{const s=e.form||e,o=s.prop;if(!o)return;const{rules:r}=ee(s,{row:t});if(r&&r.length>0){const e=r.map(e=>{const t={...e};return delete t.trigger,t});i[o]=e}}),i},async validate(e){if(void 0!==e&&e===this.currentStep)try{var t;return await(null===(t=this.$refs.stepForm)||void 0===t?void 0:t.validate()),this.customValidator?new Promise((t,i)=>{this.customValidator(t,e)}):Promise.resolve()}catch(t){return Promise.reject({stepIndex:e})}if(void 0!==e){if(!this.isStepVisible(e))return Promise.resolve();const t=this.steps[e],i=this.getStepProp(e),s=this.flattenMode?this.value:this.value[i]||{},o=this.getStepValidationRules(t,s);if(0===Object.keys(o).length&&!this.customValidator)return Promise.resolve();try{if(Object.keys(o).length>0){const e=new pe.default(o);await new Promise((t,i)=>{e.validate(s,{firstFields:!0},e=>{e?i(e):t()})})}return this.customValidator?new Promise((t,i)=>{this.customValidator(t,e)}):Promise.resolve()}catch(t){return this.goToStep(e),setTimeout(()=>{var e;null===(e=this.$refs.stepForm)||void 0===e||e.validate()},350),Promise.reject({stepIndex:e,error:t})}}try{for(let e=0;e<this.steps.length;e++){if(!this.isStepVisible(e))continue;const t=this.steps[e],i=this.getStepProp(e),s=this.flattenMode?this.value:this.value[i]||{},o=this.getStepValidationRules(t,s);if(0!==Object.keys(o).length||this.customValidator)try{if(Object.keys(o).length>0){const e=new pe.default(o);await new Promise((t,i)=>{e.validate(s,{firstFields:!0},e=>{e?i(e):t()})})}this.customValidator&&await new Promise((t,i)=>{this.customValidator(t,e)})}catch(t){return this.goToStep(e),setTimeout(()=>{var e;return null===(e=this.$refs.stepForm)||void 0===e?void 0:e.validate()},350),Promise.reject({stepIndex:e,error:t})}}return Promise.resolve()}catch(e){return Promise.reject(e)}}}}],props:{value:{type:Object,default:()=>({})},steps:{type:Array,required:!0},showStep:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},showSubmit:{type:Boolean,default:!0},flattenMode:{type:Boolean,default:!1},allowDirect:{type:Boolean,default:!0},customValidator:{type:Function,default:null}},data:()=>({stepManager:null,currentStep:0,loading:!1,transitionName:"slide-left"}),created(){this.initStepManager()},computed:{currentStepConfig(){return this.steps[this.currentStep]||{}},currentStepProp(){return void 0!==this.currentStepConfig.prop?this.currentStepConfig.prop:this.currentStep},currentStepData:{get(){return this.flattenMode?this.value:this.value[this.currentStepProp]||{}},set(e){this.flattenMode?Object.keys(e).forEach(t=>{this.$set(this.value,t,e[t])}):this.$set(this.value,this.currentStepProp,e)}},currentStepFormOptions(){const e=this.currentStepConfig;return{...e.formOptions,renderColumns:e.columns||[]}},prevButtonText(){return this.currentStepConfig.prevText||"上一步"},nextButtonText(){return this.currentStepConfig.nextText||"下一步"},submitButtonText(){return this.currentStepConfig.submitText||"提交"},contentScope(){return{currentStep:this.currentStep,stepConfig:this.currentStepConfig,data:this.currentStepData,validate:this.validate}},footerScope(){return{currentStep:this.currentStep,totalSteps:this.steps.length,prev:this.prev,next:this.next,submit:this.submit,loading:this.loading}},formScopedSlots(){const e={};return Object.keys(this.$scopedSlots||{}).forEach(t=>{if(t.startsWith(`form-${this.currentStep}-`)){const i=t.substring(`form-${this.currentStep}-`.length);i&&(e[i]=!0)}}),e},visibleSteps(){return this.steps.filter((e,t)=>this.isStepVisible(t))}},watch:{currentStepData:{handler(e){this.handleStepDataChange(e)},deep:!0}},methods:{initStepManager(){this.stepManager=new Fi({steps:this.steps}),this.stepManager.on("step-change",({from:e,to:t})=>{this.transitionName=t>e?"slide-left":"slide-right",this.currentStep=t,this.$emit("step-change",{from:e,to:t,step:this.currentStepConfig})}),this.stepManager.on("data-change",({stepIndex:e,data:t})=>{})},getStepProp(e){const t=this.steps[e];return t&&void 0!==t.prop?t.prop:e},handleStepClick(e){this.canNavigateToStep(e)&&this.goToStep(e)},canNavigateToStep(e){return!!this.isStepVisible(e)&&this.stepManager.canNavigateToStep(e,this.value)},goToStep(e){return!!this.isStepVisible(e)&&this.stepManager.goToStep(e)},async next(){await this.validate(this.currentStep),this.stepManager.next()},prev(){return this.stepManager.prev()},handleStepDataChange(e){if(this.flattenMode&&this.currentStepConfig.fields){const t=this.currentStepConfig.fields,i={};t.forEach(t=>{void 0!==e[t]&&(i[t]=e[t])}),this.stepManager.setStepData(this.currentStep,i)}else this.stepManager.setStepData(this.currentStep,e)},async submit(){this.loading=!0;try{await this.validate(),await this.$emit("submit",this.value)}catch(e){}finally{this.loading=!1}},mergeSlotScope:(e,t)=>({...e,...t}),isStepVisible(e){return this.stepManager.isStepVisible(e,this.value)},getVisibleStepIndex(e){let t=0;for(let i=0;i<e;i++)this.stepManager.isStepVisible(i,this.value)&&t++;return t},getActualStepIndex(e){let t=0,i=0;for(;i<e&&t<this.steps.length;)this.stepManager.isStepVisible(t,this.value)&&i++,t++;for(;t<this.steps.length&&!this.stepManager.isStepVisible(t,this.value);)t++;return t}}}),Vi=Object(se.a)(Ni,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:e.b()},[e.showStep?t("div",{class:e.b("indicator")},e._l(e.visibleSteps,(function(i,s){return t("div",{key:s,class:e.b("indicator-item",{active:e.getVisibleStepIndex(e.currentStep)===s,completed:e.getVisibleStepIndex(e.currentStep)>s,disabled:!e.allowDirect||!e.canNavigateToStep(e.getActualStepIndex(s))}),on:{click:function(t){e.allowDirect&&e.handleStepClick(e.getActualStepIndex(s))}}},[t("div",{class:e.b("indicator-number")},[e.getVisibleStepIndex(e.currentStep)>s?t("i",{staticClass:"el-icon-check"}):t("span",[e._v(e._s(s+1))])]),e._v(" "),t("div",{class:e.b("indicator-title")},[e._v(e._s(i.title))])])})),0):e._e(),e._v(" "),t("div",{class:e.b("content")},[t("transition",{attrs:{name:e.transitionName,mode:"out-in"}},[t("div",{key:e.currentStep,class:e.b("step")},[t("sc-position",{class:e.b("step-title"),attrs:{"slot-name":"step-title","slot-suffixes":[e.currentStep+""],slots:e.$scopedSlots,scope:e.contentScope,inline:!1},scopedSlots:e._u([{key:"default",fn:function(){return[e.currentStepConfig.title?t("div",[t("h3",[e._v(e._s(e.currentStepConfig.title))]),e._v(" "),e.currentStepConfig.description?t("p",[e._v("\n                "+e._s(e.currentStepConfig.description)+"\n              ")]):e._e()]):e._e()]},proxy:!0}])}),e._v(" "),t("sc-position",{attrs:{"slot-name":"step-content","slot-suffixes":[e.currentStep+""],slots:e.$scopedSlots,scope:e.contentScope,inline:!1}},[t("sc-form",{ref:"stepForm",attrs:{options:e.currentStepFormOptions},scopedSlots:e._u([e._l(e.formScopedSlots,(function(t,i){return{key:i,fn:function(t){return[e._t(`form-${e.currentStep}-${i}`,null,null,e.mergeSlotScope(t,e.contentScope))]}}}))],null,!0),model:{value:e.currentStepData,callback:function(t){e.currentStepData=t},expression:"currentStepData"}})],1)],1)])],1),e._v(" "),e.showFooter?t("div",{class:e.b("footer")},[t("sc-position",{attrs:{"slot-name":"step-footer","slot-suffixes":[e.currentStep+""],slots:e.$scopedSlots,scope:e.footerScope},scopedSlots:e._u([{key:"default",fn:function(){return[e.currentStep>0?t("el-button",{attrs:{disabled:e.loading},on:{click:e.prev}},[e._v("\n          "+e._s(e.prevButtonText)+"\n        ")]):e._e(),e._v(" "),e.currentStep<e.steps.length-1?t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.next}},[e._v("\n          "+e._s(e.nextButtonText)+"\n        ")]):e._e(),e._v(" "),e.currentStep===e.steps.length-1&&e.showSubmit?t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.submit}},[e._v("\n          "+e._s(e.submitButtonText)+"\n        ")]):e._e()]},proxy:!0}],null,!1,4130270390)})],1):e._e()])}),[],!1,null,null,null).exports,zi=a({name:"table-select",props:{value:{type:[Array,Object,String,Number],default:null},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:""},clearable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},filterMethod:{type:Function},valueKey:{type:String,default:"id"},labelKey:{type:String,default:""},searchKey:{type:String,default:""},basicType:Boolean,tableOptions:{type:Object,default:()=>({})},search:{type:Object,default:()=>({})},data:{type:Array,default:()=>[]},total:Number,remote:Boolean,columns:{type:Array,default:()=>[]},height:{type:String,default:"300px"},loading:Boolean,useDialog:Boolean,dialogOptions:{type:Object,default:()=>({})}},data:()=>({showTable:!1,tableData:[],initialized:!1,keyWords:"",showPopper:!1,internalValue:null,_isInternalUpdate:!1,debouncedGetList:null,dialogVisible:!1,tempValue:null}),computed:{displayValue(){if(this.multiple&&this.internalValue&&this.internalValue.length)return this.internalValue.map(e=>{if(e[this.labelKey])return e[this.labelKey];if(this.data&&this.data.length){const t=this.data.find(t=>t[this.valueKey]===e[this.valueKey]);return t?t[this.labelKey]:e[this.valueKey]}return e[this.valueKey]});if(this.internalValue){if(this.internalValue[this.labelKey])return this.internalValue[this.labelKey];if(this.data&&this.data.length){const e=this.data.find(e=>e[this.valueKey]===this.internalValue[this.valueKey]);return e?e[this.labelKey]:this.internalValue[this.valueKey]}return this.internalValue[this.valueKey]}return null},_placeholder(){return this.placeholder||"请选择"+((this.crudOptions.renderColumns||[]).find(e=>e.prop===this.labelKey).label||"")},filteredData(){return this.keyWords?this.data.filter(e=>e[this.labelKey].includes(this.keyWords)):this.data},crudOptions(){const e={...this.tableOptions,toolbar:!1,menu:!1,border:!0,stripe:!0,maxHeight:this.height,gap:0,localSearch:!this.remote,renderColumns:this.tableOptions.renderColumns||this.columns};return this.multiple?e.selection={reserveSelection:!0,banner:!1,labelKey:this.labelKey,...this.tableOptions.selection}:e.singleSelection={banner:!1,ctrlSelect:!0,...this.tableOptions.singleSelection},e},tableScope(){return this}},watch:{value:{handler(e,t){this._isInternalUpdate||JSON.stringify(e)===JSON.stringify(t)||this.syncValues()},deep:!0,immediate:!0},showPopper(e){e?this.showDropdown=!0:setTimeout(()=>{this.showDropdown=!1},16)}},mounted(){this.syncValues(),this.debouncedGetList=Object(ue.a)(()=>{this.$emit("getList")},300);let e=this.$refs.select.handleClose;this.$refs.select.handleClose=t=>{setTimeout(()=>{this.showDropdown||e()},0)}},methods:{handleSelectedUpdate(e){this._isInternalUpdate=!0,this.internalValue=e;let t=e;this.multiple?(!0===this.basicType||void 0===this.basicType&&Array.isArray(this.value)&&this.value.length>0&&"object"!=typeof this.value[0])&&(t=e.map(e=>e[this.valueKey])):(!0===this.basicType||void 0===this.basicType&&"object"!=typeof this.value)&&(t=e?e[this.valueKey]:null),this.$emit("input",t),this.$emit("change",t,e),this.$nextTick(()=>{this._isInternalUpdate=!1})},_filterMethod(e){this.remote?(this.remoteMethod?this.remoteMethod(e):this.search[this.searchKey||this.labelKey]=e,this.debouncedGetList()):this.filterMethod?this.filterMethod(e):this.keyWords=e},handleRemoveTag(e){if(this.multiple){const t=this.internalValue||[],i=t.findIndex(t=>t[this.labelKey||this.valueKey]===e);if(i>-1){this._isInternalUpdate=!0,this.internalValue.splice(i,1);let e=[...this.internalValue];(!0===this.basicType||void 0===this.basicType&&Array.isArray(this.value)&&this.value.length>0&&"object"!=typeof this.value[0])&&(e=e.map(e=>e[this.valueKey])),this.$emit("input",e),this.$refs.crud.removeSelection(t[i]),this.$nextTick(()=>{this._isInternalUpdate=!1})}}},handleClear(){if(this._isInternalUpdate=!0,this.multiple)this.internalValue=[],this.$emit("input",[]),this.$refs.crud.clearSelection();else{this.internalValue=null;let e=null;(!0===this.basicType||void 0===this.basicType&&null!==this.value&&void 0!==this.value&&"object"!=typeof this.value)&&("string"==typeof this.value?e="":"number"==typeof this.value&&(e=0)),this.$emit("input",e),this.$refs.crud.removeSingleSelection()}this.$nextTick(()=>{this._isInternalUpdate=!1})},syncValues(){if(!this._isInternalUpdate)if(this.multiple)if(this.value)if(Array.isArray(this.value))this.value.length>0?!1===this.basicType||void 0===this.basicType&&"object"==typeof this.value[0]?this.internalValue=[...this.value]:this.internalValue=this.value.map(e=>{const t={};return t[this.valueKey]=e,t}):this.internalValue=[];else{const e={};e[this.valueKey]=this.value,this.internalValue=[e]}else this.internalValue=[];else if(this.value)if(!1===this.basicType||void 0===this.basicType&&"object"==typeof this.value)this.internalValue={...this.value};else{const e={};e[this.valueKey]=this.value,this.internalValue=e}else this.internalValue=null},visibleChange(e){e||(this.keyWords="")},blur(){this.$refs.select.blur()},focus(){this.$refs.select.focus()},openDialog(){const e=this.$createElement;this.tempValue=this.multiple?[...this.internalValue||[]]:this.internalValue,this.$scDialog({...this.dialogOptions,title:this.dialogOptions.title||this._placeholder,cancel:e=>{this.internalValue=this.tempValue,this.tempValue=null,e()},render:()=>{const t={};Object.keys(this.$scopedSlots).forEach(e=>{t[e]=t=>this.$scopedSlots[e](t)});return e("sc-position",{attrs:{"slot-name":"content",slots:this.$scopedSlots,scope:this.tableScope,inline:!1}},[e("sc-crud",c()([{ref:"crud",attrs:{init:!0}},{on:{"update:selected":this.handleSelectedUpdate,...this.$listeners}},{attrs:{data:this.filteredData,total:this.total,options:this.crudOptions},scopedSlots:t},{attrs:{search:this.search,selected:this.internalValue,loading:this.loading}},{},{on:{"update:search":e=>{this.search=e},"update:selected":e=>{this.internalValue=e},"update:loading":e=>{this.loading=e}}}]))])}}).show()}}}),Li=Object(se.a)(zi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"sc-table-select"},[e.useDialog?[t("el-select",e._g(e._b({ref:"select",attrs:{"popper-class":e.b("popper"),value:e.displayValue,multiple:e.multiple,placeholder:e._placeholder,clearable:e.clearable},on:{"remove-tag":e.handleRemoveTag,clear:e.handleClear},nativeOn:{click:function(t){return e.openDialog.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[e._t("prefix")]},proxy:!0}],null,!0)},"el-select",e.$attrs,!1),e.$listeners))]:[t("el-select",e._g(e._b({ref:"select",attrs:{value:e.displayValue,multiple:e.multiple,placeholder:e._placeholder,clearable:e.clearable,filterable:e.filterable,"filter-method":e._filterMethod},on:{"remove-tag":e.handleRemoveTag,clear:e.handleClear,"visible-change":e.visibleChange,focus:function(t){e.showTable=!0}},scopedSlots:e._u([{key:"empty",fn:function(){return[t("sc-position",{attrs:{"slot-name":"content",slots:e.$scopedSlots,scope:e.tableScope,inline:!1}},[e.showTable?t("sc-crud",e._g({ref:"crud",attrs:{init:"",search:e.search,selected:e.internalValue,loading:e.loading,showPopper:e.showPopper,data:e.filteredData,total:e.total,options:e.crudOptions},on:{"update:search":function(t){e.search=t},"update:selected":[function(t){e.internalValue=t},e.handleSelectedUpdate],"update:loading":function(t){e.loading=t},"update:showPopper":function(t){e.showPopper=t},"update:show-popper":function(t){e.showPopper=t}},scopedSlots:e._u([e._l(e.$scopedSlots,(function(t,i){return{key:i,fn:function(t){return[e._t(i,null,null,t)]}}}))],null,!0)},e.$listeners)):e._e()],1)]},proxy:!0},{key:"prefix",fn:function(){return[e._t("prefix")]},proxy:!0}],null,!0)},"el-select",e.$attrs,!1),e.$listeners))]],2)}),[],!1,null,null,null).exports,Ki=a({name:"splitter-panel",props:{size:{type:Number,default:null},collapsed:{type:Boolean,default:!1}},methods:{getCollapsedSlot(){return this.$slots.collapsed},getCollapsedAppendSlot(){return this.$slots["collapsed-append"]},hasCollapsedSlot(){return!!this.$slots.collapsed},hasCollapsedAppendSlot(){return!!this.$slots["collapsed-append"]}}}),Hi=Object(se.a)(Ki,(function(){var e=this._self._c;this._self._setupProxy;return e("div",{style:{height:"100%",width:"100%"}},[this._t("default")],2)}),[],!1,null,null,null).exports,Yi={name:"CollapsedPanel",functional:!0,props:{panel:{type:Object,required:!0},panelIndex:{type:Number,required:!0},collapsedPanelClass:{type:Array,required:!0},collapsedPanelStyle:{type:Object,required:!0},expandIconClass:{type:String,required:!0},shouldAppendFirst:{type:Boolean,default:!1},onExpand:{type:Function,required:!0}},render(e,{props:t}){const{panel:i,panelIndex:s,collapsedPanelClass:o,collapsedPanelStyle:r,expandIconClass:n,shouldAppendFirst:a,onExpand:l}=t,c=()=>(()=>{const e=i.componentInstance;if(e&&e.getCollapsedSlot){const t=e.getCollapsedSlot();return t&&t.length>0?t:null}return null})()||e("i",{class:n}),h=()=>(()=>{const e=i.componentInstance;if(e&&e.getCollapsedAppendSlot){const t=e.getCollapsedAppendSlot();return t&&t.length>0?t:null}return null})();return e("div",{class:o,style:r,on:{click:()=>l(s)},key:s+"collapsed"},(()=>{const e=c(),t=h();return t?a?[t,e]:[e,t]:[e]})())}},qi=Object(se.a)(Yi,void 0,void 0,!1,null,null,null).exports,Wi=a({name:"collapse-splitter",components:{SplitterPanel:Hi,CollapsedPanel:qi},props:{layout:{type:String,default:"horizontal",validator:e=>["horizontal","vertical"].includes(e)},gutterSize:{type:Number,default:8},gutterColor:{type:String,default:"var(--border-color-light)"},disabled:{type:Boolean,default:!1}},data:()=>({panelStates:[]}),computed:{panels(){const e=[];return this.$slots.default&&this.$slots.default.forEach(t=>{t&&t.componentOptions&&"sc-splitter-panel"===t.componentOptions.tag&&e.push(t)}),e},containerClass(){return[this.b(),this.b(this.layout)]},containerStyle(){return{display:"flex",flexDirection:"horizontal"===this.layout?"row":"column"}},panelClass(){return this.b("panel")},collapsedPanelClass(){return[this.b("panel"),this.b("panel","collapsed")]},collapsedPanelStyle(){return{flexGrow:"0",flexShrink:"0",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",borderLeft:"horizontal"===this.layout?"1px solid var(--border-color-light)":"none",borderTop:"vertical"===this.layout?"1px solid var(--border-color-light)":"none",color:"var(--text-color-regular)",fontSize:"14px"}},gutterClass(){return[this.b("gutter"),this.b("gutter",this.layout),this.b("gutter",{disabled:this.disabled})]},gutterStyle(){const e=this.gutterSize+"px";return{["horizontal"===this.layout?"width":"height"]:e,position:"relative",backgroundColor:this.gutterColor}},renderPanelComponent:()=>({props:["panel"],render(e){return this.panel}}),collapsedPanels(){return this.panelStates.map(e=>e.collapsed)},visiblePanelCount(){return this.panelStates.filter(e=>!e.collapsed).length},isHorizontal(){return"horizontal"===this.layout}},mounted(){this.initializePanels()},methods:{initializePanels(){const e=this.panels.map(e=>{var t;const i=null===(t=e.componentOptions)||void 0===t?void 0:t.propsData;return(null==i?void 0:i.size)||null}),t=e.filter(e=>null!==e).reduce((e,t)=>e+t,0),i=e.filter(e=>null===e).length,s=Math.max(0,100-t),o=i>0?s/i:0;this.panelStates=this.panels.map((e,t)=>{var i;const s=null===(i=e.componentOptions)||void 0===i?void 0:i.propsData,r=null==s?void 0:s.size;return{index:t,collapsed:(null==s?void 0:s.collapsed)||!1,size:null!=r?r:o,originalSize:null!=r?r:o,expandDirection:null,lastClickInfo:null}})},shouldShowGutter(e){if(e>=this.panels.length-1)return!1;const t=this.panelStates[e],i=this.panelStates[e+1];if(null!=t&&t.collapsed&&null!=i&&i.collapsed)return!1;if(!(null!=t&&t.collapsed||null!=i&&i.collapsed))return!0;if(null!=t&&t.collapsed||null!=i&&i.collapsed){const t=this.panelStates.find(e=>e.collapsed&&e.lastClickInfo);if(!t)return!1;const{index:i,lastClickInfo:s}=t,o=this.shouldReceiveExtraSpace(e,i,s),r=this.shouldReceiveExtraSpace(e+1,i,s);return!(o||r)}return!0},calculatePanelSize(e){const t=this.panelStates[e];if(!t||t.collapsed)return 0;if(this.visiblePanelCount===this.panels.length)return t.originalSize;const i=this.panelStates.find(e=>e.collapsed&&e.lastClickInfo);if(!i){const e=this.panelStates.filter(e=>!e.collapsed).reduce((e,t)=>e+t.originalSize,0);return e>0?t.originalSize/e*100:100/this.visiblePanelCount}const{index:s,lastClickInfo:o}=i;if(this.shouldReceiveExtraSpace(e,s,o)){const e=this.panelStates[s].originalSize;return t.originalSize+e}return t.originalSize},shouldReceiveExtraSpace(e,t,i){if(!i)return!1;const{clickSide:s}=i,o=0===t,r=t===this.panels.length-1;return o?e===t+1:r?e===t-1:"left"===s?e===t+1:e===t-1},panelStyle(e,t){const i=this.panelStates[t],s=this.calculatePanelSize(t),o=(null==i?void 0:i.collapsed)||!1;return{flexBasis:o?"0%":s+"%",flexGrow:o?"0":"1",flexShrink:"1",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",opacity:o?"0":"1",[this.isHorizontal?"minWidth":"minHeight"]:o?"0":"auto"}},handleGutterClick(e,t){const i=e.target.getBoundingClientRect(),s=this.isHorizontal?(e.clientX-i.left)/i.width:(e.clientY-i.top)/i.height,o=s<.5?t:t+1,r=s<.5?"left":"right",n=this.panelStates[o];n&&(n.lastClickInfo={gutterIndex:t,clickSide:r,isHorizontal:this.isHorizontal}),this.togglePanel(o)},handleGutterMouseMove(e){const t=e.currentTarget.getBoundingClientRect(),i=e.currentTarget,s=this.isHorizontal?(e.clientX-t.left)/t.width:(e.clientY-t.top)/t.height;i.classList.remove("hover-left","hover-right","hover-top","hover-bottom");const o=this.getHoverClass(s);o&&i.classList.add(o)},getHoverClass(e){const t=e<.5;return this.isHorizontal?t?"hover-left":"hover-right":t?"hover-top":"hover-bottom"},handleGutterMouseLeave(e){e.currentTarget.classList.remove("hover-left","hover-right","hover-top","hover-bottom")},expandIconClass(e){const t=this.panelStates[e],i=0===e,s=e===this.panels.length-1,o=null==t?void 0:t.lastClickInfo;return"el-icon-arrow-"+(()=>i?this.isHorizontal?"right":"down":s?this.isHorizontal?"left":"up":"left"===(null==o?void 0:o.clickSide)?this.isHorizontal?"right":"down":this.isHorizontal?"left":"up")()},shouldAppendFirst(e){const t=this.panelStates[e],i=0===e,s=e===this.panels.length-1,o=null==t?void 0:t.lastClickInfo;return"right"===(()=>i?this.isHorizontal?"right":"down":s?this.isHorizontal?"left":"up":"left"===(null==o?void 0:o.clickSide)?this.isHorizontal?"right":"down":this.isHorizontal?"left":"up")()},collapsePanel(e){!this.disabled&&this.panelStates[e]&&(this.$set(this.panelStates[e],"collapsed",!0),this.emitPanelEvent("panel-collapse",e,!0))},expandPanel(e){if(this.disabled||!this.panelStates[e])return;const t=this.panelStates[e];this.$set(t,"collapsed",!1),this.$set(t,"lastClickInfo",null),this.emitPanelEvent("panel-expand",e,!1)},togglePanel(e){const t=this.panelStates[e];t&&(t.collapsed?this.expandPanel(e):this.collapsePanel(e))},emitPanelEvent(e,t,i){this.$emit(e,{index:t,collapsed:i,collapsedPanels:this.collapsedPanels,panelStates:[...this.panelStates]})},expandAllPanels(){this.panelStates.forEach(e=>{this.$set(e,"collapsed",!1),this.$set(e,"lastClickInfo",null)}),this.$emit("all-panels-expanded",{collapsedPanels:this.collapsedPanels,panelStates:[...this.panelStates]})},getPanelStates(){return[...this.panelStates]}},watch:{panels:{handler(){this.initializePanels()},immediate:!1}}}),Gi=Object(se.a)(Wi,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:e.containerClass,style:e.containerStyle},[e._l(e.panels,(function(i,s){return[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.collapsedPanels[s],expression:"!collapsedPanels[i]"}],key:s,class:e.panelClass,style:e.panelStyle(i,s)},[t(e.renderPanelComponent,{tag:"component",attrs:{panel:i}})],1),e._v(" "),e.collapsedPanels[s]?t("CollapsedPanel",{key:s+"collapsed",attrs:{panel:i,"panel-index":s,"collapsed-panel-class":e.collapsedPanelClass,"collapsed-panel-style":e.collapsedPanelStyle,"expand-icon-class":e.expandIconClass(s),"should-append-first":e.shouldAppendFirst(s),"on-expand":e.expandPanel}}):e._e(),e._v(" "),e.shouldShowGutter(s)?t("div",{key:s+"gutter",class:e.gutterClass,style:e.gutterStyle,attrs:{"data-prev-collapsed":e.collapsedPanels[s],"data-next-collapsed":e.collapsedPanels[s+1]},on:{click:function(t){return e.handleGutterClick(t,s)},mousemove:e.handleGutterMouseMove,mouseleave:e.handleGutterMouseLeave}}):e._e()]}))],2)}),[],!1,null,null,null).exports,Ui={inserted:function(e){e.parentNode&&e.parentNode.removeChild(e)},update(e,t,i,s){t.value&&(t.value.vnode=s)}},Ji={bind(e,t,i,s){if(0==t.value)return;const o=e.querySelector(".el-dialog__header"),r=e.querySelector(".dialog-drag"),n=e.querySelector(".el-dialog");if(!n||!o)return;r.style.cursor="move",e._dragEnabled=!0;const a=n.currentStyle||window.getComputedStyle(n,null);let l=n.style.width;l=l.includes("%")?+document.body.clientWidth*(+l.replace(/\%/g,"")/100):+l.replace(/\px/g,""),r.onmousedown=i=>{if(!1===e._dragEnabled)return;if("absolute"!==n.style.position){const e=n.getBoundingClientRect();n.style.position="absolute",n.style.left=e.left+"px",n.style.top=e.top+"px",n.style.margin="0"}n.style["user-select"]="none";const s=i.clientX-o.offsetLeft,r=i.clientY-o.offsetTop;let l,c;a.left.includes("%")?(l=+document.body.clientWidth*(+a.left.replace(/\%/g,"")/100),c=+document.body.clientHeight*(+a.top.replace(/\%/g,"")/100)):(l=+a.left.replace(/\px/g,""),c=+a.top.replace(/\px/g,"")),document.onmousemove=function(e){const i=e.clientX-s,o=e.clientY-r;let a=i+l,h=o+c;const d=document.documentElement.clientWidth||document.body.clientWidth,u=document.documentElement.clientHeight||document.body.clientHeight,p=n.offsetWidth,m=n.offsetHeight;a<0&&(a=0),a+p>d&&(a=d-p),h<0&&(h=0),h+m>u&&(h=u-m),n.style.left=a+"px",n.style.top=h+"px","function"==typeof t.value&&t.value({x:a,y:h})},document.onmouseup=function(e){n.style["user-select"]="auto",document.onmousemove=null,document.onmouseup=null}}}},Xi={bind(e,t){if(0==t.value)return;const i=e.querySelector(".el-dialog");if(!i)return;e._dragSizeEnabled=!0;const s=document.createElement("div");s.style="width: 20px; background: transparent; height: 20px; position: absolute; right: 0; bottom: 0; margin: auto; z-index: 10; cursor: nwse-resize;",s.className="dialog-resize-corner";const o=document.createElement("div");o.style="width: 10px; background: transparent; height: calc(100% - 40px); position: absolute; right: 0; top: 20px; margin: auto; z-index: 10; cursor: ew-resize;",o.className="dialog-resize-right";const r=document.createElement("div");r.style="width: calc(100% - 40px); background: transparent; height: 10px; position: absolute; bottom: 0; left: 20px; margin: auto; z-index: 10; cursor: ns-resize;",r.className="dialog-resize-bottom";const n=()=>{if("absolute"!==i.style.position){const e=i.getBoundingClientRect();i.style.position="absolute",i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.margin="0"}},a=()=>{i.style["user-select"]="auto",document.onmousemove=null,document.onmouseup=null,"function"==typeof t.value&&t.value({height:i.offsetHeight,width:i.offsetWidth})};s.addEventListener("mousedown",(function(t){if(t.stopPropagation(),!1===e._dragSizeEnabled)return;n();const s=t.clientX,o=t.clientY,r=i.offsetWidth,l=i.offsetHeight,c=parseInt(i.style.top)||0,h=parseInt(i.style.left)||0,d=document.documentElement.clientWidth||document.body.clientWidth,u=document.documentElement.clientHeight||document.body.clientHeight;document.onmousemove=function(e){i.style["user-select"]="none",e.preventDefault();const t=e.clientX-s,n=e.clientY-o;let a=r+t,p=l+n;a=Math.max(a,300),p=Math.max(p,200),i.style.width=h+a<=d?a+"px":d-h+"px",i.style.height=c+p<=u?p+"px":u-c+"px"},document.onmouseup=a}),!1),o.addEventListener("mousedown",(function(t){if(t.stopPropagation(),!1===e._dragSizeEnabled)return;n();const s=t.clientX,o=i.offsetWidth,r=parseInt(i.style.left)||0,l=document.documentElement.clientWidth||document.body.clientWidth;document.onmousemove=function(e){i.style["user-select"]="none",e.preventDefault();const t=e.clientX-s;let n=o+t;n=Math.max(n,300),i.style.width=r+n<=l?n+"px":l-r+"px"},document.onmouseup=a}),!1),r.addEventListener("mousedown",(function(t){if(t.stopPropagation(),!1===e._dragSizeEnabled)return;n();const s=t.clientY,o=i.offsetHeight,r=parseInt(i.style.top)||0,l=document.documentElement.clientHeight||document.body.clientHeight;document.onmousemove=function(e){i.style["user-select"]="none",e.preventDefault();const t=e.clientY-s;let n=o+t;n=Math.max(n,200),i.style.height=r+n<=l?n+"px":l-r+"px"},document.onmouseup=a}),!1),i.appendChild(s),i.appendChild(o),i.appendChild(r)}},Zi={bind(e,t){if(!1===t.value)return;const i=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog");if(!s||!i)return;s._originalStyle||(s._originalStyle={width:"",height:"",top:"",left:"",margin:"",position:""}),s._isFullscreen=!1;const o=i.querySelector(".el-icon-full-screen")||i.querySelector(".el-icon-news");o&&(o.onclick=null,o.addEventListener("click",(function(t){if(t.stopPropagation(),s._isFullscreen=!s._isFullscreen,o.classList.contains("el-icon-full-screen")?(o.classList.remove("el-icon-full-screen"),o.classList.add("el-icon-news")):(o.classList.remove("el-icon-news"),o.classList.add("el-icon-full-screen")),s._isFullscreen){s._originalStyle.saved||(s._originalStyle.width=s.style.width,s._originalStyle.height=s.style.height,s._originalStyle.top=s.style.top,s._originalStyle.left=s.style.left,s._originalStyle.margin=s.style.margin,s._originalStyle.position=s.style.position,s._originalStyle.saved=!0);const t=document.documentElement.clientWidth||document.body.clientWidth,i=document.documentElement.clientHeight||document.body.clientHeight;s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width=t+"px",s.style.height=i+"px",s.style.margin="0",e._dragEnabled&&(e._dragEnabled=!1,e._dragEnabledPrev=!0),e._dragSizeEnabled&&(e._dragSizeEnabled=!1,e._dragSizeEnabledPrev=!0)}else s._originalStyle.saved?(s.style.position=s._originalStyle.position||"",s.style.top=s._originalStyle.top||"",s.style.left=s._originalStyle.left||"",s.style.width=s._originalStyle.width||"",s.style.height=s._originalStyle.height||"",s.style.margin=s._originalStyle.margin||""):(s.style.position="",s.style.top="",s.style.left="",s.style.width="",s.style.height="",s.style.margin=""),e._dragEnabledPrev&&(e._dragEnabled=!0,e._dragEnabledPrev=!1),e._dragSizeEnabledPrev&&(e._dragSizeEnabled=!0,e._dragSizeEnabledPrev=!1);window.dispatchEvent(new Event("resize"))})))},update(e,t){if(t.value!==t.oldValue&&!1===t.value){const t=e.querySelector(".el-dialog");if(t&&t._isFullscreen){const t=e.querySelector(".el-dialog__header");if(t){const e=t.querySelector(".el-icon-news");e&&e.click()}}}},unbind(e){const t=e.querySelector(".el-dialog");t&&(delete t._isFullscreen,delete t._originalStyle),delete e._dragEnabled,delete e._dragEnabledPrev,delete e._dragSizeEnabled,delete e._dragSizeEnabledPrev}};let Qi=null;const es=new WeakMap;let ts=[],is=null;const ss={batchSize:8,maxProcessTime:16,frameInterval:2};function os(e=ss){const t=performance.now();let i=0;for(;ts.length>0&&i<e.batchSize;){if(e.maxProcessTime-(performance.now()-t)<=0)break;const{callback:s,config:o}=ts.shift();try{s(),i++}catch(e){console.warn("延迟渲染回调执行失败:",e)}}ts.length>0?function(e=ss){let t=0;!function i(){t++,t>=e.frameInterval?is=requestAnimationFrame(()=>os(e)):requestAnimationFrame(i)}()}(e):is=null}function rs(e){return Qi&&Qi.root===e||(Qi=new IntersectionObserver(e=>{e.sort((e,t)=>e.isIntersecting&&t.isIntersecting?t.intersectionRatio-e.intersectionRatio:Number(t.isIntersecting)-Number(e.isIntersecting)),e.forEach(e=>{if(e.isIntersecting){const t=es.get(e.target);if(t){const{onVisible:i,batchConfig:s=ss}=t;ts.push({callback:()=>i(e),config:s}),function(){if(is)return;const e=ts.length>0&&ts[ts.length-1].config||ss;is=ts.length<=e.batchSize?requestAnimationFrame(()=>{ts.forEach(({callback:e})=>{try{e()}catch(e){console.warn("延迟渲染回调执行失败:",e)}}),ts=[],is=null}):requestAnimationFrame(()=>os(e))}()}Qi.unobserve(e.target),es.delete(e.target)}})},{root:e,rootMargin:"200px 0px",threshold:[0,.25,.5,.75,1]})),Qi}function ns(e,t){const{onVisible:i,rootClass:s,batchConfig:o={},...r}=t,n={...ss,...o};Qi&&(Qi.unobserve(e),es.delete(e));rs(e.closest("."+s)||function(e){let t=e;for(;t;){const e=window.getComputedStyle(t),i=e.overflowY,s=e.overflowX,o=e.overflow;if(/(auto|scroll|overlay)/.test(i+s+o)&&(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth))return t;t=t.parentElement}return null}(e)).observe(e),es.set(e,{onVisible:i,batchConfig:n,...r})}var as={inserted(e,t){ns(e,t.value)},componentUpdated(e,t){ns(e,t.value)},unbind(e){Qi&&(Qi.unobserve(e),es.delete(e))}};const ls={show:[Boolean,Function],hidden:[Boolean,Function],prop:String,label:String,presetType:{type:String},dict:{strict:!0,type:[String,Object,Function],properties:{key:String,request:Function,label:String,value:String,color:String,children:String,params:[Object,Function],immediate:Boolean,cache:Boolean,dataPath:String,transform:Function,otherPath:[String,Array],debounceTime:Number,enhanceDict:Object,local:Boolean}},comp:{type:[Object,Function],properties:{name:[String,Object],on:Object,bind:[Object,Function]}},formatter:Function,html:Boolean,render:Function,required:[Boolean,Object,Function],rules:{type:[Array,Function],arrayOf:{strict:!0,type:[Object,String],properties:{validator:Function,message:String,trigger:String,regular:RegExp,msg:String}}},position:Boolean,formatData:[Object,String]},cs={type:[Object,String,Boolean],strict:!0,properties:{label:[String,Function],type:{type:String,enum:["primary","success","warning","danger","info","text"]},icon:[String,Function],disabled:[Boolean,Function],onClick:Function,size:{type:String,enum:["medium","small","mini"]},loading:[Boolean,Function],plain:[Boolean,Function],round:[Boolean,Function],circle:[Boolean,Function],children:[Array,Function],hidden:[Boolean,Function],show:[Boolean,Function],hasPermi:Array,confirm:[String,Function],successBack:Function}},hs=[Object,Boolean];var ds={dialogOptions:{schema:{title:String,width:{type:[Number,String],default:""},size:{type:String,default:"small"},drag:{type:Boolean,default:!0},dragSize:{type:Boolean,default:!0},fullscreen:{type:Boolean,default:!0},mounted:{type:Function,default:()=>{}},confirm:{type:Function,default:()=>{}},cancel:{type:Function,default:()=>{}},closed:{type:Function,default:()=>{}},footer:{type:Object,default:()=>({align:"right",confirm:{},cancel:{},handles:[]}),properties:{show:Boolean,hidden:Boolean,align:String,confirm:hs,cancel:hs,handles:{type:Array,arrayOf:cs}}}},transforms:[(e,t,i)=>{["footer"].includes(t)&&"boolean"==typeof i&&(e[t]={show:i})},(e,t,i)=>{Array.isArray(i)&&["footer"].includes(t)&&(e[t]={confirm:!1,cancel:!1,handles:i})}]},formOptions:{ignoreKeys:["model","rules","labelPosition","labelWidth","labelSuffix","inline","inlineMessage","statusIcon","showMessage","size","disabled","validateOnRuleChange","hideRequiredAsterisk","slots","mode","defaultRender","initShow"],schema:{...{columns:{type:Number,default:1},autoFill:[Boolean,String],fillCell:Boolean,minColumns:Number,maxColumns:Number,columnWidth:[String,Number],minColumnWidth:[String,Number],maxColumnWidth:[String,Number],gap:{},columnGap:{},rowGap:{},areas:{},minRowHeight:[String,Number],maxRowHeight:[String,Number],alignContent:{},rows:{},justifyContent:{},flow:{},height:{default:"auto"},gridStyle:{type:Object,default:()=>({})}},title:String,size:{type:String,default:"small"},colon:Boolean,detail:Boolean,border:Boolean,group:Boolean,labelWidth:{type:String,default:"100px"},labelPosition:{type:String,default:"right"},layout:{type:String,default:"grid"},shrinkLabel:{type:Boolean,default:!0},scrollError:{type:Boolean,default:!0},hiddenLabel:Boolean,labelOverTip:Boolean,contextMenu:{type:[Boolean,Object],strict:!0,properties:{show:Boolean,hidden:Boolean,quickMock:hs,mock:hs,copy:hs,reset:hs,paste:hs,saveDraft:hs,loadDraft:hs,draft:hs,handles:{type:Array,default:()=>[],arrayOf:cs}},default:()=>({copy:!0,quickMock:!0,mock:!0,reset:!0,paste:!0,saveDraft:!0,loadDraft:!0,draft:!0,handles:[]})},action:{type:Object,properties:{show:Boolean,hidden:Boolean,submit:hs,reset:hs,handles:{type:Array,default:()=>[],arrayOf:cs}},default:()=>({align:"center"})},renderColumns:{type:Array,required:!0,default:()=>[],arrayOf:{type:Object,properties:{tooltip:String,tooltipRender:Function,labelRender:Function,widthSize:[Number,String],heightSize:[Number,String],labelOverTip:Boolean,hiddenLabel:Boolean,deepProp:String,formatData:{type:[String,Object],properties:{type:String,formatValue:Boolean,input:Function,output:Function}},children:Array,...ls,detail:{type:[Boolean,Object],properties:ls}}}}},transforms:[(e,t,i)=>{["action","contextMenu"].includes(t)&&("boolean"==typeof i?e[t]={show:i}:Object(T.a)(i)&&void 0===i.show&&void 0===i.hidden&&(e[t]={show:!0,...i}))},(e,t,i)=>{Array.isArray(i)&&["action","contextMenu"].includes(t)&&(e[t]={handles:i})}]},crudOptions:{ignoreKeys:["key","data","size","width","height","maxHeight","fit","stripe","border","rowKey","context","showHeader","showSummary","sumText","summaryMethod","rowClassName","rowStyle","cellClassName","cellStyle","headerRowClassName","headerRowStyle","headerCellClassName","headerCellStyle","highlightCurrentRow","currentRowKey","emptyText","expandRowKeys","defaultExpandAll","defaultSort","tooltipEffect","spanMethod","selectOnIndeterminate","indent","treeProps","lazy","load"],schema:{title:String,size:{type:String,default:"small"},listApi:Function,deleteApi:Function,stateKey:String,persistPageSize:Boolean,persistWidth:Boolean,delayRender:Boolean,delayRenderConfig:{type:[Boolean,Object],default:()=>({batchSize:16,maxProcessTime:16,frameDelay:2,strategy:"cell"}),properties:{batchSize:Number,maxProcessTime:Number,frameDelay:Number}},virtualized:Boolean,itemSize:{type:Number,default:40},summaryData:Array,disabled:Boolean,init:Boolean,footerAddBtn:Boolean,addBtn:Boolean,deleteBtn:Boolean,editBtn:Boolean,viewBtn:Boolean,rowAddBtn:Boolean,rowAddType:{type:String,enum:["first","last"]},editConfig:{type:Object,strict:!0,default:()=>({}),properties:{mode:{type:String,enum:["free","cell","row","dialog"]},trigger:{type:String,enum:["manual","click","dblclick"],default:"manual"},edit:cs,batch:Object(y.a)(cs,{properties:{isSelect:Boolean}}),add:Object(y.a)(cs,{properties:{addType:{type:String,enum:["first","last"]}}}),lastAdd:Object(y.a)(cs,{properties:{addType:{type:String,enum:["first","last"]}}}),addChild:cs,batchDelete:cs,delete:cs,view:cs,isRowEdit:Function,autofocus:{type:[Boolean,String],default:!0},exclusive:Boolean}},batchDeleteBtn:Boolean,freeEdit:Boolean,rowEdit:[Boolean,Object],cellEdit:[Boolean,Object],batchEdit:[Boolean,Object],batchRowEdit:[Boolean,Object],isRowEdit:Function,refreshAfterOperation:{type:Boolean,default:!0},editTheme:{type:Boolean,default:!0},validateMsg:Boolean,allColumn:Object,height:String,calcHeight:{type:Number,default:0},gap:{type:[Number,String],default:20},sortProps:Array,sortMethod:Function,loadingText:String,loadingSpinner:String,loadingBackground:String,disableLoading:Boolean,localPagination:Boolean,localSearch:Boolean,showPopper:Boolean,expandSearch:Boolean,addForm:{type:Object,default:()=>({})},editForm:{type:Object,default:()=>({})},viewForm:{type:Object,default:()=>({viewType:"form"})},formOptions:{type:Object,default:()=>({})},dialog:{type:Object,default:()=>({})},permission:{type:Object,default:()=>({})},props:{type:Object,default:()=>({pageNum:"pageNum",pageSize:"pageSize",total:"total",data:"data"})},uniqueId:{type:Boolean,default:!1},valueKey:{type:String,default:"id"},searchForm:{type:[Boolean,Object],default:()=>({initShow:!1}),properties:{show:Boolean,initShow:Boolean}},searchHeader:{type:[Boolean,Object],default:()=>({show:!0,resetBtn:!0}),properties:{width:[Number,String],searchBtn:Boolean,resetBtn:Boolean}},singleSelection:{type:[Boolean,Object],default:()=>({width:50,align:"center",clear:!0,ctrlSelect:!0})},selection:{type:[Boolean,Object],default:()=>({width:50,align:"center",maxDisplay:3,clear:!0,shiftSelect:!0,ctrlSelect:!0})},index:{type:[Boolean,Object],default:()=>({label:"序号",width:50,align:"center"})},expand:{type:[Boolean,Object],default:()=>({width:50,align:"center"})},pagination:{type:[Boolean,Object],default:()=>({align:"right",pageSizes:[10,20,30,50,100,200],layout:"total, sizes, prev, pager, next, jumper",background:!0,pagerCount:5,memorizeScroll:!0})},empty:{type:[Boolean,Object],default:()=>({image:"",size:100,text:"暂无数据"}),properties:{show:Boolean,hidden:Boolean,image:String,size:Number,text:String}},handleRow:{type:[Boolean,Object],properties:{show:Boolean,hidden:Boolean,add:hs,rowAdd:hs,batchDelete:hs,handles:{type:Array,arrayOf:cs}}},toolbar:{type:[Boolean,Object],strict:!0,properties:{show:Boolean,hidden:Boolean,zoom:hs,search:hs,refresh:hs,reset:hs,column:hs,excelImport:hs,excelExport:hs,handles:{type:Array,arrayOf:cs}},default:()=>({zoom:!0,refresh:!0,reset:!0,column:!0,handles:[]})},action:{type:[Boolean,Object],strict:!0,properties:{show:Boolean,hidden:Boolean,type:String,prop:String,width:[String,Number],label:String,align:String,calcWidth:Number,defaultWidth:Number,sameRowSpan:[String,Boolean],spanProp:[String,Boolean],fixed:[String,Boolean],handles:{type:Array,default:()=>[],arrayOf:cs},delete:hs,view:hs,edit:hs,rowEdit:hs,rowSave:hs,rowCancel:hs},default:()=>({prop:"action",width:"auto",label:"操作",align:"center",calcWidth:20,defaultWidth:50,handles:[]})},contextMenu:{type:[Boolean,Object],strict:!0,properties:{show:Boolean,hidden:Boolean,actionBtn:Boolean,copy:hs,mock:hs,clearMock:hs,reset:hs,handles:{type:Array,default:()=>[],arrayOf:cs}},default:()=>({copy:!0,mock:!0,clearMock:!0,reset:!0,actionBtn:!0,handles:[]})},areaSelection:{type:[Boolean,Object],strict:!0,properties:{show:Boolean,hidden:Boolean,operationType:{type:String,enum:["all","edit"],default:"edit"},selectAll:{type:Boolean,default:!0},copy:{type:Boolean,default:!0},paste:{type:Boolean,default:!0},cut:{type:Boolean,default:!0},fill:{type:Boolean,default:!0},undo:{type:Boolean,default:!0},redo:{type:Boolean,default:!0},selection:{type:Boolean,default:!0},fillCustomLists:{type:Array,default:()=>[]}},default:()=>({show:!0,hidden:!1,copy:!0,paste:!0,cut:!0,fill:!0,undo:!0,redo:!0,selection:!0,selectAll:!0})},renderColumns:{type:Array,required:!0,default:()=>[],arrayOf:{type:Object,properties:{...ls,hiddenList:Boolean,children:Array,sameRowSpan:[String,Boolean],spanProp:[String,Boolean],spanMethod:Function,isEdit:[Boolean,Function],summary:{type:Object,strict:!0,properties:{type:String,enum:["sum","avg","count","max","min","custom"],path:String,prefix:String,suffix:String,decimals:Number,ignoreZero:Boolean,absolute:Boolean,predicate:Function,method:Function}},add:{type:[Object,Boolean],properties:ls},edit:{type:[Object,Boolean],properties:ls},view:{type:[Object,Boolean],properties:ls},form:{type:[Object,Boolean],properties:ls},search:{type:[Object,Boolean],properties:ls},searchHeader:{type:[Object,Boolean],properties:ls}},ignoreKeys:["type","className","labelClassName","width","minWidth","renderHeader","sortable","sortMethod","sortBy","resizable","align","headerAlign","showOverflowTooltip","fixed","formatter","selectable","reserveSelection","filterMethod","filteredValue","filters","filterPlacement","filterMultiple","index","sortOrders"]}}},transforms:[(e,t,i)=>{["searchHeader","singleSelection","selection","index","expand","empty","handleRow","toolbar","action","contextMenu","areaSelection"].includes(t)&&("boolean"==typeof i?e[t]={show:i}:Object(T.a)(i)&&void 0===i.show&&void 0===i.hidden&&(e[t]={show:!0,...i}))},(e,t,i)=>{["handleRow","toolbar","action","contextMenu"].includes(t)&&Array.isArray(i)&&(e[t]={show:!0,cover:!0,handles:i})}]},componentMockConfig:it};const us="pending",ps="success",ms="error";class fs{constructor(e,t={}){return this.vue=e,this.vm=new e,this.loadTasks={},this.dictMeta=new Map,this.dictWatch=new Map,this.pendingPromises=new Set,this.defaultMeta=this.createDefaultMeta(t),this.state=e.observable({dictsData:{},dictStatus:{},dictsParams:{}}),new Proxy(this,{get:(e,t)=>t in e?e[t]:e.state.dictsData[t]?e.enhanceDict(e.state.dictsData[t],t):(e.get(t).catch(e=>{console.error(`加载字典 ${t} 失败:`,e)}),e.enhanceDict([],t))})}createDefaultMeta(e){return{request:()=>{},label:"label",value:"value",color:"color",children:"children",params:null,immediate:!1,cache:!0,dataPath:"data",transform:null,noRepeat:!1,otherPath:null,debounceTime:300,...e}}register(e,t,i=!1){if(this.dictMeta.get(e)&&!i)return this;const s={...this.defaultMeta,..."function"==typeof t?{request:t}:t,otherPath:Array.isArray(t.otherPath)?t.otherPath:[t.otherPath],isCustom:t.request&&t.request!==this.defaultMeta.request};return t.options?(s.request=()=>new Promise(e=>{e({data:t.options})}),this):(this.dictMeta.set(e,s),"function"!=typeof s.params||this.dictWatch.get(e)||this.dictWatch.set(e,this.vm.$watch(s.params,t=>{this.get(e,t)},{deep:!0,immediate:s.immediate})),(s.immediate&&"function"!=typeof s.params||void 0!==this.state.dictsData[e])&&this.get(e,s.params),this)}isParamsEqual(e,t){return!e&&!t||!(!e||!t)&&JSON.stringify(e)===JSON.stringify(t)}registerBatch(e){return Object.entries(e).forEach(([e,t])=>{this.register(e,t)}),this}isValidParams(e){return!!e&&Object.values(e).every(e=>null!=e&&""!==e)}enhanceDict(e,t){if(!Array.isArray(e)||e.findLabel)return e;const i=this.dictMeta.get(t)||this.defaultMeta,s={findLabel:{value:t=>{var i;return(null===(i=e.find(e=>e.value===t))||void 0===i?void 0:i.label)||""},configurable:!0,enumerable:!1},toMap:{value:()=>this.formatMap(e),configurable:!0,enumerable:!1},values:{value:()=>e.map(e=>e.value),configurable:!0,enumerable:!1},labels:{value:()=>e.map(e=>e.label),configurable:!0,enumerable:!1},getOption:{value:t=>Array.isArray(t)?t.map(t=>e.find(e=>e.value===t)):e.find(e=>e.value===t),configurable:!0,enumerable:!1},wait:{value:()=>this.waitFor(t),configurable:!0,enumerable:!1},ready:{value:this.isReady(t),configurable:!0,enumerable:!1}},o=this.state.dictsData[t+"_other"];return o&&i.otherPath.forEach(e=>{s[e]={value:o[e],configurable:!0,enumerable:!1}}),i.enhanceDict&&Object.keys(i.enhanceDict).length>0&&Object.keys(i.enhanceDict).forEach(t=>{"function"==typeof i.enhanceDict[t]&&(s[t]={value:s=>i.enhanceDict[t](s,t,e,i),configurable:!0,enumerable:!1})}),Object.defineProperties(e,s),e}setState(e,t,i="dictsData"){this.vue.set(this.state[i],e,t)}setParams(e,t){this.vue.set(this.state.dictsParams,e,t)}get(e,t){try{const i=this.dictMeta.get(e)||this.defaultMeta,s=this.loadDict(e,i,!1,t);return this.pendingPromises.add(s),s.finally(()=>{this.pendingPromises.delete(s)}),s}catch(e){return console.error("获取字典数据失败:",e),Promise.reject(e)}}loadDict(e,t,i,s){if(!i&&this.isValidCache(e,s))return Promise.resolve({key:e,data:this.state.dictsData[e]});if(this.setState(e,us,"dictStatus"),this.setState(e,[],"dictsData"),this.loadTasks[e]&&t.noRepeat)return this.loadTasks[e];const{request:o}=t;if(!t.request){const t=new Error(e+" 字典缺少请求函数");return this.handleDictError(e,t),Promise.reject(t)}return this.loadTasks[e]=new Promise((i,r)=>{const n=s=>{let o=t.dataPath?Object(g.a)(s,t.dataPath):s;if(t.otherPath){const i=t.otherPath.reduce((e,t)=>(e[t]=Object(g.a)(s,t),e),{});this.setState(e+"_other",i,"dictsData")}if(o){if(!Array.isArray(o)){const t=new Error(e+" 字典返回数据必须为数组",o);return this.handleDictError(e,t),void r(t)}t.transform&&"function"==typeof t.transform?(o=t.transform(o),o=this.formatDictData(t,o)):o=this.formatDictData(t,o),this.setState(e,ps,"dictStatus"),this.setState(e,o,"dictsData"),i({key:e,data:o}),setTimeout(()=>{this.loadTasks[e]=null},t.debounceTime||0)}else i({key:e,data:[]})},a=t=>{this.handleDictError(e,t),r(t)};try{const i=s||this.state.dictsParams[e];i&&this.setState(e,i,"dictsParams"),o(t.isCustom?i:e).then(n).catch(a)}catch(e){a(e)}}),this.loadTasks[e]}async waitFor(e){return this.isReady(e)||await this.get(e),this.enhanceDict(this.state.dictsData[e],e)}async waitAll(){return new Promise((e,t)=>{setTimeout(async()=>{try{return 0===this.pendingPromises.size||await Promise.all(Array.from(this.pendingPromises)),e(this.state.dictsData)}catch(e){return this.pendingPromises.clear(),console.error("等待字典加载失败:",e),t(e)}},0)})}wait(e){return e?this.waitFor(e):this.waitAll()}isReady(e){return this.state.dictStatus[e]===ps}handleDictError(e,t){this.setState(e,ms,"dictStatus"),console.error(`Dict Error (${e}):`,t)}isValidCache(e,t){const i=this.dictMeta.get(e)||this.defaultMeta;return!I(this.state.dictsData[e])&&!1!==(null==i?void 0:i.cache)&&this.state.dictStatus[e]===ps&&this.isParamsEqual(this.state.dictsParams[e],t)}formatDictData(e,t){return t.map(t=>({color:t[e.color],label:t[e.label],value:t[e.value],children:t[e.children]?this.formatDictData(e,t[e.children]):null,raw:t}))}formatMap(e){const t={};return e.forEach(e=>{t[e.value]=e,e.children&&this.formatMap(e.children,t)}),t}clear(e){if(e){this.pendingPromises.delete(this.loadTasks[e]),this.loadTasks[e]=null,this.dictMeta.delete(e),this.state.dictsData[e]=null,this.state.dictStatus[e]=null,this.state.dictsParams[e]=null;const t=this.dictWatch.get(e);t&&t(),this.dictWatch.delete(e)}else this.pendingPromises.clear(),this.loadTasks={},this.dictMeta.clear(),this.state.dictsData={},this.state.dictStatus={},this.state.dictsParams={},this.dictWatch.forEach(e=>e()),this.dictWatch.clear()}}const gs=[pi,vt,Ci,yi,vi,$i,ki,Ei,Ti,ji,Ai,Fe,oe,ye,ve,Ii,Vi,Li,Gi,Hi],ys=function(e,t={}){var i;ys.installed||(ys.installed=!0,t.template&&(i=t.template,Object(y.a)(E,i)),G(ds,t),gs.forEach(t=>e.component(t.name,t)),e.prototype.$scOpt=t,e.prototype.$scDialog=Ct,e.prototype.$scDict=function(e,t){const i=new fs(e,t),s=Object(g.a)(R,"dicts");return s&&i.registerBatch(s),i}(e,t.dict||{}),function(e){e.directive("insertSlot",Ui),e.directive("scDialogDrag",Ji),e.directive("scDialogDragHeight",Xi),e.directive("scDialogFullscreen",Zi),e.directive("scObserveVisibility",as)}(e),window.Vue=e)};"undefined"!=typeof window&&window.Vue&&ys(window.Vue);t.default={install:ys}}}]);